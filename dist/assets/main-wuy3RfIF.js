(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))c(d);new MutationObserver(d=>{for(const m of d)if(m.type==="childList")for(const y of m.addedNodes)y.tagName==="LINK"&&y.rel==="modulepreload"&&c(y)}).observe(document,{childList:!0,subtree:!0});function r(d){const m={};return d.integrity&&(m.integrity=d.integrity),d.referrerPolicy&&(m.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?m.credentials="include":d.crossOrigin==="anonymous"?m.credentials="omit":m.credentials="same-origin",m}function c(d){if(d.ep)return;d.ep=!0;const m=r(d);fetch(d.href,m)}})();function to(C){return C&&C.__esModule&&Object.prototype.hasOwnProperty.call(C,"default")?C.default:C}var ie={exports:{}};var eo=ie.exports,Ln;function io(){return Ln||(Ln=1,(function(C,o){(function(r,c){c(o)})(eo,(function(r){var c="1.9.4";function d(t){var e,i,n,s;for(i=1,n=arguments.length;i<n;i++){s=arguments[i];for(e in s)t[e]=s[e]}return t}var m=Object.create||(function(){function t(){}return function(e){return t.prototype=e,new t}})();function y(t,e){var i=Array.prototype.slice;if(t.bind)return t.bind.apply(t,i.call(arguments,1));var n=i.call(arguments,2);return function(){return t.apply(e,n.length?n.concat(i.call(arguments)):arguments)}}var I=0;function b(t){return"_leaflet_id"in t||(t._leaflet_id=++I),t._leaflet_id}function M(t,e,i){var n,s,a,l;return l=function(){n=!1,s&&(a.apply(i,s),s=!1)},a=function(){n?s=arguments:(t.apply(i,arguments),setTimeout(l,e),n=!0)},a}function Z(t,e,i){var n=e[1],s=e[0],a=n-s;return t===n&&i?t:((t-s)%a+a)%a+s}function g(){return!1}function B(t,e){if(e===!1)return t;var i=Math.pow(10,e===void 0?6:e);return Math.round(t*i)/i}function N(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}function $(t){return N(t).split(/\s+/)}function P(t,e){Object.prototype.hasOwnProperty.call(t,"options")||(t.options=t.options?m(t.options):{});for(var i in e)t.options[i]=e[i];return t.options}function pt(t,e,i){var n=[];for(var s in t)n.push(encodeURIComponent(i?s.toUpperCase():s)+"="+encodeURIComponent(t[s]));return(!e||e.indexOf("?")===-1?"?":"&")+n.join("&")}var ne=/\{ *([\w_ -]+) *\}/g;function Ht(t,e){return t.replace(ne,function(i,n){var s=e[n];if(s===void 0)throw new Error("No value provided for variable "+i);return typeof s=="function"&&(s=s(e)),s})}var at=Array.isArray||function(t){return Object.prototype.toString.call(t)==="[object Array]"};function Pe(t,e){for(var i=0;i<t.length;i++)if(t[i]===e)return i;return-1}var se="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function ke(t){return window["webkit"+t]||window["moz"+t]||window["ms"+t]}var li=0;function ci(t){var e=+new Date,i=Math.max(0,16-(e-li));return li=e+i,window.setTimeout(t,i)}var Se=window.requestAnimationFrame||ke("RequestAnimationFrame")||ci,hi=window.cancelAnimationFrame||ke("CancelAnimationFrame")||ke("CancelRequestAnimationFrame")||function(t){window.clearTimeout(t)};function J(t,e,i){if(i&&Se===ci)t.call(e);else return Se.call(window,y(t,e))}function nt(t){t&&hi.call(window,t)}var Mn={__proto__:null,extend:d,create:m,bind:y,get lastId(){return I},stamp:b,throttle:M,wrapNum:Z,falseFn:g,formatNum:B,trim:N,splitWords:$,setOptions:P,getParamString:pt,template:Ht,isArray:at,indexOf:Pe,emptyImageUrl:se,requestFn:Se,cancelFn:hi,requestAnimFrame:J,cancelAnimFrame:nt};function mt(){}mt.extend=function(t){var e=function(){P(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},i=e.__super__=this.prototype,n=m(i);n.constructor=e,e.prototype=n;for(var s in this)Object.prototype.hasOwnProperty.call(this,s)&&s!=="prototype"&&s!=="__super__"&&(e[s]=this[s]);return t.statics&&d(e,t.statics),t.includes&&(En(t.includes),d.apply(null,[n].concat(t.includes))),d(n,t),delete n.statics,delete n.includes,n.options&&(n.options=i.options?m(i.options):{},d(n.options,t.options)),n._initHooks=[],n.callInitHooks=function(){if(!this._initHooksCalled){i.callInitHooks&&i.callInitHooks.call(this),this._initHooksCalled=!0;for(var a=0,l=n._initHooks.length;a<l;a++)n._initHooks[a].call(this)}},e},mt.include=function(t){var e=this.prototype.options;return d(this.prototype,t),t.options&&(this.prototype.options=e,this.mergeOptions(t.options)),this},mt.mergeOptions=function(t){return d(this.prototype.options,t),this},mt.addInitHook=function(t){var e=Array.prototype.slice.call(arguments,1),i=typeof t=="function"?t:function(){this[t].apply(this,e)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(i),this};function En(t){if(!(typeof L>"u"||!L||!L.Mixin)){t=at(t)?t:[t];for(var e=0;e<t.length;e++)t[e]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",new Error().stack)}}var et={on:function(t,e,i){if(typeof t=="object")for(var n in t)this._on(n,t[n],e);else{t=$(t);for(var s=0,a=t.length;s<a;s++)this._on(t[s],e,i)}return this},off:function(t,e,i){if(!arguments.length)delete this._events;else if(typeof t=="object")for(var n in t)this._off(n,t[n],e);else{t=$(t);for(var s=arguments.length===1,a=0,l=t.length;a<l;a++)s?this._off(t[a]):this._off(t[a],e,i)}return this},_on:function(t,e,i,n){if(typeof e!="function"){console.warn("wrong listener type: "+typeof e);return}if(this._listens(t,e,i)===!1){i===this&&(i=void 0);var s={fn:e,ctx:i};n&&(s.once=!0),this._events=this._events||{},this._events[t]=this._events[t]||[],this._events[t].push(s)}},_off:function(t,e,i){var n,s,a;if(this._events&&(n=this._events[t],!!n)){if(arguments.length===1){if(this._firingCount)for(s=0,a=n.length;s<a;s++)n[s].fn=g;delete this._events[t];return}if(typeof e!="function"){console.warn("wrong listener type: "+typeof e);return}var l=this._listens(t,e,i);if(l!==!1){var h=n[l];this._firingCount&&(h.fn=g,this._events[t]=n=n.slice()),n.splice(l,1)}}},fire:function(t,e,i){if(!this.listens(t,i))return this;var n=d({},e,{type:t,target:this,sourceTarget:e&&e.sourceTarget||this});if(this._events){var s=this._events[t];if(s){this._firingCount=this._firingCount+1||1;for(var a=0,l=s.length;a<l;a++){var h=s[a],u=h.fn;h.once&&this.off(t,u,h.ctx),u.call(h.ctx||this,n)}this._firingCount--}}return i&&this._propagateEvent(n),this},listens:function(t,e,i,n){typeof t!="string"&&console.warn('"string" type argument expected');var s=e;typeof e!="function"&&(n=!!e,s=void 0,i=void 0);var a=this._events&&this._events[t];if(a&&a.length&&this._listens(t,s,i)!==!1)return!0;if(n){for(var l in this._eventParents)if(this._eventParents[l].listens(t,e,i,n))return!0}return!1},_listens:function(t,e,i){if(!this._events)return!1;var n=this._events[t]||[];if(!e)return!!n.length;i===this&&(i=void 0);for(var s=0,a=n.length;s<a;s++)if(n[s].fn===e&&n[s].ctx===i)return s;return!1},once:function(t,e,i){if(typeof t=="object")for(var n in t)this._on(n,t[n],e,!0);else{t=$(t);for(var s=0,a=t.length;s<a;s++)this._on(t[s],e,i,!0)}return this},addEventParent:function(t){return this._eventParents=this._eventParents||{},this._eventParents[b(t)]=t,this},removeEventParent:function(t){return this._eventParents&&delete this._eventParents[b(t)],this},_propagateEvent:function(t){for(var e in this._eventParents)this._eventParents[e].fire(t.type,d({layer:t.target,propagatedFrom:t.target},t),!0)}};et.addEventListener=et.on,et.removeEventListener=et.clearAllEventListeners=et.off,et.addOneTimeEventListener=et.once,et.fireEvent=et.fire,et.hasEventListeners=et.listens;var $t=mt.extend(et);function k(t,e,i){this.x=i?Math.round(t):t,this.y=i?Math.round(e):e}var di=Math.trunc||function(t){return t>0?Math.floor(t):Math.ceil(t)};k.prototype={clone:function(){return new k(this.x,this.y)},add:function(t){return this.clone()._add(T(t))},_add:function(t){return this.x+=t.x,this.y+=t.y,this},subtract:function(t){return this.clone()._subtract(T(t))},_subtract:function(t){return this.x-=t.x,this.y-=t.y,this},divideBy:function(t){return this.clone()._divideBy(t)},_divideBy:function(t){return this.x/=t,this.y/=t,this},multiplyBy:function(t){return this.clone()._multiplyBy(t)},_multiplyBy:function(t){return this.x*=t,this.y*=t,this},scaleBy:function(t){return new k(this.x*t.x,this.y*t.y)},unscaleBy:function(t){return new k(this.x/t.x,this.y/t.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=di(this.x),this.y=di(this.y),this},distanceTo:function(t){t=T(t);var e=t.x-this.x,i=t.y-this.y;return Math.sqrt(e*e+i*i)},equals:function(t){return t=T(t),t.x===this.x&&t.y===this.y},contains:function(t){return t=T(t),Math.abs(t.x)<=Math.abs(this.x)&&Math.abs(t.y)<=Math.abs(this.y)},toString:function(){return"Point("+B(this.x)+", "+B(this.y)+")"}};function T(t,e,i){return t instanceof k?t:at(t)?new k(t[0],t[1]):t==null?t:typeof t=="object"&&"x"in t&&"y"in t?new k(t.x,t.y):new k(t,e,i)}function F(t,e){if(t)for(var i=e?[t,e]:t,n=0,s=i.length;n<s;n++)this.extend(i[n])}F.prototype={extend:function(t){var e,i;if(!t)return this;if(t instanceof k||typeof t[0]=="number"||"x"in t)e=i=T(t);else if(t=X(t),e=t.min,i=t.max,!e||!i)return this;return!this.min&&!this.max?(this.min=e.clone(),this.max=i.clone()):(this.min.x=Math.min(e.x,this.min.x),this.max.x=Math.max(i.x,this.max.x),this.min.y=Math.min(e.y,this.min.y),this.max.y=Math.max(i.y,this.max.y)),this},getCenter:function(t){return T((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,t)},getBottomLeft:function(){return T(this.min.x,this.max.y)},getTopRight:function(){return T(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(t){var e,i;return typeof t[0]=="number"||t instanceof k?t=T(t):t=X(t),t instanceof F?(e=t.min,i=t.max):e=i=t,e.x>=this.min.x&&i.x<=this.max.x&&e.y>=this.min.y&&i.y<=this.max.y},intersects:function(t){t=X(t);var e=this.min,i=this.max,n=t.min,s=t.max,a=s.x>=e.x&&n.x<=i.x,l=s.y>=e.y&&n.y<=i.y;return a&&l},overlaps:function(t){t=X(t);var e=this.min,i=this.max,n=t.min,s=t.max,a=s.x>e.x&&n.x<i.x,l=s.y>e.y&&n.y<i.y;return a&&l},isValid:function(){return!!(this.min&&this.max)},pad:function(t){var e=this.min,i=this.max,n=Math.abs(e.x-i.x)*t,s=Math.abs(e.y-i.y)*t;return X(T(e.x-n,e.y-s),T(i.x+n,i.y+s))},equals:function(t){return t?(t=X(t),this.min.equals(t.getTopLeft())&&this.max.equals(t.getBottomRight())):!1}};function X(t,e){return!t||t instanceof F?t:new F(t,e)}function Q(t,e){if(t)for(var i=e?[t,e]:t,n=0,s=i.length;n<s;n++)this.extend(i[n])}Q.prototype={extend:function(t){var e=this._southWest,i=this._northEast,n,s;if(t instanceof R)n=t,s=t;else if(t instanceof Q){if(n=t._southWest,s=t._northEast,!n||!s)return this}else return t?this.extend(O(t)||q(t)):this;return!e&&!i?(this._southWest=new R(n.lat,n.lng),this._northEast=new R(s.lat,s.lng)):(e.lat=Math.min(n.lat,e.lat),e.lng=Math.min(n.lng,e.lng),i.lat=Math.max(s.lat,i.lat),i.lng=Math.max(s.lng,i.lng)),this},pad:function(t){var e=this._southWest,i=this._northEast,n=Math.abs(e.lat-i.lat)*t,s=Math.abs(e.lng-i.lng)*t;return new Q(new R(e.lat-n,e.lng-s),new R(i.lat+n,i.lng+s))},getCenter:function(){return new R((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new R(this.getNorth(),this.getWest())},getSouthEast:function(){return new R(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(t){typeof t[0]=="number"||t instanceof R||"lat"in t?t=O(t):t=q(t);var e=this._southWest,i=this._northEast,n,s;return t instanceof Q?(n=t.getSouthWest(),s=t.getNorthEast()):n=s=t,n.lat>=e.lat&&s.lat<=i.lat&&n.lng>=e.lng&&s.lng<=i.lng},intersects:function(t){t=q(t);var e=this._southWest,i=this._northEast,n=t.getSouthWest(),s=t.getNorthEast(),a=s.lat>=e.lat&&n.lat<=i.lat,l=s.lng>=e.lng&&n.lng<=i.lng;return a&&l},overlaps:function(t){t=q(t);var e=this._southWest,i=this._northEast,n=t.getSouthWest(),s=t.getNorthEast(),a=s.lat>e.lat&&n.lat<i.lat,l=s.lng>e.lng&&n.lng<i.lng;return a&&l},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(t,e){return t?(t=q(t),this._southWest.equals(t.getSouthWest(),e)&&this._northEast.equals(t.getNorthEast(),e)):!1},isValid:function(){return!!(this._southWest&&this._northEast)}};function q(t,e){return t instanceof Q?t:new Q(t,e)}function R(t,e,i){if(isNaN(t)||isNaN(e))throw new Error("Invalid LatLng object: ("+t+", "+e+")");this.lat=+t,this.lng=+e,i!==void 0&&(this.alt=+i)}R.prototype={equals:function(t,e){if(!t)return!1;t=O(t);var i=Math.max(Math.abs(this.lat-t.lat),Math.abs(this.lng-t.lng));return i<=(e===void 0?1e-9:e)},toString:function(t){return"LatLng("+B(this.lat,t)+", "+B(this.lng,t)+")"},distanceTo:function(t){return xt.distance(this,O(t))},wrap:function(){return xt.wrapLatLng(this)},toBounds:function(t){var e=180*t/40075017,i=e/Math.cos(Math.PI/180*this.lat);return q([this.lat-e,this.lng-i],[this.lat+e,this.lng+i])},clone:function(){return new R(this.lat,this.lng,this.alt)}};function O(t,e,i){return t instanceof R?t:at(t)&&typeof t[0]!="object"?t.length===3?new R(t[0],t[1],t[2]):t.length===2?new R(t[0],t[1]):null:t==null?t:typeof t=="object"&&"lat"in t?new R(t.lat,"lng"in t?t.lng:t.lon,t.alt):e===void 0?null:new R(t,e,i)}var _t={latLngToPoint:function(t,e){var i=this.projection.project(t),n=this.scale(e);return this.transformation._transform(i,n)},pointToLatLng:function(t,e){var i=this.scale(e),n=this.transformation.untransform(t,i);return this.projection.unproject(n)},project:function(t){return this.projection.project(t)},unproject:function(t){return this.projection.unproject(t)},scale:function(t){return 256*Math.pow(2,t)},zoom:function(t){return Math.log(t/256)/Math.LN2},getProjectedBounds:function(t){if(this.infinite)return null;var e=this.projection.bounds,i=this.scale(t),n=this.transformation.transform(e.min,i),s=this.transformation.transform(e.max,i);return new F(n,s)},infinite:!1,wrapLatLng:function(t){var e=this.wrapLng?Z(t.lng,this.wrapLng,!0):t.lng,i=this.wrapLat?Z(t.lat,this.wrapLat,!0):t.lat,n=t.alt;return new R(i,e,n)},wrapLatLngBounds:function(t){var e=t.getCenter(),i=this.wrapLatLng(e),n=e.lat-i.lat,s=e.lng-i.lng;if(n===0&&s===0)return t;var a=t.getSouthWest(),l=t.getNorthEast(),h=new R(a.lat-n,a.lng-s),u=new R(l.lat-n,l.lng-s);return new Q(h,u)}},xt=d({},_t,{wrapLng:[-180,180],R:6371e3,distance:function(t,e){var i=Math.PI/180,n=t.lat*i,s=e.lat*i,a=Math.sin((e.lat-t.lat)*i/2),l=Math.sin((e.lng-t.lng)*i/2),h=a*a+Math.cos(n)*Math.cos(s)*l*l,u=2*Math.atan2(Math.sqrt(h),Math.sqrt(1-h));return this.R*u}}),ui=6378137,Me={R:ui,MAX_LATITUDE:85.0511287798,project:function(t){var e=Math.PI/180,i=this.MAX_LATITUDE,n=Math.max(Math.min(i,t.lat),-i),s=Math.sin(n*e);return new k(this.R*t.lng*e,this.R*Math.log((1+s)/(1-s))/2)},unproject:function(t){var e=180/Math.PI;return new R((2*Math.atan(Math.exp(t.y/this.R))-Math.PI/2)*e,t.x*e/this.R)},bounds:(function(){var t=ui*Math.PI;return new F([-t,-t],[t,t])})()};function Ee(t,e,i,n){if(at(t)){this._a=t[0],this._b=t[1],this._c=t[2],this._d=t[3];return}this._a=t,this._b=e,this._c=i,this._d=n}Ee.prototype={transform:function(t,e){return this._transform(t.clone(),e)},_transform:function(t,e){return e=e||1,t.x=e*(this._a*t.x+this._b),t.y=e*(this._c*t.y+this._d),t},untransform:function(t,e){return e=e||1,new k((t.x/e-this._b)/this._a,(t.y/e-this._d)/this._c)}};function Ft(t,e,i,n){return new Ee(t,e,i,n)}var Ce=d({},xt,{code:"EPSG:3857",projection:Me,transformation:(function(){var t=.5/(Math.PI*Me.R);return Ft(t,.5,-t,.5)})()}),Cn=d({},Ce,{code:"EPSG:900913"});function fi(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function pi(t,e){var i="",n,s,a,l,h,u;for(n=0,a=t.length;n<a;n++){for(h=t[n],s=0,l=h.length;s<l;s++)u=h[s],i+=(s?"L":"M")+u.x+" "+u.y;i+=e?x.svg?"z":"x":""}return i||"M0 0"}var Ae=document.documentElement.style,oe="ActiveXObject"in window,An=oe&&!document.addEventListener,mi="msLaunchUri"in navigator&&!("documentMode"in document),Ie=ht("webkit"),_i=ht("android"),gi=ht("android 2")||ht("android 3"),In=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),On=_i&&ht("Google")&&In<537&&!("AudioNode"in window),Oe=!!window.opera,vi=!mi&&ht("chrome"),yi=ht("gecko")&&!Ie&&!Oe&&!oe,zn=!vi&&ht("safari"),bi=ht("phantom"),xi="OTransition"in Ae,Bn=navigator.platform.indexOf("Win")===0,wi=oe&&"transition"in Ae,ze="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!gi,Li="MozPerspective"in Ae,Dn=!window.L_DISABLE_3D&&(wi||ze||Li)&&!xi&&!bi,Ut=typeof orientation<"u"||ht("mobile"),Nn=Ut&&Ie,Rn=Ut&&ze,Ti=!window.PointerEvent&&window.MSPointerEvent,Pi=!!(window.PointerEvent||Ti),ki="ontouchstart"in window||!!window.TouchEvent,Zn=!window.L_NO_TOUCH&&(ki||Pi),Hn=Ut&&Oe,$n=Ut&&yi,Fn=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,Un=(function(){var t=!1;try{var e=Object.defineProperty({},"passive",{get:function(){t=!0}});window.addEventListener("testPassiveEventSupport",g,e),window.removeEventListener("testPassiveEventSupport",g,e)}catch{}return t})(),Wn=(function(){return!!document.createElement("canvas").getContext})(),Be=!!(document.createElementNS&&fi("svg").createSVGRect),qn=!!Be&&(function(){var t=document.createElement("div");return t.innerHTML="<svg/>",(t.firstChild&&t.firstChild.namespaceURI)==="http://www.w3.org/2000/svg"})(),jn=!Be&&(function(){try{var t=document.createElement("div");t.innerHTML='<v:shape adj="1"/>';var e=t.firstChild;return e.style.behavior="url(#default#VML)",e&&typeof e.adj=="object"}catch{return!1}})(),Vn=navigator.platform.indexOf("Mac")===0,Gn=navigator.platform.indexOf("Linux")===0;function ht(t){return navigator.userAgent.toLowerCase().indexOf(t)>=0}var x={ie:oe,ielt9:An,edge:mi,webkit:Ie,android:_i,android23:gi,androidStock:On,opera:Oe,chrome:vi,gecko:yi,safari:zn,phantom:bi,opera12:xi,win:Bn,ie3d:wi,webkit3d:ze,gecko3d:Li,any3d:Dn,mobile:Ut,mobileWebkit:Nn,mobileWebkit3d:Rn,msPointer:Ti,pointer:Pi,touch:Zn,touchNative:ki,mobileOpera:Hn,mobileGecko:$n,retina:Fn,passiveEvents:Un,canvas:Wn,svg:Be,vml:jn,inlineSvg:qn,mac:Vn,linux:Gn},Si=x.msPointer?"MSPointerDown":"pointerdown",Mi=x.msPointer?"MSPointerMove":"pointermove",Ei=x.msPointer?"MSPointerUp":"pointerup",Ci=x.msPointer?"MSPointerCancel":"pointercancel",De={touchstart:Si,touchmove:Mi,touchend:Ei,touchcancel:Ci},Ai={touchstart:ts,touchmove:re,touchend:re,touchcancel:re},Ct={},Ii=!1;function Yn(t,e,i){return e==="touchstart"&&Qn(),Ai[e]?(i=Ai[e].bind(this,i),t.addEventListener(De[e],i,!1),i):(console.warn("wrong event specified:",e),g)}function Kn(t,e,i){if(!De[e]){console.warn("wrong event specified:",e);return}t.removeEventListener(De[e],i,!1)}function Jn(t){Ct[t.pointerId]=t}function Xn(t){Ct[t.pointerId]&&(Ct[t.pointerId]=t)}function Oi(t){delete Ct[t.pointerId]}function Qn(){Ii||(document.addEventListener(Si,Jn,!0),document.addEventListener(Mi,Xn,!0),document.addEventListener(Ei,Oi,!0),document.addEventListener(Ci,Oi,!0),Ii=!0)}function re(t,e){if(e.pointerType!==(e.MSPOINTER_TYPE_MOUSE||"mouse")){e.touches=[];for(var i in Ct)e.touches.push(Ct[i]);e.changedTouches=[e],t(e)}}function ts(t,e){e.MSPOINTER_TYPE_TOUCH&&e.pointerType===e.MSPOINTER_TYPE_TOUCH&&Y(e),re(t,e)}function es(t){var e={},i,n;for(n in t)i=t[n],e[n]=i&&i.bind?i.bind(t):i;return t=e,e.type="dblclick",e.detail=2,e.isTrusted=!1,e._simulated=!0,e}var is=200;function ns(t,e){t.addEventListener("dblclick",e);var i=0,n;function s(a){if(a.detail!==1){n=a.detail;return}if(!(a.pointerType==="mouse"||a.sourceCapabilities&&!a.sourceCapabilities.firesTouchEvents)){var l=Ri(a);if(!(l.some(function(u){return u instanceof HTMLLabelElement&&u.attributes.for})&&!l.some(function(u){return u instanceof HTMLInputElement||u instanceof HTMLSelectElement}))){var h=Date.now();h-i<=is?(n++,n===2&&e(es(a))):n=1,i=h}}}return t.addEventListener("click",s),{dblclick:e,simDblclick:s}}function ss(t,e){t.removeEventListener("dblclick",e.dblclick),t.removeEventListener("click",e.simDblclick)}var Ne=ce(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),Wt=ce(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),zi=Wt==="webkitTransition"||Wt==="OTransition"?Wt+"End":"transitionend";function Bi(t){return typeof t=="string"?document.getElementById(t):t}function qt(t,e){var i=t.style[e]||t.currentStyle&&t.currentStyle[e];if((!i||i==="auto")&&document.defaultView){var n=document.defaultView.getComputedStyle(t,null);i=n?n[e]:null}return i==="auto"?null:i}function D(t,e,i){var n=document.createElement(t);return n.className=e||"",i&&i.appendChild(n),n}function U(t){var e=t.parentNode;e&&e.removeChild(t)}function ae(t){for(;t.firstChild;)t.removeChild(t.firstChild)}function At(t){var e=t.parentNode;e&&e.lastChild!==t&&e.appendChild(t)}function It(t){var e=t.parentNode;e&&e.firstChild!==t&&e.insertBefore(t,e.firstChild)}function Re(t,e){if(t.classList!==void 0)return t.classList.contains(e);var i=le(t);return i.length>0&&new RegExp("(^|\\s)"+e+"(\\s|$)").test(i)}function E(t,e){if(t.classList!==void 0)for(var i=$(e),n=0,s=i.length;n<s;n++)t.classList.add(i[n]);else if(!Re(t,e)){var a=le(t);Ze(t,(a?a+" ":"")+e)}}function W(t,e){t.classList!==void 0?t.classList.remove(e):Ze(t,N((" "+le(t)+" ").replace(" "+e+" "," ")))}function Ze(t,e){t.className.baseVal===void 0?t.className=e:t.className.baseVal=e}function le(t){return t.correspondingElement&&(t=t.correspondingElement),t.className.baseVal===void 0?t.className:t.className.baseVal}function st(t,e){"opacity"in t.style?t.style.opacity=e:"filter"in t.style&&os(t,e)}function os(t,e){var i=!1,n="DXImageTransform.Microsoft.Alpha";try{i=t.filters.item(n)}catch{if(e===1)return}e=Math.round(e*100),i?(i.Enabled=e!==100,i.Opacity=e):t.style.filter+=" progid:"+n+"(opacity="+e+")"}function ce(t){for(var e=document.documentElement.style,i=0;i<t.length;i++)if(t[i]in e)return t[i];return!1}function Tt(t,e,i){var n=e||new k(0,0);t.style[Ne]=(x.ie3d?"translate("+n.x+"px,"+n.y+"px)":"translate3d("+n.x+"px,"+n.y+"px,0)")+(i?" scale("+i+")":"")}function j(t,e){t._leaflet_pos=e,x.any3d?Tt(t,e):(t.style.left=e.x+"px",t.style.top=e.y+"px")}function Pt(t){return t._leaflet_pos||new k(0,0)}var jt,Vt,He;if("onselectstart"in document)jt=function(){S(window,"selectstart",Y)},Vt=function(){H(window,"selectstart",Y)};else{var Gt=ce(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);jt=function(){if(Gt){var t=document.documentElement.style;He=t[Gt],t[Gt]="none"}},Vt=function(){Gt&&(document.documentElement.style[Gt]=He,He=void 0)}}function $e(){S(window,"dragstart",Y)}function Fe(){H(window,"dragstart",Y)}var he,Ue;function We(t){for(;t.tabIndex===-1;)t=t.parentNode;t.style&&(de(),he=t,Ue=t.style.outlineStyle,t.style.outlineStyle="none",S(window,"keydown",de))}function de(){he&&(he.style.outlineStyle=Ue,he=void 0,Ue=void 0,H(window,"keydown",de))}function Di(t){do t=t.parentNode;while((!t.offsetWidth||!t.offsetHeight)&&t!==document.body);return t}function qe(t){var e=t.getBoundingClientRect();return{x:e.width/t.offsetWidth||1,y:e.height/t.offsetHeight||1,boundingClientRect:e}}var rs={__proto__:null,TRANSFORM:Ne,TRANSITION:Wt,TRANSITION_END:zi,get:Bi,getStyle:qt,create:D,remove:U,empty:ae,toFront:At,toBack:It,hasClass:Re,addClass:E,removeClass:W,setClass:Ze,getClass:le,setOpacity:st,testProp:ce,setTransform:Tt,setPosition:j,getPosition:Pt,get disableTextSelection(){return jt},get enableTextSelection(){return Vt},disableImageDrag:$e,enableImageDrag:Fe,preventOutline:We,restoreOutline:de,getSizedParentNode:Di,getScale:qe};function S(t,e,i,n){if(e&&typeof e=="object")for(var s in e)Ve(t,s,e[s],i);else{e=$(e);for(var a=0,l=e.length;a<l;a++)Ve(t,e[a],i,n)}return this}var dt="_leaflet_events";function H(t,e,i,n){if(arguments.length===1)Ni(t),delete t[dt];else if(e&&typeof e=="object")for(var s in e)Ge(t,s,e[s],i);else if(e=$(e),arguments.length===2)Ni(t,function(h){return Pe(e,h)!==-1});else for(var a=0,l=e.length;a<l;a++)Ge(t,e[a],i,n);return this}function Ni(t,e){for(var i in t[dt]){var n=i.split(/\d/)[0];(!e||e(n))&&Ge(t,n,null,null,i)}}var je={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function Ve(t,e,i,n){var s=e+b(i)+(n?"_"+b(n):"");if(t[dt]&&t[dt][s])return this;var a=function(h){return i.call(n||t,h||window.event)},l=a;!x.touchNative&&x.pointer&&e.indexOf("touch")===0?a=Yn(t,e,a):x.touch&&e==="dblclick"?a=ns(t,a):"addEventListener"in t?e==="touchstart"||e==="touchmove"||e==="wheel"||e==="mousewheel"?t.addEventListener(je[e]||e,a,x.passiveEvents?{passive:!1}:!1):e==="mouseenter"||e==="mouseleave"?(a=function(h){h=h||window.event,Ke(t,h)&&l(h)},t.addEventListener(je[e],a,!1)):t.addEventListener(e,l,!1):t.attachEvent("on"+e,a),t[dt]=t[dt]||{},t[dt][s]=a}function Ge(t,e,i,n,s){s=s||e+b(i)+(n?"_"+b(n):"");var a=t[dt]&&t[dt][s];if(!a)return this;!x.touchNative&&x.pointer&&e.indexOf("touch")===0?Kn(t,e,a):x.touch&&e==="dblclick"?ss(t,a):"removeEventListener"in t?t.removeEventListener(je[e]||e,a,!1):t.detachEvent("on"+e,a),t[dt][s]=null}function kt(t){return t.stopPropagation?t.stopPropagation():t.originalEvent?t.originalEvent._stopped=!0:t.cancelBubble=!0,this}function Ye(t){return Ve(t,"wheel",kt),this}function Yt(t){return S(t,"mousedown touchstart dblclick contextmenu",kt),t._leaflet_disable_click=!0,this}function Y(t){return t.preventDefault?t.preventDefault():t.returnValue=!1,this}function St(t){return Y(t),kt(t),this}function Ri(t){if(t.composedPath)return t.composedPath();for(var e=[],i=t.target;i;)e.push(i),i=i.parentNode;return e}function Zi(t,e){if(!e)return new k(t.clientX,t.clientY);var i=qe(e),n=i.boundingClientRect;return new k((t.clientX-n.left)/i.x-e.clientLeft,(t.clientY-n.top)/i.y-e.clientTop)}var as=x.linux&&x.chrome?window.devicePixelRatio:x.mac?window.devicePixelRatio*3:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function Hi(t){return x.edge?t.wheelDeltaY/2:t.deltaY&&t.deltaMode===0?-t.deltaY/as:t.deltaY&&t.deltaMode===1?-t.deltaY*20:t.deltaY&&t.deltaMode===2?-t.deltaY*60:t.deltaX||t.deltaZ?0:t.wheelDelta?(t.wheelDeltaY||t.wheelDelta)/2:t.detail&&Math.abs(t.detail)<32765?-t.detail*20:t.detail?t.detail/-32765*60:0}function Ke(t,e){var i=e.relatedTarget;if(!i)return!0;try{for(;i&&i!==t;)i=i.parentNode}catch{return!1}return i!==t}var ls={__proto__:null,on:S,off:H,stopPropagation:kt,disableScrollPropagation:Ye,disableClickPropagation:Yt,preventDefault:Y,stop:St,getPropagationPath:Ri,getMousePosition:Zi,getWheelDelta:Hi,isExternalTarget:Ke,addListener:S,removeListener:H},$i=$t.extend({run:function(t,e,i,n){this.stop(),this._el=t,this._inProgress=!0,this._duration=i||.25,this._easeOutPower=1/Math.max(n||.5,.2),this._startPos=Pt(t),this._offset=e.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=J(this._animate,this),this._step()},_step:function(t){var e=+new Date-this._startTime,i=this._duration*1e3;e<i?this._runFrame(this._easeOut(e/i),t):(this._runFrame(1),this._complete())},_runFrame:function(t,e){var i=this._startPos.add(this._offset.multiplyBy(t));e&&i._round(),j(this._el,i),this.fire("step")},_complete:function(){nt(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(t){return 1-Math.pow(1-t,this._easeOutPower)}}),z=$t.extend({options:{crs:Ce,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(t,e){e=P(this,e),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(t),this._initLayout(),this._onResize=y(this._onResize,this),this._initEvents(),e.maxBounds&&this.setMaxBounds(e.maxBounds),e.zoom!==void 0&&(this._zoom=this._limitZoom(e.zoom)),e.center&&e.zoom!==void 0&&this.setView(O(e.center),e.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=Wt&&x.any3d&&!x.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),S(this._proxy,zi,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(t,e,i){if(e=e===void 0?this._zoom:this._limitZoom(e),t=this._limitCenter(O(t),e,this.options.maxBounds),i=i||{},this._stop(),this._loaded&&!i.reset&&i!==!0){i.animate!==void 0&&(i.zoom=d({animate:i.animate},i.zoom),i.pan=d({animate:i.animate,duration:i.duration},i.pan));var n=this._zoom!==e?this._tryAnimatedZoom&&this._tryAnimatedZoom(t,e,i.zoom):this._tryAnimatedPan(t,i.pan);if(n)return clearTimeout(this._sizeTimer),this}return this._resetView(t,e,i.pan&&i.pan.noMoveStart),this},setZoom:function(t,e){return this._loaded?this.setView(this.getCenter(),t,{zoom:e}):(this._zoom=t,this)},zoomIn:function(t,e){return t=t||(x.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+t,e)},zoomOut:function(t,e){return t=t||(x.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-t,e)},setZoomAround:function(t,e,i){var n=this.getZoomScale(e),s=this.getSize().divideBy(2),a=t instanceof k?t:this.latLngToContainerPoint(t),l=a.subtract(s).multiplyBy(1-1/n),h=this.containerPointToLatLng(s.add(l));return this.setView(h,e,{zoom:i})},_getBoundsCenterZoom:function(t,e){e=e||{},t=t.getBounds?t.getBounds():q(t);var i=T(e.paddingTopLeft||e.padding||[0,0]),n=T(e.paddingBottomRight||e.padding||[0,0]),s=this.getBoundsZoom(t,!1,i.add(n));if(s=typeof e.maxZoom=="number"?Math.min(e.maxZoom,s):s,s===1/0)return{center:t.getCenter(),zoom:s};var a=n.subtract(i).divideBy(2),l=this.project(t.getSouthWest(),s),h=this.project(t.getNorthEast(),s),u=this.unproject(l.add(h).divideBy(2).add(a),s);return{center:u,zoom:s}},fitBounds:function(t,e){if(t=q(t),!t.isValid())throw new Error("Bounds are not valid.");var i=this._getBoundsCenterZoom(t,e);return this.setView(i.center,i.zoom,e)},fitWorld:function(t){return this.fitBounds([[-90,-180],[90,180]],t)},panTo:function(t,e){return this.setView(t,this._zoom,{pan:e})},panBy:function(t,e){if(t=T(t).round(),e=e||{},!t.x&&!t.y)return this.fire("moveend");if(e.animate!==!0&&!this.getSize().contains(t))return this._resetView(this.unproject(this.project(this.getCenter()).add(t)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new $i,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),e.noMoveStart||this.fire("movestart"),e.animate!==!1){E(this._mapPane,"leaflet-pan-anim");var i=this._getMapPanePos().subtract(t).round();this._panAnim.run(this._mapPane,i,e.duration||.25,e.easeLinearity)}else this._rawPanBy(t),this.fire("move").fire("moveend");return this},flyTo:function(t,e,i){if(i=i||{},i.animate===!1||!x.any3d)return this.setView(t,e,i);this._stop();var n=this.project(this.getCenter()),s=this.project(t),a=this.getSize(),l=this._zoom;t=O(t),e=e===void 0?l:e;var h=Math.max(a.x,a.y),u=h*this.getZoomScale(l,e),f=s.distanceTo(n)||1,v=1.42,w=v*v;function A(V){var Le=V?-1:1,Ks=V?u:h,Js=u*u-h*h+Le*w*w*f*f,Xs=2*Ks*w*f,ai=Js/Xs,wn=Math.sqrt(ai*ai+1)-ai,Qs=wn<1e-9?-18:Math.log(wn);return Qs}function K(V){return(Math.exp(V)-Math.exp(-V))/2}function G(V){return(Math.exp(V)+Math.exp(-V))/2}function rt(V){return K(V)/G(V)}var tt=A(0);function Rt(V){return h*(G(tt)/G(tt+v*V))}function js(V){return h*(G(tt)*rt(tt+v*V)-K(tt))/w}function Vs(V){return 1-Math.pow(1-V,1.5)}var Gs=Date.now(),bn=(A(1)-tt)/v,Ys=i.duration?1e3*i.duration:1e3*bn*.8;function xn(){var V=(Date.now()-Gs)/Ys,Le=Vs(V)*bn;V<=1?(this._flyToFrame=J(xn,this),this._move(this.unproject(n.add(s.subtract(n).multiplyBy(js(Le)/f)),l),this.getScaleZoom(h/Rt(Le),l),{flyTo:!0})):this._move(t,e)._moveEnd(!0)}return this._moveStart(!0,i.noMoveStart),xn.call(this),this},flyToBounds:function(t,e){var i=this._getBoundsCenterZoom(t,e);return this.flyTo(i.center,i.zoom,e)},setMaxBounds:function(t){return t=q(t),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),t.isValid()?(this.options.maxBounds=t,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(t){var e=this.options.minZoom;return this.options.minZoom=t,this._loaded&&e!==t&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(t):this},setMaxZoom:function(t){var e=this.options.maxZoom;return this.options.maxZoom=t,this._loaded&&e!==t&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(t):this},panInsideBounds:function(t,e){this._enforcingBounds=!0;var i=this.getCenter(),n=this._limitCenter(i,this._zoom,q(t));return i.equals(n)||this.panTo(n,e),this._enforcingBounds=!1,this},panInside:function(t,e){e=e||{};var i=T(e.paddingTopLeft||e.padding||[0,0]),n=T(e.paddingBottomRight||e.padding||[0,0]),s=this.project(this.getCenter()),a=this.project(t),l=this.getPixelBounds(),h=X([l.min.add(i),l.max.subtract(n)]),u=h.getSize();if(!h.contains(a)){this._enforcingBounds=!0;var f=a.subtract(h.getCenter()),v=h.extend(a).getSize().subtract(u);s.x+=f.x<0?-v.x:v.x,s.y+=f.y<0?-v.y:v.y,this.panTo(this.unproject(s),e),this._enforcingBounds=!1}return this},invalidateSize:function(t){if(!this._loaded)return this;t=d({animate:!1,pan:!0},t===!0?{animate:!0}:t);var e=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var i=this.getSize(),n=e.divideBy(2).round(),s=i.divideBy(2).round(),a=n.subtract(s);return!a.x&&!a.y?this:(t.animate&&t.pan?this.panBy(a):(t.pan&&this._rawPanBy(a),this.fire("move"),t.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(y(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:e,newSize:i}))},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(t){if(t=this._locateOptions=d({timeout:1e4,watch:!1},t),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var e=y(this._handleGeolocationResponse,this),i=y(this._handleGeolocationError,this);return t.watch?this._locationWatchId=navigator.geolocation.watchPosition(e,i,t):navigator.geolocation.getCurrentPosition(e,i,t),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(t){if(this._container._leaflet_id){var e=t.code,i=t.message||(e===1?"permission denied":e===2?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:e,message:"Geolocation error: "+i+"."})}},_handleGeolocationResponse:function(t){if(this._container._leaflet_id){var e=t.coords.latitude,i=t.coords.longitude,n=new R(e,i),s=n.toBounds(t.coords.accuracy*2),a=this._locateOptions;if(a.setView){var l=this.getBoundsZoom(s);this.setView(n,a.maxZoom?Math.min(l,a.maxZoom):l)}var h={latlng:n,bounds:s,timestamp:t.timestamp};for(var u in t.coords)typeof t.coords[u]=="number"&&(h[u]=t.coords[u]);this.fire("locationfound",h)}},addHandler:function(t,e){if(!e)return this;var i=this[t]=new e(this);return this._handlers.push(i),this.options[t]&&i.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch{this._container._leaflet_id=void 0,this._containerId=void 0}this._locationWatchId!==void 0&&this.stopLocate(),this._stop(),U(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(nt(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload");var t;for(t in this._layers)this._layers[t].remove();for(t in this._panes)U(this._panes[t]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(t,e){var i="leaflet-pane"+(t?" leaflet-"+t.replace("Pane","")+"-pane":""),n=D("div",i,e||this._mapPane);return t&&(this._panes[t]=n),n},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var t=this.getPixelBounds(),e=this.unproject(t.getBottomLeft()),i=this.unproject(t.getTopRight());return new Q(e,i)},getMinZoom:function(){return this.options.minZoom===void 0?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===void 0?this._layersMaxZoom===void 0?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(t,e,i){t=q(t),i=T(i||[0,0]);var n=this.getZoom()||0,s=this.getMinZoom(),a=this.getMaxZoom(),l=t.getNorthWest(),h=t.getSouthEast(),u=this.getSize().subtract(i),f=X(this.project(h,n),this.project(l,n)).getSize(),v=x.any3d?this.options.zoomSnap:1,w=u.x/f.x,A=u.y/f.y,K=e?Math.max(w,A):Math.min(w,A);return n=this.getScaleZoom(K,n),v&&(n=Math.round(n/(v/100))*(v/100),n=e?Math.ceil(n/v)*v:Math.floor(n/v)*v),Math.max(s,Math.min(a,n))},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new k(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(t,e){var i=this._getTopLeftPoint(t,e);return new F(i,i.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(t){return this.options.crs.getProjectedBounds(t===void 0?this.getZoom():t)},getPane:function(t){return typeof t=="string"?this._panes[t]:t},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(t,e){var i=this.options.crs;return e=e===void 0?this._zoom:e,i.scale(t)/i.scale(e)},getScaleZoom:function(t,e){var i=this.options.crs;e=e===void 0?this._zoom:e;var n=i.zoom(t*i.scale(e));return isNaN(n)?1/0:n},project:function(t,e){return e=e===void 0?this._zoom:e,this.options.crs.latLngToPoint(O(t),e)},unproject:function(t,e){return e=e===void 0?this._zoom:e,this.options.crs.pointToLatLng(T(t),e)},layerPointToLatLng:function(t){var e=T(t).add(this.getPixelOrigin());return this.unproject(e)},latLngToLayerPoint:function(t){var e=this.project(O(t))._round();return e._subtract(this.getPixelOrigin())},wrapLatLng:function(t){return this.options.crs.wrapLatLng(O(t))},wrapLatLngBounds:function(t){return this.options.crs.wrapLatLngBounds(q(t))},distance:function(t,e){return this.options.crs.distance(O(t),O(e))},containerPointToLayerPoint:function(t){return T(t).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(t){return T(t).add(this._getMapPanePos())},containerPointToLatLng:function(t){var e=this.containerPointToLayerPoint(T(t));return this.layerPointToLatLng(e)},latLngToContainerPoint:function(t){return this.layerPointToContainerPoint(this.latLngToLayerPoint(O(t)))},mouseEventToContainerPoint:function(t){return Zi(t,this._container)},mouseEventToLayerPoint:function(t){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(t))},mouseEventToLatLng:function(t){return this.layerPointToLatLng(this.mouseEventToLayerPoint(t))},_initContainer:function(t){var e=this._container=Bi(t);if(e){if(e._leaflet_id)throw new Error("Map container is already initialized.")}else throw new Error("Map container not found.");S(e,"scroll",this._onScroll,this),this._containerId=b(e)},_initLayout:function(){var t=this._container;this._fadeAnimated=this.options.fadeAnimation&&x.any3d,E(t,"leaflet-container"+(x.touch?" leaflet-touch":"")+(x.retina?" leaflet-retina":"")+(x.ielt9?" leaflet-oldie":"")+(x.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var e=qt(t,"position");e!=="absolute"&&e!=="relative"&&e!=="fixed"&&e!=="sticky"&&(t.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var t=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),j(this._mapPane,new k(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(E(t.markerPane,"leaflet-zoom-hide"),E(t.shadowPane,"leaflet-zoom-hide"))},_resetView:function(t,e,i){j(this._mapPane,new k(0,0));var n=!this._loaded;this._loaded=!0,e=this._limitZoom(e),this.fire("viewprereset");var s=this._zoom!==e;this._moveStart(s,i)._move(t,e)._moveEnd(s),this.fire("viewreset"),n&&this.fire("load")},_moveStart:function(t,e){return t&&this.fire("zoomstart"),e||this.fire("movestart"),this},_move:function(t,e,i,n){e===void 0&&(e=this._zoom);var s=this._zoom!==e;return this._zoom=e,this._lastCenter=t,this._pixelOrigin=this._getNewPixelOrigin(t),n?i&&i.pinch&&this.fire("zoom",i):((s||i&&i.pinch)&&this.fire("zoom",i),this.fire("move",i)),this},_moveEnd:function(t){return t&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return nt(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(t){j(this._mapPane,this._getMapPanePos().subtract(t))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(t){this._targets={},this._targets[b(this._container)]=this;var e=t?H:S;e(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&e(window,"resize",this._onResize,this),x.any3d&&this.options.transform3DLimit&&(t?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){nt(this._resizeRequest),this._resizeRequest=J(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var t=this._getMapPanePos();Math.max(Math.abs(t.x),Math.abs(t.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(t,e){for(var i=[],n,s=e==="mouseout"||e==="mouseover",a=t.target||t.srcElement,l=!1;a;){if(n=this._targets[b(a)],n&&(e==="click"||e==="preclick")&&this._draggableMoved(n)){l=!0;break}if(n&&n.listens(e,!0)&&(s&&!Ke(a,t)||(i.push(n),s))||a===this._container)break;a=a.parentNode}return!i.length&&!l&&!s&&this.listens(e,!0)&&(i=[this]),i},_isClickDisabled:function(t){for(;t&&t!==this._container;){if(t._leaflet_disable_click)return!0;t=t.parentNode}},_handleDOMEvent:function(t){var e=t.target||t.srcElement;if(!(!this._loaded||e._leaflet_disable_events||t.type==="click"&&this._isClickDisabled(e))){var i=t.type;i==="mousedown"&&We(e),this._fireDOMEvent(t,i)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(t,e,i){if(t.type==="click"){var n=d({},t);n.type="preclick",this._fireDOMEvent(n,n.type,i)}var s=this._findEventTargets(t,e);if(i){for(var a=[],l=0;l<i.length;l++)i[l].listens(e,!0)&&a.push(i[l]);s=a.concat(s)}if(s.length){e==="contextmenu"&&Y(t);var h=s[0],u={originalEvent:t};if(t.type!=="keypress"&&t.type!=="keydown"&&t.type!=="keyup"){var f=h.getLatLng&&(!h._radius||h._radius<=10);u.containerPoint=f?this.latLngToContainerPoint(h.getLatLng()):this.mouseEventToContainerPoint(t),u.layerPoint=this.containerPointToLayerPoint(u.containerPoint),u.latlng=f?h.getLatLng():this.layerPointToLatLng(u.layerPoint)}for(l=0;l<s.length;l++)if(s[l].fire(e,u,!0),u.originalEvent._stopped||s[l].options.bubblingMouseEvents===!1&&Pe(this._mouseEvents,e)!==-1)return}},_draggableMoved:function(t){return t=t.dragging&&t.dragging.enabled()?t:this,t.dragging&&t.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var t=0,e=this._handlers.length;t<e;t++)this._handlers[t].disable()},whenReady:function(t,e){return this._loaded?t.call(e||this,{target:this}):this.on("load",t,e),this},_getMapPanePos:function(){return Pt(this._mapPane)||new k(0,0)},_moved:function(){var t=this._getMapPanePos();return t&&!t.equals([0,0])},_getTopLeftPoint:function(t,e){var i=t&&e!==void 0?this._getNewPixelOrigin(t,e):this.getPixelOrigin();return i.subtract(this._getMapPanePos())},_getNewPixelOrigin:function(t,e){var i=this.getSize()._divideBy(2);return this.project(t,e)._subtract(i)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(t,e,i){var n=this._getNewPixelOrigin(i,e);return this.project(t,e)._subtract(n)},_latLngBoundsToNewLayerBounds:function(t,e,i){var n=this._getNewPixelOrigin(i,e);return X([this.project(t.getSouthWest(),e)._subtract(n),this.project(t.getNorthWest(),e)._subtract(n),this.project(t.getSouthEast(),e)._subtract(n),this.project(t.getNorthEast(),e)._subtract(n)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(t){return this.latLngToLayerPoint(t).subtract(this._getCenterLayerPoint())},_limitCenter:function(t,e,i){if(!i)return t;var n=this.project(t,e),s=this.getSize().divideBy(2),a=new F(n.subtract(s),n.add(s)),l=this._getBoundsOffset(a,i,e);return Math.abs(l.x)<=1&&Math.abs(l.y)<=1?t:this.unproject(n.add(l),e)},_limitOffset:function(t,e){if(!e)return t;var i=this.getPixelBounds(),n=new F(i.min.add(t),i.max.add(t));return t.add(this._getBoundsOffset(n,e))},_getBoundsOffset:function(t,e,i){var n=X(this.project(e.getNorthEast(),i),this.project(e.getSouthWest(),i)),s=n.min.subtract(t.min),a=n.max.subtract(t.max),l=this._rebound(s.x,-a.x),h=this._rebound(s.y,-a.y);return new k(l,h)},_rebound:function(t,e){return t+e>0?Math.round(t-e)/2:Math.max(0,Math.ceil(t))-Math.max(0,Math.floor(e))},_limitZoom:function(t){var e=this.getMinZoom(),i=this.getMaxZoom(),n=x.any3d?this.options.zoomSnap:1;return n&&(t=Math.round(t/n)*n),Math.max(e,Math.min(i,t))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){W(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(t,e){var i=this._getCenterOffset(t)._trunc();return(e&&e.animate)!==!0&&!this.getSize().contains(i)?!1:(this.panBy(i,e),!0)},_createAnimProxy:function(){var t=this._proxy=D("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(t),this.on("zoomanim",function(e){var i=Ne,n=this._proxy.style[i];Tt(this._proxy,this.project(e.center,e.zoom),this.getZoomScale(e.zoom,1)),n===this._proxy.style[i]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){U(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var t=this.getCenter(),e=this.getZoom();Tt(this._proxy,this.project(t,e),this.getZoomScale(e,1))},_catchTransitionEnd:function(t){this._animatingZoom&&t.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(t,e,i){if(this._animatingZoom)return!0;if(i=i||{},!this._zoomAnimated||i.animate===!1||this._nothingToAnimate()||Math.abs(e-this._zoom)>this.options.zoomAnimationThreshold)return!1;var n=this.getZoomScale(e),s=this._getCenterOffset(t)._divideBy(1-1/n);return i.animate!==!0&&!this.getSize().contains(s)?!1:(J(function(){this._moveStart(!0,i.noMoveStart||!1)._animateZoom(t,e,!0)},this),!0)},_animateZoom:function(t,e,i,n){this._mapPane&&(i&&(this._animatingZoom=!0,this._animateToCenter=t,this._animateToZoom=e,E(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:t,zoom:e,noUpdate:n}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(y(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&W(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});function cs(t,e){return new z(t,e)}var lt=mt.extend({options:{position:"topright"},initialize:function(t){P(this,t)},getPosition:function(){return this.options.position},setPosition:function(t){var e=this._map;return e&&e.removeControl(this),this.options.position=t,e&&e.addControl(this),this},getContainer:function(){return this._container},addTo:function(t){this.remove(),this._map=t;var e=this._container=this.onAdd(t),i=this.getPosition(),n=t._controlCorners[i];return E(e,"leaflet-control"),i.indexOf("bottom")!==-1?n.insertBefore(e,n.firstChild):n.appendChild(e),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(U(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(t){this._map&&t&&t.screenX>0&&t.screenY>0&&this._map.getContainer().focus()}}),Kt=function(t){return new lt(t)};z.include({addControl:function(t){return t.addTo(this),this},removeControl:function(t){return t.remove(),this},_initControlPos:function(){var t=this._controlCorners={},e="leaflet-",i=this._controlContainer=D("div",e+"control-container",this._container);function n(s,a){var l=e+s+" "+e+a;t[s+a]=D("div",l,i)}n("top","left"),n("top","right"),n("bottom","left"),n("bottom","right")},_clearControlPos:function(){for(var t in this._controlCorners)U(this._controlCorners[t]);U(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var Fi=lt.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(t,e,i,n){return i<n?-1:n<i?1:0}},initialize:function(t,e,i){P(this,i),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1;for(var n in t)this._addLayer(t[n],n);for(n in e)this._addLayer(e[n],n,!0)},onAdd:function(t){this._initLayout(),this._update(),this._map=t,t.on("zoomend",this._checkDisabledLayers,this);for(var e=0;e<this._layers.length;e++)this._layers[e].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(t){return lt.prototype.addTo.call(this,t),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var t=0;t<this._layers.length;t++)this._layers[t].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(t,e){return this._addLayer(t,e),this._map?this._update():this},addOverlay:function(t,e){return this._addLayer(t,e,!0),this._map?this._update():this},removeLayer:function(t){t.off("add remove",this._onLayerChange,this);var e=this._getLayer(b(t));return e&&this._layers.splice(this._layers.indexOf(e),1),this._map?this._update():this},expand:function(){E(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var t=this._map.getSize().y-(this._container.offsetTop+50);return t<this._section.clientHeight?(E(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=t+"px"):W(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return W(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var t="leaflet-control-layers",e=this._container=D("div",t),i=this.options.collapsed;e.setAttribute("aria-haspopup",!0),Yt(e),Ye(e);var n=this._section=D("section",t+"-list");i&&(this._map.on("click",this.collapse,this),S(e,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var s=this._layersLink=D("a",t+"-toggle",e);s.href="#",s.title="Layers",s.setAttribute("role","button"),S(s,{keydown:function(a){a.keyCode===13&&this._expandSafely()},click:function(a){Y(a),this._expandSafely()}},this),i||this.expand(),this._baseLayersList=D("div",t+"-base",n),this._separator=D("div",t+"-separator",n),this._overlaysList=D("div",t+"-overlays",n),e.appendChild(n)},_getLayer:function(t){for(var e=0;e<this._layers.length;e++)if(this._layers[e]&&b(this._layers[e].layer)===t)return this._layers[e]},_addLayer:function(t,e,i){this._map&&t.on("add remove",this._onLayerChange,this),this._layers.push({layer:t,name:e,overlay:i}),this.options.sortLayers&&this._layers.sort(y(function(n,s){return this.options.sortFunction(n.layer,s.layer,n.name,s.name)},this)),this.options.autoZIndex&&t.setZIndex&&(this._lastZIndex++,t.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;ae(this._baseLayersList),ae(this._overlaysList),this._layerControlInputs=[];var t,e,i,n,s=0;for(i=0;i<this._layers.length;i++)n=this._layers[i],this._addItem(n),e=e||n.overlay,t=t||!n.overlay,s+=n.overlay?0:1;return this.options.hideSingleBase&&(t=t&&s>1,this._baseLayersList.style.display=t?"":"none"),this._separator.style.display=e&&t?"":"none",this},_onLayerChange:function(t){this._handlingClick||this._update();var e=this._getLayer(b(t.target)),i=e.overlay?t.type==="add"?"overlayadd":"overlayremove":t.type==="add"?"baselayerchange":null;i&&this._map.fire(i,e)},_createRadioElement:function(t,e){var i='<input type="radio" class="leaflet-control-layers-selector" name="'+t+'"'+(e?' checked="checked"':"")+"/>",n=document.createElement("div");return n.innerHTML=i,n.firstChild},_addItem:function(t){var e=document.createElement("label"),i=this._map.hasLayer(t.layer),n;t.overlay?(n=document.createElement("input"),n.type="checkbox",n.className="leaflet-control-layers-selector",n.defaultChecked=i):n=this._createRadioElement("leaflet-base-layers_"+b(this),i),this._layerControlInputs.push(n),n.layerId=b(t.layer),S(n,"click",this._onInputClick,this);var s=document.createElement("span");s.innerHTML=" "+t.name;var a=document.createElement("span");e.appendChild(a),a.appendChild(n),a.appendChild(s);var l=t.overlay?this._overlaysList:this._baseLayersList;return l.appendChild(e),this._checkDisabledLayers(),e},_onInputClick:function(){if(!this._preventClick){var t=this._layerControlInputs,e,i,n=[],s=[];this._handlingClick=!0;for(var a=t.length-1;a>=0;a--)e=t[a],i=this._getLayer(e.layerId).layer,e.checked?n.push(i):e.checked||s.push(i);for(a=0;a<s.length;a++)this._map.hasLayer(s[a])&&this._map.removeLayer(s[a]);for(a=0;a<n.length;a++)this._map.hasLayer(n[a])||this._map.addLayer(n[a]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var t=this._layerControlInputs,e,i,n=this._map.getZoom(),s=t.length-1;s>=0;s--)e=t[s],i=this._getLayer(e.layerId).layer,e.disabled=i.options.minZoom!==void 0&&n<i.options.minZoom||i.options.maxZoom!==void 0&&n>i.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var t=this._section;this._preventClick=!0,S(t,"click",Y),this.expand();var e=this;setTimeout(function(){H(t,"click",Y),e._preventClick=!1})}}),hs=function(t,e,i){return new Fi(t,e,i)},Je=lt.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(t){var e="leaflet-control-zoom",i=D("div",e+" leaflet-bar"),n=this.options;return this._zoomInButton=this._createButton(n.zoomInText,n.zoomInTitle,e+"-in",i,this._zoomIn),this._zoomOutButton=this._createButton(n.zoomOutText,n.zoomOutTitle,e+"-out",i,this._zoomOut),this._updateDisabled(),t.on("zoomend zoomlevelschange",this._updateDisabled,this),i},onRemove:function(t){t.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(t){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(t.shiftKey?3:1))},_zoomOut:function(t){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(t.shiftKey?3:1))},_createButton:function(t,e,i,n,s){var a=D("a",i,n);return a.innerHTML=t,a.href="#",a.title=e,a.setAttribute("role","button"),a.setAttribute("aria-label",e),Yt(a),S(a,"click",St),S(a,"click",s,this),S(a,"click",this._refocusOnMap,this),a},_updateDisabled:function(){var t=this._map,e="leaflet-disabled";W(this._zoomInButton,e),W(this._zoomOutButton,e),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||t._zoom===t.getMinZoom())&&(E(this._zoomOutButton,e),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||t._zoom===t.getMaxZoom())&&(E(this._zoomInButton,e),this._zoomInButton.setAttribute("aria-disabled","true"))}});z.mergeOptions({zoomControl:!0}),z.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new Je,this.addControl(this.zoomControl))});var ds=function(t){return new Je(t)},Ui=lt.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(t){var e="leaflet-control-scale",i=D("div",e),n=this.options;return this._addScales(n,e+"-line",i),t.on(n.updateWhenIdle?"moveend":"move",this._update,this),t.whenReady(this._update,this),i},onRemove:function(t){t.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(t,e,i){t.metric&&(this._mScale=D("div",e,i)),t.imperial&&(this._iScale=D("div",e,i))},_update:function(){var t=this._map,e=t.getSize().y/2,i=t.distance(t.containerPointToLatLng([0,e]),t.containerPointToLatLng([this.options.maxWidth,e]));this._updateScales(i)},_updateScales:function(t){this.options.metric&&t&&this._updateMetric(t),this.options.imperial&&t&&this._updateImperial(t)},_updateMetric:function(t){var e=this._getRoundNum(t),i=e<1e3?e+" m":e/1e3+" km";this._updateScale(this._mScale,i,e/t)},_updateImperial:function(t){var e=t*3.2808399,i,n,s;e>5280?(i=e/5280,n=this._getRoundNum(i),this._updateScale(this._iScale,n+" mi",n/i)):(s=this._getRoundNum(e),this._updateScale(this._iScale,s+" ft",s/e))},_updateScale:function(t,e,i){t.style.width=Math.round(this.options.maxWidth*i)+"px",t.innerHTML=e},_getRoundNum:function(t){var e=Math.pow(10,(Math.floor(t)+"").length-1),i=t/e;return i=i>=10?10:i>=5?5:i>=3?3:i>=2?2:1,e*i}}),us=function(t){return new Ui(t)},fs='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg>',Xe=lt.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(x.inlineSvg?fs+" ":"")+"Leaflet</a>"},initialize:function(t){P(this,t),this._attributions={}},onAdd:function(t){t.attributionControl=this,this._container=D("div","leaflet-control-attribution"),Yt(this._container);for(var e in t._layers)t._layers[e].getAttribution&&this.addAttribution(t._layers[e].getAttribution());return this._update(),t.on("layeradd",this._addAttribution,this),this._container},onRemove:function(t){t.off("layeradd",this._addAttribution,this)},_addAttribution:function(t){t.layer.getAttribution&&(this.addAttribution(t.layer.getAttribution()),t.layer.once("remove",function(){this.removeAttribution(t.layer.getAttribution())},this))},setPrefix:function(t){return this.options.prefix=t,this._update(),this},addAttribution:function(t){return t?(this._attributions[t]||(this._attributions[t]=0),this._attributions[t]++,this._update(),this):this},removeAttribution:function(t){return t?(this._attributions[t]&&(this._attributions[t]--,this._update()),this):this},_update:function(){if(this._map){var t=[];for(var e in this._attributions)this._attributions[e]&&t.push(e);var i=[];this.options.prefix&&i.push(this.options.prefix),t.length&&i.push(t.join(", ")),this._container.innerHTML=i.join(' <span aria-hidden="true">|</span> ')}}});z.mergeOptions({attributionControl:!0}),z.addInitHook(function(){this.options.attributionControl&&new Xe().addTo(this)});var ps=function(t){return new Xe(t)};lt.Layers=Fi,lt.Zoom=Je,lt.Scale=Ui,lt.Attribution=Xe,Kt.layers=hs,Kt.zoom=ds,Kt.scale=us,Kt.attribution=ps;var ut=mt.extend({initialize:function(t){this._map=t},enable:function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});ut.addTo=function(t,e){return t.addHandler(e,this),this};var ms={Events:et},Wi=x.touch?"touchstart mousedown":"mousedown",wt=$t.extend({options:{clickTolerance:3},initialize:function(t,e,i,n){P(this,n),this._element=t,this._dragStartTarget=e||t,this._preventOutline=i},enable:function(){this._enabled||(S(this._dragStartTarget,Wi,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(wt._dragging===this&&this.finishDrag(!0),H(this._dragStartTarget,Wi,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(t){if(this._enabled&&(this._moved=!1,!Re(this._element,"leaflet-zoom-anim"))){if(t.touches&&t.touches.length!==1){wt._dragging===this&&this.finishDrag();return}if(!(wt._dragging||t.shiftKey||t.which!==1&&t.button!==1&&!t.touches)&&(wt._dragging=this,this._preventOutline&&We(this._element),$e(),jt(),!this._moving)){this.fire("down");var e=t.touches?t.touches[0]:t,i=Di(this._element);this._startPoint=new k(e.clientX,e.clientY),this._startPos=Pt(this._element),this._parentScale=qe(i);var n=t.type==="mousedown";S(document,n?"mousemove":"touchmove",this._onMove,this),S(document,n?"mouseup":"touchend touchcancel",this._onUp,this)}}},_onMove:function(t){if(this._enabled){if(t.touches&&t.touches.length>1){this._moved=!0;return}var e=t.touches&&t.touches.length===1?t.touches[0]:t,i=new k(e.clientX,e.clientY)._subtract(this._startPoint);!i.x&&!i.y||Math.abs(i.x)+Math.abs(i.y)<this.options.clickTolerance||(i.x/=this._parentScale.x,i.y/=this._parentScale.y,Y(t),this._moved||(this.fire("dragstart"),this._moved=!0,E(document.body,"leaflet-dragging"),this._lastTarget=t.target||t.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),E(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(i),this._moving=!0,this._lastEvent=t,this._updatePosition())}},_updatePosition:function(){var t={originalEvent:this._lastEvent};this.fire("predrag",t),j(this._element,this._newPos),this.fire("drag",t)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(t){W(document.body,"leaflet-dragging"),this._lastTarget&&(W(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),H(document,"mousemove touchmove",this._onMove,this),H(document,"mouseup touchend touchcancel",this._onUp,this),Fe(),Vt();var e=this._moved&&this._moving;this._moving=!1,wt._dragging=!1,e&&this.fire("dragend",{noInertia:t,distance:this._newPos.distanceTo(this._startPos)})}});function qi(t,e,i){var n,s=[1,4,2,8],a,l,h,u,f,v,w,A;for(a=0,v=t.length;a<v;a++)t[a]._code=Mt(t[a],e);for(h=0;h<4;h++){for(w=s[h],n=[],a=0,v=t.length,l=v-1;a<v;l=a++)u=t[a],f=t[l],u._code&w?f._code&w||(A=ue(f,u,w,e,i),A._code=Mt(A,e),n.push(A)):(f._code&w&&(A=ue(f,u,w,e,i),A._code=Mt(A,e),n.push(A)),n.push(u));t=n}return t}function ji(t,e){var i,n,s,a,l,h,u,f,v;if(!t||t.length===0)throw new Error("latlngs not passed");ot(t)||(console.warn("latlngs are not flat! Only the first ring will be used"),t=t[0]);var w=O([0,0]),A=q(t),K=A.getNorthWest().distanceTo(A.getSouthWest())*A.getNorthEast().distanceTo(A.getNorthWest());K<1700&&(w=Qe(t));var G=t.length,rt=[];for(i=0;i<G;i++){var tt=O(t[i]);rt.push(e.project(O([tt.lat-w.lat,tt.lng-w.lng])))}for(h=u=f=0,i=0,n=G-1;i<G;n=i++)s=rt[i],a=rt[n],l=s.y*a.x-a.y*s.x,u+=(s.x+a.x)*l,f+=(s.y+a.y)*l,h+=l*3;h===0?v=rt[0]:v=[u/h,f/h];var Rt=e.unproject(T(v));return O([Rt.lat+w.lat,Rt.lng+w.lng])}function Qe(t){for(var e=0,i=0,n=0,s=0;s<t.length;s++){var a=O(t[s]);e+=a.lat,i+=a.lng,n++}return O([e/n,i/n])}var _s={__proto__:null,clipPolygon:qi,polygonCenter:ji,centroid:Qe};function Vi(t,e){if(!e||!t.length)return t.slice();var i=e*e;return t=ys(t,i),t=vs(t,i),t}function Gi(t,e,i){return Math.sqrt(Jt(t,e,i,!0))}function gs(t,e,i){return Jt(t,e,i)}function vs(t,e){var i=t.length,n=typeof Uint8Array<"u"?Uint8Array:Array,s=new n(i);s[0]=s[i-1]=1,ti(t,s,e,0,i-1);var a,l=[];for(a=0;a<i;a++)s[a]&&l.push(t[a]);return l}function ti(t,e,i,n,s){var a=0,l,h,u;for(h=n+1;h<=s-1;h++)u=Jt(t[h],t[n],t[s],!0),u>a&&(l=h,a=u);a>i&&(e[l]=1,ti(t,e,i,n,l),ti(t,e,i,l,s))}function ys(t,e){for(var i=[t[0]],n=1,s=0,a=t.length;n<a;n++)bs(t[n],t[s])>e&&(i.push(t[n]),s=n);return s<a-1&&i.push(t[a-1]),i}var Yi;function Ki(t,e,i,n,s){var a=n?Yi:Mt(t,i),l=Mt(e,i),h,u,f;for(Yi=l;;){if(!(a|l))return[t,e];if(a&l)return!1;h=a||l,u=ue(t,e,h,i,s),f=Mt(u,i),h===a?(t=u,a=f):(e=u,l=f)}}function ue(t,e,i,n,s){var a=e.x-t.x,l=e.y-t.y,h=n.min,u=n.max,f,v;return i&8?(f=t.x+a*(u.y-t.y)/l,v=u.y):i&4?(f=t.x+a*(h.y-t.y)/l,v=h.y):i&2?(f=u.x,v=t.y+l*(u.x-t.x)/a):i&1&&(f=h.x,v=t.y+l*(h.x-t.x)/a),new k(f,v,s)}function Mt(t,e){var i=0;return t.x<e.min.x?i|=1:t.x>e.max.x&&(i|=2),t.y<e.min.y?i|=4:t.y>e.max.y&&(i|=8),i}function bs(t,e){var i=e.x-t.x,n=e.y-t.y;return i*i+n*n}function Jt(t,e,i,n){var s=e.x,a=e.y,l=i.x-s,h=i.y-a,u=l*l+h*h,f;return u>0&&(f=((t.x-s)*l+(t.y-a)*h)/u,f>1?(s=i.x,a=i.y):f>0&&(s+=l*f,a+=h*f)),l=t.x-s,h=t.y-a,n?l*l+h*h:new k(s,a)}function ot(t){return!at(t[0])||typeof t[0][0]!="object"&&typeof t[0][0]<"u"}function Ji(t){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),ot(t)}function Xi(t,e){var i,n,s,a,l,h,u,f;if(!t||t.length===0)throw new Error("latlngs not passed");ot(t)||(console.warn("latlngs are not flat! Only the first ring will be used"),t=t[0]);var v=O([0,0]),w=q(t),A=w.getNorthWest().distanceTo(w.getSouthWest())*w.getNorthEast().distanceTo(w.getNorthWest());A<1700&&(v=Qe(t));var K=t.length,G=[];for(i=0;i<K;i++){var rt=O(t[i]);G.push(e.project(O([rt.lat-v.lat,rt.lng-v.lng])))}for(i=0,n=0;i<K-1;i++)n+=G[i].distanceTo(G[i+1])/2;if(n===0)f=G[0];else for(i=0,a=0;i<K-1;i++)if(l=G[i],h=G[i+1],s=l.distanceTo(h),a+=s,a>n){u=(a-n)/s,f=[h.x-u*(h.x-l.x),h.y-u*(h.y-l.y)];break}var tt=e.unproject(T(f));return O([tt.lat+v.lat,tt.lng+v.lng])}var xs={__proto__:null,simplify:Vi,pointToSegmentDistance:Gi,closestPointOnSegment:gs,clipSegment:Ki,_getEdgeIntersection:ue,_getBitCode:Mt,_sqClosestPointOnSegment:Jt,isFlat:ot,_flat:Ji,polylineCenter:Xi},ei={project:function(t){return new k(t.lng,t.lat)},unproject:function(t){return new R(t.y,t.x)},bounds:new F([-180,-90],[180,90])},ii={R:6378137,R_MINOR:6356752314245179e-9,bounds:new F([-2003750834279e-5,-1549657073972e-5],[2003750834279e-5,1876465623138e-5]),project:function(t){var e=Math.PI/180,i=this.R,n=t.lat*e,s=this.R_MINOR/i,a=Math.sqrt(1-s*s),l=a*Math.sin(n),h=Math.tan(Math.PI/4-n/2)/Math.pow((1-l)/(1+l),a/2);return n=-i*Math.log(Math.max(h,1e-10)),new k(t.lng*e*i,n)},unproject:function(t){for(var e=180/Math.PI,i=this.R,n=this.R_MINOR/i,s=Math.sqrt(1-n*n),a=Math.exp(-t.y/i),l=Math.PI/2-2*Math.atan(a),h=0,u=.1,f;h<15&&Math.abs(u)>1e-7;h++)f=s*Math.sin(l),f=Math.pow((1-f)/(1+f),s/2),u=Math.PI/2-2*Math.atan(a*f)-l,l+=u;return new R(l*e,t.x*e/i)}},ws={__proto__:null,LonLat:ei,Mercator:ii,SphericalMercator:Me},Ls=d({},xt,{code:"EPSG:3395",projection:ii,transformation:(function(){var t=.5/(Math.PI*ii.R);return Ft(t,.5,-t,.5)})()}),Qi=d({},xt,{code:"EPSG:4326",projection:ei,transformation:Ft(1/180,1,-1/180,.5)}),Ts=d({},_t,{projection:ei,transformation:Ft(1,0,-1,0),scale:function(t){return Math.pow(2,t)},zoom:function(t){return Math.log(t)/Math.LN2},distance:function(t,e){var i=e.lng-t.lng,n=e.lat-t.lat;return Math.sqrt(i*i+n*n)},infinite:!0});_t.Earth=xt,_t.EPSG3395=Ls,_t.EPSG3857=Ce,_t.EPSG900913=Cn,_t.EPSG4326=Qi,_t.Simple=Ts;var ct=$t.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(t){return t.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(t){return t&&t.removeLayer(this),this},getPane:function(t){return this._map.getPane(t?this.options[t]||t:this.options.pane)},addInteractiveTarget:function(t){return this._map._targets[b(t)]=this,this},removeInteractiveTarget:function(t){return delete this._map._targets[b(t)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(t){var e=t.target;if(e.hasLayer(this)){if(this._map=e,this._zoomAnimated=e._zoomAnimated,this.getEvents){var i=this.getEvents();e.on(i,this),this.once("remove",function(){e.off(i,this)},this)}this.onAdd(e),this.fire("add"),e.fire("layeradd",{layer:this})}}});z.include({addLayer:function(t){if(!t._layerAdd)throw new Error("The provided object is not a Layer.");var e=b(t);return this._layers[e]?this:(this._layers[e]=t,t._mapToAdd=this,t.beforeAdd&&t.beforeAdd(this),this.whenReady(t._layerAdd,t),this)},removeLayer:function(t){var e=b(t);return this._layers[e]?(this._loaded&&t.onRemove(this),delete this._layers[e],this._loaded&&(this.fire("layerremove",{layer:t}),t.fire("remove")),t._map=t._mapToAdd=null,this):this},hasLayer:function(t){return b(t)in this._layers},eachLayer:function(t,e){for(var i in this._layers)t.call(e,this._layers[i]);return this},_addLayers:function(t){t=t?at(t)?t:[t]:[];for(var e=0,i=t.length;e<i;e++)this.addLayer(t[e])},_addZoomLimit:function(t){(!isNaN(t.options.maxZoom)||!isNaN(t.options.minZoom))&&(this._zoomBoundLayers[b(t)]=t,this._updateZoomLevels())},_removeZoomLimit:function(t){var e=b(t);this._zoomBoundLayers[e]&&(delete this._zoomBoundLayers[e],this._updateZoomLevels())},_updateZoomLevels:function(){var t=1/0,e=-1/0,i=this._getZoomSpan();for(var n in this._zoomBoundLayers){var s=this._zoomBoundLayers[n].options;t=s.minZoom===void 0?t:Math.min(t,s.minZoom),e=s.maxZoom===void 0?e:Math.max(e,s.maxZoom)}this._layersMaxZoom=e===-1/0?void 0:e,this._layersMinZoom=t===1/0?void 0:t,i!==this._getZoomSpan()&&this.fire("zoomlevelschange"),this.options.maxZoom===void 0&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),this.options.minZoom===void 0&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var Ot=ct.extend({initialize:function(t,e){P(this,e),this._layers={};var i,n;if(t)for(i=0,n=t.length;i<n;i++)this.addLayer(t[i])},addLayer:function(t){var e=this.getLayerId(t);return this._layers[e]=t,this._map&&this._map.addLayer(t),this},removeLayer:function(t){var e=t in this._layers?t:this.getLayerId(t);return this._map&&this._layers[e]&&this._map.removeLayer(this._layers[e]),delete this._layers[e],this},hasLayer:function(t){var e=typeof t=="number"?t:this.getLayerId(t);return e in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(t){var e=Array.prototype.slice.call(arguments,1),i,n;for(i in this._layers)n=this._layers[i],n[t]&&n[t].apply(n,e);return this},onAdd:function(t){this.eachLayer(t.addLayer,t)},onRemove:function(t){this.eachLayer(t.removeLayer,t)},eachLayer:function(t,e){for(var i in this._layers)t.call(e,this._layers[i]);return this},getLayer:function(t){return this._layers[t]},getLayers:function(){var t=[];return this.eachLayer(t.push,t),t},setZIndex:function(t){return this.invoke("setZIndex",t)},getLayerId:function(t){return b(t)}}),Ps=function(t,e){return new Ot(t,e)},gt=Ot.extend({addLayer:function(t){return this.hasLayer(t)?this:(t.addEventParent(this),Ot.prototype.addLayer.call(this,t),this.fire("layeradd",{layer:t}))},removeLayer:function(t){return this.hasLayer(t)?(t in this._layers&&(t=this._layers[t]),t.removeEventParent(this),Ot.prototype.removeLayer.call(this,t),this.fire("layerremove",{layer:t})):this},setStyle:function(t){return this.invoke("setStyle",t)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var t=new Q;for(var e in this._layers){var i=this._layers[e];t.extend(i.getBounds?i.getBounds():i.getLatLng())}return t}}),ks=function(t,e){return new gt(t,e)},zt=mt.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(t){P(this,t)},createIcon:function(t){return this._createIcon("icon",t)},createShadow:function(t){return this._createIcon("shadow",t)},_createIcon:function(t,e){var i=this._getIconUrl(t);if(!i){if(t==="icon")throw new Error("iconUrl not set in Icon options (see the docs).");return null}var n=this._createImg(i,e&&e.tagName==="IMG"?e:null);return this._setIconStyles(n,t),(this.options.crossOrigin||this.options.crossOrigin==="")&&(n.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),n},_setIconStyles:function(t,e){var i=this.options,n=i[e+"Size"];typeof n=="number"&&(n=[n,n]);var s=T(n),a=T(e==="shadow"&&i.shadowAnchor||i.iconAnchor||s&&s.divideBy(2,!0));t.className="leaflet-marker-"+e+" "+(i.className||""),a&&(t.style.marginLeft=-a.x+"px",t.style.marginTop=-a.y+"px"),s&&(t.style.width=s.x+"px",t.style.height=s.y+"px")},_createImg:function(t,e){return e=e||document.createElement("img"),e.src=t,e},_getIconUrl:function(t){return x.retina&&this.options[t+"RetinaUrl"]||this.options[t+"Url"]}});function Ss(t){return new zt(t)}var Xt=zt.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(t){return typeof Xt.imagePath!="string"&&(Xt.imagePath=this._detectIconPath()),(this.options.imagePath||Xt.imagePath)+zt.prototype._getIconUrl.call(this,t)},_stripUrl:function(t){var e=function(i,n,s){var a=n.exec(i);return a&&a[s]};return t=e(t,/^url\((['"])?(.+)\1\)$/,2),t&&e(t,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var t=D("div","leaflet-default-icon-path",document.body),e=qt(t,"background-image")||qt(t,"backgroundImage");if(document.body.removeChild(t),e=this._stripUrl(e),e)return e;var i=document.querySelector('link[href$="leaflet.css"]');return i?i.href.substring(0,i.href.length-11-1):""}}),tn=ut.extend({initialize:function(t){this._marker=t},addHooks:function(){var t=this._marker._icon;this._draggable||(this._draggable=new wt(t,t,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),E(t,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&W(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(t){var e=this._marker,i=e._map,n=this._marker.options.autoPanSpeed,s=this._marker.options.autoPanPadding,a=Pt(e._icon),l=i.getPixelBounds(),h=i.getPixelOrigin(),u=X(l.min._subtract(h).add(s),l.max._subtract(h).subtract(s));if(!u.contains(a)){var f=T((Math.max(u.max.x,a.x)-u.max.x)/(l.max.x-u.max.x)-(Math.min(u.min.x,a.x)-u.min.x)/(l.min.x-u.min.x),(Math.max(u.max.y,a.y)-u.max.y)/(l.max.y-u.max.y)-(Math.min(u.min.y,a.y)-u.min.y)/(l.min.y-u.min.y)).multiplyBy(n);i.panBy(f,{animate:!1}),this._draggable._newPos._add(f),this._draggable._startPos._add(f),j(e._icon,this._draggable._newPos),this._onDrag(t),this._panRequest=J(this._adjustPan.bind(this,t))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(t){this._marker.options.autoPan&&(nt(this._panRequest),this._panRequest=J(this._adjustPan.bind(this,t)))},_onDrag:function(t){var e=this._marker,i=e._shadow,n=Pt(e._icon),s=e._map.layerPointToLatLng(n);i&&j(i,n),e._latlng=s,t.latlng=s,t.oldLatLng=this._oldLatLng,e.fire("move",t).fire("drag",t)},_onDragEnd:function(t){nt(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",t)}}),fe=ct.extend({options:{icon:new Xt,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(t,e){P(this,e),this._latlng=O(t)},onAdd:function(t){this._zoomAnimated=this._zoomAnimated&&t.options.markerZoomAnimation,this._zoomAnimated&&t.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(t){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&t.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(t){var e=this._latlng;return this._latlng=O(t),this.update(),this.fire("move",{oldLatLng:e,latlng:this._latlng})},setZIndexOffset:function(t){return this.options.zIndexOffset=t,this.update()},getIcon:function(){return this.options.icon},setIcon:function(t){return this.options.icon=t,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var t=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(t)}return this},_initIcon:function(){var t=this.options,e="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),i=t.icon.createIcon(this._icon),n=!1;i!==this._icon&&(this._icon&&this._removeIcon(),n=!0,t.title&&(i.title=t.title),i.tagName==="IMG"&&(i.alt=t.alt||"")),E(i,e),t.keyboard&&(i.tabIndex="0",i.setAttribute("role","button")),this._icon=i,t.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&S(i,"focus",this._panOnFocus,this);var s=t.icon.createShadow(this._shadow),a=!1;s!==this._shadow&&(this._removeShadow(),a=!0),s&&(E(s,e),s.alt=""),this._shadow=s,t.opacity<1&&this._updateOpacity(),n&&this.getPane().appendChild(this._icon),this._initInteraction(),s&&a&&this.getPane(t.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&H(this._icon,"focus",this._panOnFocus,this),U(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&U(this._shadow),this._shadow=null},_setPos:function(t){this._icon&&j(this._icon,t),this._shadow&&j(this._shadow,t),this._zIndex=t.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(t){this._icon&&(this._icon.style.zIndex=this._zIndex+t)},_animateZoom:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center).round();this._setPos(e)},_initInteraction:function(){if(this.options.interactive&&(E(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),tn)){var t=this.options.draggable;this.dragging&&(t=this.dragging.enabled(),this.dragging.disable()),this.dragging=new tn(this),t&&this.dragging.enable()}},setOpacity:function(t){return this.options.opacity=t,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var t=this.options.opacity;this._icon&&st(this._icon,t),this._shadow&&st(this._shadow,t)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var t=this._map;if(t){var e=this.options.icon.options,i=e.iconSize?T(e.iconSize):T(0,0),n=e.iconAnchor?T(e.iconAnchor):T(0,0);t.panInside(this._latlng,{paddingTopLeft:n,paddingBottomRight:i.subtract(n)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});function Ms(t,e){return new fe(t,e)}var Lt=ct.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(t){this._renderer=t.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(t){return P(this,t),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&t&&Object.prototype.hasOwnProperty.call(t,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),pe=Lt.extend({options:{fill:!0,radius:10},initialize:function(t,e){P(this,e),this._latlng=O(t),this._radius=this.options.radius},setLatLng:function(t){var e=this._latlng;return this._latlng=O(t),this.redraw(),this.fire("move",{oldLatLng:e,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(t){return this.options.radius=this._radius=t,this.redraw()},getRadius:function(){return this._radius},setStyle:function(t){var e=t&&t.radius||this._radius;return Lt.prototype.setStyle.call(this,t),this.setRadius(e),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var t=this._radius,e=this._radiusY||t,i=this._clickTolerance(),n=[t+i,e+i];this._pxBounds=new F(this._point.subtract(n),this._point.add(n))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(t){return t.distanceTo(this._point)<=this._radius+this._clickTolerance()}});function Es(t,e){return new pe(t,e)}var ni=pe.extend({initialize:function(t,e,i){if(typeof e=="number"&&(e=d({},i,{radius:e})),P(this,e),this._latlng=O(t),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(t){return this._mRadius=t,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var t=[this._radius,this._radiusY||this._radius];return new Q(this._map.layerPointToLatLng(this._point.subtract(t)),this._map.layerPointToLatLng(this._point.add(t)))},setStyle:Lt.prototype.setStyle,_project:function(){var t=this._latlng.lng,e=this._latlng.lat,i=this._map,n=i.options.crs;if(n.distance===xt.distance){var s=Math.PI/180,a=this._mRadius/xt.R/s,l=i.project([e+a,t]),h=i.project([e-a,t]),u=l.add(h).divideBy(2),f=i.unproject(u).lat,v=Math.acos((Math.cos(a*s)-Math.sin(e*s)*Math.sin(f*s))/(Math.cos(e*s)*Math.cos(f*s)))/s;(isNaN(v)||v===0)&&(v=a/Math.cos(Math.PI/180*e)),this._point=u.subtract(i.getPixelOrigin()),this._radius=isNaN(v)?0:u.x-i.project([f,t-v]).x,this._radiusY=u.y-l.y}else{var w=n.unproject(n.project(this._latlng).subtract([this._mRadius,0]));this._point=i.latLngToLayerPoint(this._latlng),this._radius=this._point.x-i.latLngToLayerPoint(w).x}this._updateBounds()}});function Cs(t,e,i){return new ni(t,e,i)}var vt=Lt.extend({options:{smoothFactor:1,noClip:!1},initialize:function(t,e){P(this,e),this._setLatLngs(t)},getLatLngs:function(){return this._latlngs},setLatLngs:function(t){return this._setLatLngs(t),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(t){for(var e=1/0,i=null,n=Jt,s,a,l=0,h=this._parts.length;l<h;l++)for(var u=this._parts[l],f=1,v=u.length;f<v;f++){s=u[f-1],a=u[f];var w=n(t,s,a,!0);w<e&&(e=w,i=n(t,s,a))}return i&&(i.distance=Math.sqrt(e)),i},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return Xi(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(t,e){return e=e||this._defaultShape(),t=O(t),e.push(t),this._bounds.extend(t),this.redraw()},_setLatLngs:function(t){this._bounds=new Q,this._latlngs=this._convertLatLngs(t)},_defaultShape:function(){return ot(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(t){for(var e=[],i=ot(t),n=0,s=t.length;n<s;n++)i?(e[n]=O(t[n]),this._bounds.extend(e[n])):e[n]=this._convertLatLngs(t[n]);return e},_project:function(){var t=new F;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,t),this._bounds.isValid()&&t.isValid()&&(this._rawPxBounds=t,this._updateBounds())},_updateBounds:function(){var t=this._clickTolerance(),e=new k(t,t);this._rawPxBounds&&(this._pxBounds=new F([this._rawPxBounds.min.subtract(e),this._rawPxBounds.max.add(e)]))},_projectLatlngs:function(t,e,i){var n=t[0]instanceof R,s=t.length,a,l;if(n){for(l=[],a=0;a<s;a++)l[a]=this._map.latLngToLayerPoint(t[a]),i.extend(l[a]);e.push(l)}else for(a=0;a<s;a++)this._projectLatlngs(t[a],e,i)},_clipPoints:function(){var t=this._renderer._bounds;if(this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(t))){if(this.options.noClip){this._parts=this._rings;return}var e=this._parts,i,n,s,a,l,h,u;for(i=0,s=0,a=this._rings.length;i<a;i++)for(u=this._rings[i],n=0,l=u.length;n<l-1;n++)h=Ki(u[n],u[n+1],t,n,!0),h&&(e[s]=e[s]||[],e[s].push(h[0]),(h[1]!==u[n+1]||n===l-2)&&(e[s].push(h[1]),s++))}},_simplifyPoints:function(){for(var t=this._parts,e=this.options.smoothFactor,i=0,n=t.length;i<n;i++)t[i]=Vi(t[i],e)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(t,e){var i,n,s,a,l,h,u=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(t))return!1;for(i=0,a=this._parts.length;i<a;i++)for(h=this._parts[i],n=0,l=h.length,s=l-1;n<l;s=n++)if(!(!e&&n===0)&&Gi(t,h[s],h[n])<=u)return!0;return!1}});function As(t,e){return new vt(t,e)}vt._flat=Ji;var Bt=vt.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return ji(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(t){var e=vt.prototype._convertLatLngs.call(this,t),i=e.length;return i>=2&&e[0]instanceof R&&e[0].equals(e[i-1])&&e.pop(),e},_setLatLngs:function(t){vt.prototype._setLatLngs.call(this,t),ot(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return ot(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var t=this._renderer._bounds,e=this.options.weight,i=new k(e,e);if(t=new F(t.min.subtract(i),t.max.add(i)),this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(t))){if(this.options.noClip){this._parts=this._rings;return}for(var n=0,s=this._rings.length,a;n<s;n++)a=qi(this._rings[n],t,!0),a.length&&this._parts.push(a)}},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(t){var e=!1,i,n,s,a,l,h,u,f;if(!this._pxBounds||!this._pxBounds.contains(t))return!1;for(a=0,u=this._parts.length;a<u;a++)for(i=this._parts[a],l=0,f=i.length,h=f-1;l<f;h=l++)n=i[l],s=i[h],n.y>t.y!=s.y>t.y&&t.x<(s.x-n.x)*(t.y-n.y)/(s.y-n.y)+n.x&&(e=!e);return e||vt.prototype._containsPoint.call(this,t,!0)}});function Is(t,e){return new Bt(t,e)}var yt=gt.extend({initialize:function(t,e){P(this,e),this._layers={},t&&this.addData(t)},addData:function(t){var e=at(t)?t:t.features,i,n,s;if(e){for(i=0,n=e.length;i<n;i++)s=e[i],(s.geometries||s.geometry||s.features||s.coordinates)&&this.addData(s);return this}var a=this.options;if(a.filter&&!a.filter(t))return this;var l=me(t,a);return l?(l.feature=ve(t),l.defaultOptions=l.options,this.resetStyle(l),a.onEachFeature&&a.onEachFeature(t,l),this.addLayer(l)):this},resetStyle:function(t){return t===void 0?this.eachLayer(this.resetStyle,this):(t.options=d({},t.defaultOptions),this._setLayerStyle(t,this.options.style),this)},setStyle:function(t){return this.eachLayer(function(e){this._setLayerStyle(e,t)},this)},_setLayerStyle:function(t,e){t.setStyle&&(typeof e=="function"&&(e=e(t.feature)),t.setStyle(e))}});function me(t,e){var i=t.type==="Feature"?t.geometry:t,n=i?i.coordinates:null,s=[],a=e&&e.pointToLayer,l=e&&e.coordsToLatLng||si,h,u,f,v;if(!n&&!i)return null;switch(i.type){case"Point":return h=l(n),en(a,t,h,e);case"MultiPoint":for(f=0,v=n.length;f<v;f++)h=l(n[f]),s.push(en(a,t,h,e));return new gt(s);case"LineString":case"MultiLineString":return u=_e(n,i.type==="LineString"?0:1,l),new vt(u,e);case"Polygon":case"MultiPolygon":return u=_e(n,i.type==="Polygon"?1:2,l),new Bt(u,e);case"GeometryCollection":for(f=0,v=i.geometries.length;f<v;f++){var w=me({geometry:i.geometries[f],type:"Feature",properties:t.properties},e);w&&s.push(w)}return new gt(s);case"FeatureCollection":for(f=0,v=i.features.length;f<v;f++){var A=me(i.features[f],e);A&&s.push(A)}return new gt(s);default:throw new Error("Invalid GeoJSON object.")}}function en(t,e,i,n){return t?t(e,i):new fe(i,n&&n.markersInheritOptions&&n)}function si(t){return new R(t[1],t[0],t[2])}function _e(t,e,i){for(var n=[],s=0,a=t.length,l;s<a;s++)l=e?_e(t[s],e-1,i):(i||si)(t[s]),n.push(l);return n}function oi(t,e){return t=O(t),t.alt!==void 0?[B(t.lng,e),B(t.lat,e),B(t.alt,e)]:[B(t.lng,e),B(t.lat,e)]}function ge(t,e,i,n){for(var s=[],a=0,l=t.length;a<l;a++)s.push(e?ge(t[a],ot(t[a])?0:e-1,i,n):oi(t[a],n));return!e&&i&&s.length>0&&s.push(s[0].slice()),s}function Dt(t,e){return t.feature?d({},t.feature,{geometry:e}):ve(e)}function ve(t){return t.type==="Feature"||t.type==="FeatureCollection"?t:{type:"Feature",properties:{},geometry:t}}var ri={toGeoJSON:function(t){return Dt(this,{type:"Point",coordinates:oi(this.getLatLng(),t)})}};fe.include(ri),ni.include(ri),pe.include(ri),vt.include({toGeoJSON:function(t){var e=!ot(this._latlngs),i=ge(this._latlngs,e?1:0,!1,t);return Dt(this,{type:(e?"Multi":"")+"LineString",coordinates:i})}}),Bt.include({toGeoJSON:function(t){var e=!ot(this._latlngs),i=e&&!ot(this._latlngs[0]),n=ge(this._latlngs,i?2:e?1:0,!0,t);return e||(n=[n]),Dt(this,{type:(i?"Multi":"")+"Polygon",coordinates:n})}}),Ot.include({toMultiPoint:function(t){var e=[];return this.eachLayer(function(i){e.push(i.toGeoJSON(t).geometry.coordinates)}),Dt(this,{type:"MultiPoint",coordinates:e})},toGeoJSON:function(t){var e=this.feature&&this.feature.geometry&&this.feature.geometry.type;if(e==="MultiPoint")return this.toMultiPoint(t);var i=e==="GeometryCollection",n=[];return this.eachLayer(function(s){if(s.toGeoJSON){var a=s.toGeoJSON(t);if(i)n.push(a.geometry);else{var l=ve(a);l.type==="FeatureCollection"?n.push.apply(n,l.features):n.push(l)}}}),i?Dt(this,{geometries:n,type:"GeometryCollection"}):{type:"FeatureCollection",features:n}}});function nn(t,e){return new yt(t,e)}var Os=nn,ye=ct.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(t,e,i){this._url=t,this._bounds=q(e),P(this,i)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(E(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){U(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(t){return this.options.opacity=t,this._image&&this._updateOpacity(),this},setStyle:function(t){return t.opacity&&this.setOpacity(t.opacity),this},bringToFront:function(){return this._map&&At(this._image),this},bringToBack:function(){return this._map&&It(this._image),this},setUrl:function(t){return this._url=t,this._image&&(this._image.src=t),this},setBounds:function(t){return this._bounds=q(t),this._map&&this._reset(),this},getEvents:function(){var t={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},setZIndex:function(t){return this.options.zIndex=t,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var t=this._url.tagName==="IMG",e=this._image=t?this._url:D("img");if(E(e,"leaflet-image-layer"),this._zoomAnimated&&E(e,"leaflet-zoom-animated"),this.options.className&&E(e,this.options.className),e.onselectstart=g,e.onmousemove=g,e.onload=y(this.fire,this,"load"),e.onerror=y(this._overlayOnError,this,"error"),(this.options.crossOrigin||this.options.crossOrigin==="")&&(e.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),t){this._url=e.src;return}e.src=this._url,e.alt=this.options.alt},_animateZoom:function(t){var e=this._map.getZoomScale(t.zoom),i=this._map._latLngBoundsToNewLayerBounds(this._bounds,t.zoom,t.center).min;Tt(this._image,i,e)},_reset:function(){var t=this._image,e=new F(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),i=e.getSize();j(t,e.min),t.style.width=i.x+"px",t.style.height=i.y+"px"},_updateOpacity:function(){st(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var t=this.options.errorOverlayUrl;t&&this._url!==t&&(this._url=t,this._image.src=t)},getCenter:function(){return this._bounds.getCenter()}}),zs=function(t,e,i){return new ye(t,e,i)},sn=ye.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var t=this._url.tagName==="VIDEO",e=this._image=t?this._url:D("video");if(E(e,"leaflet-image-layer"),this._zoomAnimated&&E(e,"leaflet-zoom-animated"),this.options.className&&E(e,this.options.className),e.onselectstart=g,e.onmousemove=g,e.onloadeddata=y(this.fire,this,"load"),t){for(var i=e.getElementsByTagName("source"),n=[],s=0;s<i.length;s++)n.push(i[s].src);this._url=i.length>0?n:[e.src];return}at(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(e.style,"objectFit")&&(e.style.objectFit="fill"),e.autoplay=!!this.options.autoplay,e.loop=!!this.options.loop,e.muted=!!this.options.muted,e.playsInline=!!this.options.playsInline;for(var a=0;a<this._url.length;a++){var l=D("source");l.src=this._url[a],e.appendChild(l)}}});function Bs(t,e,i){return new sn(t,e,i)}var on=ye.extend({_initImage:function(){var t=this._image=this._url;E(t,"leaflet-image-layer"),this._zoomAnimated&&E(t,"leaflet-zoom-animated"),this.options.className&&E(t,this.options.className),t.onselectstart=g,t.onmousemove=g}});function Ds(t,e,i){return new on(t,e,i)}var ft=ct.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(t,e){t&&(t instanceof R||at(t))?(this._latlng=O(t),P(this,e)):(P(this,t),this._source=e),this.options.content&&(this._content=this.options.content)},openOn:function(t){return t=arguments.length?t:this._source._map,t.hasLayer(this)||t.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(t){return this._map?this.close():(arguments.length?this._source=t:t=this._source,this._prepareOpen(),this.openOn(t._map)),this},onAdd:function(t){this._zoomAnimated=t._zoomAnimated,this._container||this._initLayout(),t._fadeAnimated&&st(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),t._fadeAnimated&&st(this._container,1),this.bringToFront(),this.options.interactive&&(E(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(t){t._fadeAnimated?(st(this._container,0),this._removeTimeout=setTimeout(y(U,void 0,this._container),200)):U(this._container),this.options.interactive&&(W(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(t){return this._latlng=O(t),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(t){return this._content=t,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var t={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&At(this._container),this},bringToBack:function(){return this._map&&It(this._container),this},_prepareOpen:function(t){var e=this._source;if(!e._map)return!1;if(e instanceof gt){e=null;var i=this._source._layers;for(var n in i)if(i[n]._map){e=i[n];break}if(!e)return!1;this._source=e}if(!t)if(e.getCenter)t=e.getCenter();else if(e.getLatLng)t=e.getLatLng();else if(e.getBounds)t=e.getBounds().getCenter();else throw new Error("Unable to get source layer LatLng.");return this.setLatLng(t),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var t=this._contentNode,e=typeof this._content=="function"?this._content(this._source||this):this._content;if(typeof e=="string")t.innerHTML=e;else{for(;t.hasChildNodes();)t.removeChild(t.firstChild);t.appendChild(e)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var t=this._map.latLngToLayerPoint(this._latlng),e=T(this.options.offset),i=this._getAnchor();this._zoomAnimated?j(this._container,t.add(i)):e=e.add(t).add(i);var n=this._containerBottom=-e.y,s=this._containerLeft=-Math.round(this._containerWidth/2)+e.x;this._container.style.bottom=n+"px",this._container.style.left=s+"px"}},_getAnchor:function(){return[0,0]}});z.include({_initOverlay:function(t,e,i,n){var s=e;return s instanceof t||(s=new t(n).setContent(e)),i&&s.setLatLng(i),s}}),ct.include({_initOverlay:function(t,e,i,n){var s=i;return s instanceof t?(P(s,n),s._source=this):(s=e&&!n?e:new t(n,this),s.setContent(i)),s}});var be=ft.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(t){return t=arguments.length?t:this._source._map,!t.hasLayer(this)&&t._popup&&t._popup.options.autoClose&&t.removeLayer(t._popup),t._popup=this,ft.prototype.openOn.call(this,t)},onAdd:function(t){ft.prototype.onAdd.call(this,t),t.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof Lt||this._source.on("preclick",kt))},onRemove:function(t){ft.prototype.onRemove.call(this,t),t.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof Lt||this._source.off("preclick",kt))},getEvents:function(){var t=ft.prototype.getEvents.call(this);return(this.options.closeOnClick!==void 0?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(t.preclick=this.close),this.options.keepInView&&(t.moveend=this._adjustPan),t},_initLayout:function(){var t="leaflet-popup",e=this._container=D("div",t+" "+(this.options.className||"")+" leaflet-zoom-animated"),i=this._wrapper=D("div",t+"-content-wrapper",e);if(this._contentNode=D("div",t+"-content",i),Yt(e),Ye(this._contentNode),S(e,"contextmenu",kt),this._tipContainer=D("div",t+"-tip-container",e),this._tip=D("div",t+"-tip",this._tipContainer),this.options.closeButton){var n=this._closeButton=D("a",t+"-close-button",e);n.setAttribute("role","button"),n.setAttribute("aria-label","Close popup"),n.href="#close",n.innerHTML='<span aria-hidden="true">&#215;</span>',S(n,"click",function(s){Y(s),this.close()},this)}},_updateLayout:function(){var t=this._contentNode,e=t.style;e.width="",e.whiteSpace="nowrap";var i=t.offsetWidth;i=Math.min(i,this.options.maxWidth),i=Math.max(i,this.options.minWidth),e.width=i+1+"px",e.whiteSpace="",e.height="";var n=t.offsetHeight,s=this.options.maxHeight,a="leaflet-popup-scrolled";s&&n>s?(e.height=s+"px",E(t,a)):W(t,a),this._containerWidth=this._container.offsetWidth},_animateZoom:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center),i=this._getAnchor();j(this._container,e.add(i))},_adjustPan:function(){if(this.options.autoPan){if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning){this._autopanning=!1;return}var t=this._map,e=parseInt(qt(this._container,"marginBottom"),10)||0,i=this._container.offsetHeight+e,n=this._containerWidth,s=new k(this._containerLeft,-i-this._containerBottom);s._add(Pt(this._container));var a=t.layerPointToContainerPoint(s),l=T(this.options.autoPanPadding),h=T(this.options.autoPanPaddingTopLeft||l),u=T(this.options.autoPanPaddingBottomRight||l),f=t.getSize(),v=0,w=0;a.x+n+u.x>f.x&&(v=a.x+n-f.x+u.x),a.x-v-h.x<0&&(v=a.x-h.x),a.y+i+u.y>f.y&&(w=a.y+i-f.y+u.y),a.y-w-h.y<0&&(w=a.y-h.y),(v||w)&&(this.options.keepInView&&(this._autopanning=!0),t.fire("autopanstart").panBy([v,w]))}},_getAnchor:function(){return T(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),Ns=function(t,e){return new be(t,e)};z.mergeOptions({closePopupOnClick:!0}),z.include({openPopup:function(t,e,i){return this._initOverlay(be,t,e,i).openOn(this),this},closePopup:function(t){return t=arguments.length?t:this._popup,t&&t.close(),this}}),ct.include({bindPopup:function(t,e){return this._popup=this._initOverlay(be,this._popup,t,e),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(t){return this._popup&&(this instanceof gt||(this._popup._source=this),this._popup._prepareOpen(t||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return this._popup?this._popup.isOpen():!1},setPopupContent:function(t){return this._popup&&this._popup.setContent(t),this},getPopup:function(){return this._popup},_openPopup:function(t){if(!(!this._popup||!this._map)){St(t);var e=t.layer||t.target;if(this._popup._source===e&&!(e instanceof Lt)){this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(t.latlng);return}this._popup._source=e,this.openPopup(t.latlng)}},_movePopup:function(t){this._popup.setLatLng(t.latlng)},_onKeyPress:function(t){t.originalEvent.keyCode===13&&this._openPopup(t)}});var xe=ft.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(t){ft.prototype.onAdd.call(this,t),this.setOpacity(this.options.opacity),t.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(t){ft.prototype.onRemove.call(this,t),t.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var t=ft.prototype.getEvents.call(this);return this.options.permanent||(t.preclick=this.close),t},_initLayout:function(){var t="leaflet-tooltip",e=t+" "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=D("div",e),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+b(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(t){var e,i,n=this._map,s=this._container,a=n.latLngToContainerPoint(n.getCenter()),l=n.layerPointToContainerPoint(t),h=this.options.direction,u=s.offsetWidth,f=s.offsetHeight,v=T(this.options.offset),w=this._getAnchor();h==="top"?(e=u/2,i=f):h==="bottom"?(e=u/2,i=0):h==="center"?(e=u/2,i=f/2):h==="right"?(e=0,i=f/2):h==="left"?(e=u,i=f/2):l.x<a.x?(h="right",e=0,i=f/2):(h="left",e=u+(v.x+w.x)*2,i=f/2),t=t.subtract(T(e,i,!0)).add(v).add(w),W(s,"leaflet-tooltip-right"),W(s,"leaflet-tooltip-left"),W(s,"leaflet-tooltip-top"),W(s,"leaflet-tooltip-bottom"),E(s,"leaflet-tooltip-"+h),j(s,t)},_updatePosition:function(){var t=this._map.latLngToLayerPoint(this._latlng);this._setPosition(t)},setOpacity:function(t){this.options.opacity=t,this._container&&st(this._container,t)},_animateZoom:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center);this._setPosition(e)},_getAnchor:function(){return T(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),Rs=function(t,e){return new xe(t,e)};z.include({openTooltip:function(t,e,i){return this._initOverlay(xe,t,e,i).openOn(this),this},closeTooltip:function(t){return t.close(),this}}),ct.include({bindTooltip:function(t,e){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(xe,this._tooltip,t,e),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(t){if(!(!t&&this._tooltipHandlersAdded)){var e=t?"off":"on",i={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?i.add=this._openTooltip:(i.mouseover=this._openTooltip,i.mouseout=this.closeTooltip,i.click=this._openTooltip,this._map?this._addFocusListeners():i.add=this._addFocusListeners),this._tooltip.options.sticky&&(i.mousemove=this._moveTooltip),this[e](i),this._tooltipHandlersAdded=!t}},openTooltip:function(t){return this._tooltip&&(this instanceof gt||(this._tooltip._source=this),this._tooltip._prepareOpen(t)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(t){return this._tooltip&&this._tooltip.setContent(t),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(t){var e=typeof t.getElement=="function"&&t.getElement();e&&(S(e,"focus",function(){this._tooltip._source=t,this.openTooltip()},this),S(e,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(t){var e=typeof t.getElement=="function"&&t.getElement();e&&e.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(t){if(!(!this._tooltip||!this._map)){if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var e=this;this._map.once("moveend",function(){e._openOnceFlag=!1,e._openTooltip(t)});return}this._tooltip._source=t.layer||t.target,this.openTooltip(this._tooltip.options.sticky?t.latlng:void 0)}},_moveTooltip:function(t){var e=t.latlng,i,n;this._tooltip.options.sticky&&t.originalEvent&&(i=this._map.mouseEventToContainerPoint(t.originalEvent),n=this._map.containerPointToLayerPoint(i),e=this._map.layerPointToLatLng(n)),this._tooltip.setLatLng(e)}});var rn=zt.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(t){var e=t&&t.tagName==="DIV"?t:document.createElement("div"),i=this.options;if(i.html instanceof Element?(ae(e),e.appendChild(i.html)):e.innerHTML=i.html!==!1?i.html:"",i.bgPos){var n=T(i.bgPos);e.style.backgroundPosition=-n.x+"px "+-n.y+"px"}return this._setIconStyles(e,"icon"),e},createShadow:function(){return null}});function Zs(t){return new rn(t)}zt.Default=Xt;var Qt=ct.extend({options:{tileSize:256,opacity:1,updateWhenIdle:x.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(t){P(this,t)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(t){t._addZoomLimit(this)},onRemove:function(t){this._removeAllTiles(),U(this._container),t._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(At(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(It(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(t){return this.options.opacity=t,this._updateOpacity(),this},setZIndex:function(t){return this.options.zIndex=t,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var t=this._clampZoom(this._map.getZoom());t!==this._tileZoom&&(this._tileZoom=t,this._updateLevels()),this._update()}return this},getEvents:function(){var t={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=M(this._onMoveEnd,this.options.updateInterval,this)),t.move=this._onMove),this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},createTile:function(){return document.createElement("div")},getTileSize:function(){var t=this.options.tileSize;return t instanceof k?t:new k(t,t)},_updateZIndex:function(){this._container&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(t){for(var e=this.getPane().children,i=-t(-1/0,1/0),n=0,s=e.length,a;n<s;n++)a=e[n].style.zIndex,e[n]!==this._container&&a&&(i=t(i,+a));isFinite(i)&&(this.options.zIndex=i+t(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!x.ielt9){st(this._container,this.options.opacity);var t=+new Date,e=!1,i=!1;for(var n in this._tiles){var s=this._tiles[n];if(!(!s.current||!s.loaded)){var a=Math.min(1,(t-s.loaded)/200);st(s.el,a),a<1?e=!0:(s.active?i=!0:this._onOpaqueTile(s),s.active=!0)}}i&&!this._noPrune&&this._pruneTiles(),e&&(nt(this._fadeFrame),this._fadeFrame=J(this._updateOpacity,this))}},_onOpaqueTile:g,_initContainer:function(){this._container||(this._container=D("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var t=this._tileZoom,e=this.options.maxZoom;if(t!==void 0){for(var i in this._levels)i=Number(i),this._levels[i].el.children.length||i===t?(this._levels[i].el.style.zIndex=e-Math.abs(t-i),this._onUpdateLevel(i)):(U(this._levels[i].el),this._removeTilesAtZoom(i),this._onRemoveLevel(i),delete this._levels[i]);var n=this._levels[t],s=this._map;return n||(n=this._levels[t]={},n.el=D("div","leaflet-tile-container leaflet-zoom-animated",this._container),n.el.style.zIndex=e,n.origin=s.project(s.unproject(s.getPixelOrigin()),t).round(),n.zoom=t,this._setZoomTransform(n,s.getCenter(),s.getZoom()),g(n.el.offsetWidth),this._onCreateLevel(n)),this._level=n,n}},_onUpdateLevel:g,_onRemoveLevel:g,_onCreateLevel:g,_pruneTiles:function(){if(this._map){var t,e,i=this._map.getZoom();if(i>this.options.maxZoom||i<this.options.minZoom){this._removeAllTiles();return}for(t in this._tiles)e=this._tiles[t],e.retain=e.current;for(t in this._tiles)if(e=this._tiles[t],e.current&&!e.active){var n=e.coords;this._retainParent(n.x,n.y,n.z,n.z-5)||this._retainChildren(n.x,n.y,n.z,n.z+2)}for(t in this._tiles)this._tiles[t].retain||this._removeTile(t)}},_removeTilesAtZoom:function(t){for(var e in this._tiles)this._tiles[e].coords.z===t&&this._removeTile(e)},_removeAllTiles:function(){for(var t in this._tiles)this._removeTile(t)},_invalidateAll:function(){for(var t in this._levels)U(this._levels[t].el),this._onRemoveLevel(Number(t)),delete this._levels[t];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(t,e,i,n){var s=Math.floor(t/2),a=Math.floor(e/2),l=i-1,h=new k(+s,+a);h.z=+l;var u=this._tileCoordsToKey(h),f=this._tiles[u];return f&&f.active?(f.retain=!0,!0):(f&&f.loaded&&(f.retain=!0),l>n?this._retainParent(s,a,l,n):!1)},_retainChildren:function(t,e,i,n){for(var s=2*t;s<2*t+2;s++)for(var a=2*e;a<2*e+2;a++){var l=new k(s,a);l.z=i+1;var h=this._tileCoordsToKey(l),u=this._tiles[h];if(u&&u.active){u.retain=!0;continue}else u&&u.loaded&&(u.retain=!0);i+1<n&&this._retainChildren(s,a,i+1,n)}},_resetView:function(t){var e=t&&(t.pinch||t.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),e,e)},_animateZoom:function(t){this._setView(t.center,t.zoom,!0,t.noUpdate)},_clampZoom:function(t){var e=this.options;return e.minNativeZoom!==void 0&&t<e.minNativeZoom?e.minNativeZoom:e.maxNativeZoom!==void 0&&e.maxNativeZoom<t?e.maxNativeZoom:t},_setView:function(t,e,i,n){var s=Math.round(e);this.options.maxZoom!==void 0&&s>this.options.maxZoom||this.options.minZoom!==void 0&&s<this.options.minZoom?s=void 0:s=this._clampZoom(s);var a=this.options.updateWhenZooming&&s!==this._tileZoom;(!n||a)&&(this._tileZoom=s,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),s!==void 0&&this._update(t),i||this._pruneTiles(),this._noPrune=!!i),this._setZoomTransforms(t,e)},_setZoomTransforms:function(t,e){for(var i in this._levels)this._setZoomTransform(this._levels[i],t,e)},_setZoomTransform:function(t,e,i){var n=this._map.getZoomScale(i,t.zoom),s=t.origin.multiplyBy(n).subtract(this._map._getNewPixelOrigin(e,i)).round();x.any3d?Tt(t.el,s,n):j(t.el,s)},_resetGrid:function(){var t=this._map,e=t.options.crs,i=this._tileSize=this.getTileSize(),n=this._tileZoom,s=this._map.getPixelWorldBounds(this._tileZoom);s&&(this._globalTileRange=this._pxBoundsToTileRange(s)),this._wrapX=e.wrapLng&&!this.options.noWrap&&[Math.floor(t.project([0,e.wrapLng[0]],n).x/i.x),Math.ceil(t.project([0,e.wrapLng[1]],n).x/i.y)],this._wrapY=e.wrapLat&&!this.options.noWrap&&[Math.floor(t.project([e.wrapLat[0],0],n).y/i.x),Math.ceil(t.project([e.wrapLat[1],0],n).y/i.y)]},_onMoveEnd:function(){!this._map||this._map._animatingZoom||this._update()},_getTiledPixelBounds:function(t){var e=this._map,i=e._animatingZoom?Math.max(e._animateToZoom,e.getZoom()):e.getZoom(),n=e.getZoomScale(i,this._tileZoom),s=e.project(t,this._tileZoom).floor(),a=e.getSize().divideBy(n*2);return new F(s.subtract(a),s.add(a))},_update:function(t){var e=this._map;if(e){var i=this._clampZoom(e.getZoom());if(t===void 0&&(t=e.getCenter()),this._tileZoom!==void 0){var n=this._getTiledPixelBounds(t),s=this._pxBoundsToTileRange(n),a=s.getCenter(),l=[],h=this.options.keepBuffer,u=new F(s.getBottomLeft().subtract([h,-h]),s.getTopRight().add([h,-h]));if(!(isFinite(s.min.x)&&isFinite(s.min.y)&&isFinite(s.max.x)&&isFinite(s.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var f in this._tiles){var v=this._tiles[f].coords;(v.z!==this._tileZoom||!u.contains(new k(v.x,v.y)))&&(this._tiles[f].current=!1)}if(Math.abs(i-this._tileZoom)>1){this._setView(t,i);return}for(var w=s.min.y;w<=s.max.y;w++)for(var A=s.min.x;A<=s.max.x;A++){var K=new k(A,w);if(K.z=this._tileZoom,!!this._isValidTile(K)){var G=this._tiles[this._tileCoordsToKey(K)];G?G.current=!0:l.push(K)}}if(l.sort(function(tt,Rt){return tt.distanceTo(a)-Rt.distanceTo(a)}),l.length!==0){this._loading||(this._loading=!0,this.fire("loading"));var rt=document.createDocumentFragment();for(A=0;A<l.length;A++)this._addTile(l[A],rt);this._level.el.appendChild(rt)}}}},_isValidTile:function(t){var e=this._map.options.crs;if(!e.infinite){var i=this._globalTileRange;if(!e.wrapLng&&(t.x<i.min.x||t.x>i.max.x)||!e.wrapLat&&(t.y<i.min.y||t.y>i.max.y))return!1}if(!this.options.bounds)return!0;var n=this._tileCoordsToBounds(t);return q(this.options.bounds).overlaps(n)},_keyToBounds:function(t){return this._tileCoordsToBounds(this._keyToTileCoords(t))},_tileCoordsToNwSe:function(t){var e=this._map,i=this.getTileSize(),n=t.scaleBy(i),s=n.add(i),a=e.unproject(n,t.z),l=e.unproject(s,t.z);return[a,l]},_tileCoordsToBounds:function(t){var e=this._tileCoordsToNwSe(t),i=new Q(e[0],e[1]);return this.options.noWrap||(i=this._map.wrapLatLngBounds(i)),i},_tileCoordsToKey:function(t){return t.x+":"+t.y+":"+t.z},_keyToTileCoords:function(t){var e=t.split(":"),i=new k(+e[0],+e[1]);return i.z=+e[2],i},_removeTile:function(t){var e=this._tiles[t];e&&(U(e.el),delete this._tiles[t],this.fire("tileunload",{tile:e.el,coords:this._keyToTileCoords(t)}))},_initTile:function(t){E(t,"leaflet-tile");var e=this.getTileSize();t.style.width=e.x+"px",t.style.height=e.y+"px",t.onselectstart=g,t.onmousemove=g,x.ielt9&&this.options.opacity<1&&st(t,this.options.opacity)},_addTile:function(t,e){var i=this._getTilePos(t),n=this._tileCoordsToKey(t),s=this.createTile(this._wrapCoords(t),y(this._tileReady,this,t));this._initTile(s),this.createTile.length<2&&J(y(this._tileReady,this,t,null,s)),j(s,i),this._tiles[n]={el:s,coords:t,current:!0},e.appendChild(s),this.fire("tileloadstart",{tile:s,coords:t})},_tileReady:function(t,e,i){e&&this.fire("tileerror",{error:e,tile:i,coords:t});var n=this._tileCoordsToKey(t);i=this._tiles[n],i&&(i.loaded=+new Date,this._map._fadeAnimated?(st(i.el,0),nt(this._fadeFrame),this._fadeFrame=J(this._updateOpacity,this)):(i.active=!0,this._pruneTiles()),e||(E(i.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:i.el,coords:t})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),x.ielt9||!this._map._fadeAnimated?J(this._pruneTiles,this):setTimeout(y(this._pruneTiles,this),250)))},_getTilePos:function(t){return t.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(t){var e=new k(this._wrapX?Z(t.x,this._wrapX):t.x,this._wrapY?Z(t.y,this._wrapY):t.y);return e.z=t.z,e},_pxBoundsToTileRange:function(t){var e=this.getTileSize();return new F(t.min.unscaleBy(e).floor(),t.max.unscaleBy(e).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var t in this._tiles)if(!this._tiles[t].loaded)return!1;return!0}});function Hs(t){return new Qt(t)}var Nt=Qt.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(t,e){this._url=t,e=P(this,e),e.detectRetina&&x.retina&&e.maxZoom>0?(e.tileSize=Math.floor(e.tileSize/2),e.zoomReverse?(e.zoomOffset--,e.minZoom=Math.min(e.maxZoom,e.minZoom+1)):(e.zoomOffset++,e.maxZoom=Math.max(e.minZoom,e.maxZoom-1)),e.minZoom=Math.max(0,e.minZoom)):e.zoomReverse?e.minZoom=Math.min(e.maxZoom,e.minZoom):e.maxZoom=Math.max(e.minZoom,e.maxZoom),typeof e.subdomains=="string"&&(e.subdomains=e.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(t,e){return this._url===t&&e===void 0&&(e=!0),this._url=t,e||this.redraw(),this},createTile:function(t,e){var i=document.createElement("img");return S(i,"load",y(this._tileOnLoad,this,e,i)),S(i,"error",y(this._tileOnError,this,e,i)),(this.options.crossOrigin||this.options.crossOrigin==="")&&(i.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),typeof this.options.referrerPolicy=="string"&&(i.referrerPolicy=this.options.referrerPolicy),i.alt="",i.src=this.getTileUrl(t),i},getTileUrl:function(t){var e={r:x.retina?"@2x":"",s:this._getSubdomain(t),x:t.x,y:t.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var i=this._globalTileRange.max.y-t.y;this.options.tms&&(e.y=i),e["-y"]=i}return Ht(this._url,d(e,this.options))},_tileOnLoad:function(t,e){x.ielt9?setTimeout(y(t,this,null,e),0):t(null,e)},_tileOnError:function(t,e,i){var n=this.options.errorTileUrl;n&&e.getAttribute("src")!==n&&(e.src=n),t(i,e)},_onTileRemove:function(t){t.tile.onload=null},_getZoomForUrl:function(){var t=this._tileZoom,e=this.options.maxZoom,i=this.options.zoomReverse,n=this.options.zoomOffset;return i&&(t=e-t),t+n},_getSubdomain:function(t){var e=Math.abs(t.x+t.y)%this.options.subdomains.length;return this.options.subdomains[e]},_abortLoading:function(){var t,e;for(t in this._tiles)if(this._tiles[t].coords.z!==this._tileZoom&&(e=this._tiles[t].el,e.onload=g,e.onerror=g,!e.complete)){e.src=se;var i=this._tiles[t].coords;U(e),delete this._tiles[t],this.fire("tileabort",{tile:e,coords:i})}},_removeTile:function(t){var e=this._tiles[t];if(e)return e.el.setAttribute("src",se),Qt.prototype._removeTile.call(this,t)},_tileReady:function(t,e,i){if(!(!this._map||i&&i.getAttribute("src")===se))return Qt.prototype._tileReady.call(this,t,e,i)}});function an(t,e){return new Nt(t,e)}var ln=Nt.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(t,e){this._url=t;var i=d({},this.defaultWmsParams);for(var n in e)n in this.options||(i[n]=e[n]);e=P(this,e);var s=e.detectRetina&&x.retina?2:1,a=this.getTileSize();i.width=a.x*s,i.height=a.y*s,this.wmsParams=i},onAdd:function(t){this._crs=this.options.crs||t.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var e=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[e]=this._crs.code,Nt.prototype.onAdd.call(this,t)},getTileUrl:function(t){var e=this._tileCoordsToNwSe(t),i=this._crs,n=X(i.project(e[0]),i.project(e[1])),s=n.min,a=n.max,l=(this._wmsVersion>=1.3&&this._crs===Qi?[s.y,s.x,a.y,a.x]:[s.x,s.y,a.x,a.y]).join(","),h=Nt.prototype.getTileUrl.call(this,t);return h+pt(this.wmsParams,h,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+l},setParams:function(t,e){return d(this.wmsParams,t),e||this.redraw(),this}});function $s(t,e){return new ln(t,e)}Nt.WMS=ln,an.wms=$s;var bt=ct.extend({options:{padding:.1},initialize:function(t){P(this,t),b(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),E(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var t={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(t.zoomanim=this._onAnimZoom),t},_onAnimZoom:function(t){this._updateTransform(t.center,t.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(t,e){var i=this._map.getZoomScale(e,this._zoom),n=this._map.getSize().multiplyBy(.5+this.options.padding),s=this._map.project(this._center,e),a=n.multiplyBy(-i).add(s).subtract(this._map._getNewPixelOrigin(t,e));x.any3d?Tt(this._container,a,i):j(this._container,a)},_reset:function(){this._update(),this._updateTransform(this._center,this._zoom);for(var t in this._layers)this._layers[t]._reset()},_onZoomEnd:function(){for(var t in this._layers)this._layers[t]._project()},_updatePaths:function(){for(var t in this._layers)this._layers[t]._update()},_update:function(){var t=this.options.padding,e=this._map.getSize(),i=this._map.containerPointToLayerPoint(e.multiplyBy(-t)).round();this._bounds=new F(i,i.add(e.multiplyBy(1+t*2)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),cn=bt.extend({options:{tolerance:0},getEvents:function(){var t=bt.prototype.getEvents.call(this);return t.viewprereset=this._onViewPreReset,t},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){bt.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var t=this._container=document.createElement("canvas");S(t,"mousemove",this._onMouseMove,this),S(t,"click dblclick mousedown mouseup contextmenu",this._onClick,this),S(t,"mouseout",this._handleMouseOut,this),t._leaflet_disable_events=!0,this._ctx=t.getContext("2d")},_destroyContainer:function(){nt(this._redrawRequest),delete this._ctx,U(this._container),H(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){var t;this._redrawBounds=null;for(var e in this._layers)t=this._layers[e],t._update();this._redraw()}},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){bt.prototype._update.call(this);var t=this._bounds,e=this._container,i=t.getSize(),n=x.retina?2:1;j(e,t.min),e.width=n*i.x,e.height=n*i.y,e.style.width=i.x+"px",e.style.height=i.y+"px",x.retina&&this._ctx.scale(2,2),this._ctx.translate(-t.min.x,-t.min.y),this.fire("update")}},_reset:function(){bt.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(t){this._updateDashArray(t),this._layers[b(t)]=t;var e=t._order={layer:t,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=e),this._drawLast=e,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(t){this._requestRedraw(t)},_removePath:function(t){var e=t._order,i=e.next,n=e.prev;i?i.prev=n:this._drawLast=n,n?n.next=i:this._drawFirst=i,delete t._order,delete this._layers[b(t)],this._requestRedraw(t)},_updatePath:function(t){this._extendRedrawBounds(t),t._project(),t._update(),this._requestRedraw(t)},_updateStyle:function(t){this._updateDashArray(t),this._requestRedraw(t)},_updateDashArray:function(t){if(typeof t.options.dashArray=="string"){var e=t.options.dashArray.split(/[, ]+/),i=[],n,s;for(s=0;s<e.length;s++){if(n=Number(e[s]),isNaN(n))return;i.push(n)}t.options._dashArray=i}else t.options._dashArray=t.options.dashArray},_requestRedraw:function(t){this._map&&(this._extendRedrawBounds(t),this._redrawRequest=this._redrawRequest||J(this._redraw,this))},_extendRedrawBounds:function(t){if(t._pxBounds){var e=(t.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new F,this._redrawBounds.extend(t._pxBounds.min.subtract([e,e])),this._redrawBounds.extend(t._pxBounds.max.add([e,e]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var t=this._redrawBounds;if(t){var e=t.getSize();this._ctx.clearRect(t.min.x,t.min.y,e.x,e.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var t,e=this._redrawBounds;if(this._ctx.save(),e){var i=e.getSize();this._ctx.beginPath(),this._ctx.rect(e.min.x,e.min.y,i.x,i.y),this._ctx.clip()}this._drawing=!0;for(var n=this._drawFirst;n;n=n.next)t=n.layer,(!e||t._pxBounds&&t._pxBounds.intersects(e))&&t._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(t,e){if(this._drawing){var i,n,s,a,l=t._parts,h=l.length,u=this._ctx;if(h){for(u.beginPath(),i=0;i<h;i++){for(n=0,s=l[i].length;n<s;n++)a=l[i][n],u[n?"lineTo":"moveTo"](a.x,a.y);e&&u.closePath()}this._fillStroke(u,t)}}},_updateCircle:function(t){if(!(!this._drawing||t._empty())){var e=t._point,i=this._ctx,n=Math.max(Math.round(t._radius),1),s=(Math.max(Math.round(t._radiusY),1)||n)/n;s!==1&&(i.save(),i.scale(1,s)),i.beginPath(),i.arc(e.x,e.y/s,n,0,Math.PI*2,!1),s!==1&&i.restore(),this._fillStroke(i,t)}},_fillStroke:function(t,e){var i=e.options;i.fill&&(t.globalAlpha=i.fillOpacity,t.fillStyle=i.fillColor||i.color,t.fill(i.fillRule||"evenodd")),i.stroke&&i.weight!==0&&(t.setLineDash&&t.setLineDash(e.options&&e.options._dashArray||[]),t.globalAlpha=i.opacity,t.lineWidth=i.weight,t.strokeStyle=i.color,t.lineCap=i.lineCap,t.lineJoin=i.lineJoin,t.stroke())},_onClick:function(t){for(var e=this._map.mouseEventToLayerPoint(t),i,n,s=this._drawFirst;s;s=s.next)i=s.layer,i.options.interactive&&i._containsPoint(e)&&(!(t.type==="click"||t.type==="preclick")||!this._map._draggableMoved(i))&&(n=i);this._fireEvent(n?[n]:!1,t)},_onMouseMove:function(t){if(!(!this._map||this._map.dragging.moving()||this._map._animatingZoom)){var e=this._map.mouseEventToLayerPoint(t);this._handleMouseHover(t,e)}},_handleMouseOut:function(t){var e=this._hoveredLayer;e&&(W(this._container,"leaflet-interactive"),this._fireEvent([e],t,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(t,e){if(!this._mouseHoverThrottled){for(var i,n,s=this._drawFirst;s;s=s.next)i=s.layer,i.options.interactive&&i._containsPoint(e)&&(n=i);n!==this._hoveredLayer&&(this._handleMouseOut(t),n&&(E(this._container,"leaflet-interactive"),this._fireEvent([n],t,"mouseover"),this._hoveredLayer=n)),this._fireEvent(this._hoveredLayer?[this._hoveredLayer]:!1,t),this._mouseHoverThrottled=!0,setTimeout(y(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(t,e,i){this._map._fireDOMEvent(e,i||e.type,t)},_bringToFront:function(t){var e=t._order;if(e){var i=e.next,n=e.prev;if(i)i.prev=n;else return;n?n.next=i:i&&(this._drawFirst=i),e.prev=this._drawLast,this._drawLast.next=e,e.next=null,this._drawLast=e,this._requestRedraw(t)}},_bringToBack:function(t){var e=t._order;if(e){var i=e.next,n=e.prev;if(n)n.next=i;else return;i?i.prev=n:n&&(this._drawLast=n),e.prev=null,e.next=this._drawFirst,this._drawFirst.prev=e,this._drawFirst=e,this._requestRedraw(t)}}});function hn(t){return x.canvas?new cn(t):null}var te=(function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(t){return document.createElement("<lvml:"+t+' class="lvml">')}}catch{}return function(t){return document.createElement("<"+t+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}})(),Fs={_initContainer:function(){this._container=D("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(bt.prototype._update.call(this),this.fire("update"))},_initPath:function(t){var e=t._container=te("shape");E(e,"leaflet-vml-shape "+(this.options.className||"")),e.coordsize="1 1",t._path=te("path"),e.appendChild(t._path),this._updateStyle(t),this._layers[b(t)]=t},_addPath:function(t){var e=t._container;this._container.appendChild(e),t.options.interactive&&t.addInteractiveTarget(e)},_removePath:function(t){var e=t._container;U(e),t.removeInteractiveTarget(e),delete this._layers[b(t)]},_updateStyle:function(t){var e=t._stroke,i=t._fill,n=t.options,s=t._container;s.stroked=!!n.stroke,s.filled=!!n.fill,n.stroke?(e||(e=t._stroke=te("stroke")),s.appendChild(e),e.weight=n.weight+"px",e.color=n.color,e.opacity=n.opacity,n.dashArray?e.dashStyle=at(n.dashArray)?n.dashArray.join(" "):n.dashArray.replace(/( *, *)/g," "):e.dashStyle="",e.endcap=n.lineCap.replace("butt","flat"),e.joinstyle=n.lineJoin):e&&(s.removeChild(e),t._stroke=null),n.fill?(i||(i=t._fill=te("fill")),s.appendChild(i),i.color=n.fillColor||n.color,i.opacity=n.fillOpacity):i&&(s.removeChild(i),t._fill=null)},_updateCircle:function(t){var e=t._point.round(),i=Math.round(t._radius),n=Math.round(t._radiusY||i);this._setPath(t,t._empty()?"M0 0":"AL "+e.x+","+e.y+" "+i+","+n+" 0,"+65535*360)},_setPath:function(t,e){t._path.v=e},_bringToFront:function(t){At(t._container)},_bringToBack:function(t){It(t._container)}},we=x.vml?te:fi,ee=bt.extend({_initContainer:function(){this._container=we("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=we("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){U(this._container),H(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){bt.prototype._update.call(this);var t=this._bounds,e=t.getSize(),i=this._container;(!this._svgSize||!this._svgSize.equals(e))&&(this._svgSize=e,i.setAttribute("width",e.x),i.setAttribute("height",e.y)),j(i,t.min),i.setAttribute("viewBox",[t.min.x,t.min.y,e.x,e.y].join(" ")),this.fire("update")}},_initPath:function(t){var e=t._path=we("path");t.options.className&&E(e,t.options.className),t.options.interactive&&E(e,"leaflet-interactive"),this._updateStyle(t),this._layers[b(t)]=t},_addPath:function(t){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(t._path),t.addInteractiveTarget(t._path)},_removePath:function(t){U(t._path),t.removeInteractiveTarget(t._path),delete this._layers[b(t)]},_updatePath:function(t){t._project(),t._update()},_updateStyle:function(t){var e=t._path,i=t.options;e&&(i.stroke?(e.setAttribute("stroke",i.color),e.setAttribute("stroke-opacity",i.opacity),e.setAttribute("stroke-width",i.weight),e.setAttribute("stroke-linecap",i.lineCap),e.setAttribute("stroke-linejoin",i.lineJoin),i.dashArray?e.setAttribute("stroke-dasharray",i.dashArray):e.removeAttribute("stroke-dasharray"),i.dashOffset?e.setAttribute("stroke-dashoffset",i.dashOffset):e.removeAttribute("stroke-dashoffset")):e.setAttribute("stroke","none"),i.fill?(e.setAttribute("fill",i.fillColor||i.color),e.setAttribute("fill-opacity",i.fillOpacity),e.setAttribute("fill-rule",i.fillRule||"evenodd")):e.setAttribute("fill","none"))},_updatePoly:function(t,e){this._setPath(t,pi(t._parts,e))},_updateCircle:function(t){var e=t._point,i=Math.max(Math.round(t._radius),1),n=Math.max(Math.round(t._radiusY),1)||i,s="a"+i+","+n+" 0 1,0 ",a=t._empty()?"M0 0":"M"+(e.x-i)+","+e.y+s+i*2+",0 "+s+-i*2+",0 ";this._setPath(t,a)},_setPath:function(t,e){t._path.setAttribute("d",e)},_bringToFront:function(t){At(t._path)},_bringToBack:function(t){It(t._path)}});x.vml&&ee.include(Fs);function dn(t){return x.svg||x.vml?new ee(t):null}z.include({getRenderer:function(t){var e=t.options.renderer||this._getPaneRenderer(t.options.pane)||this.options.renderer||this._renderer;return e||(e=this._renderer=this._createRenderer()),this.hasLayer(e)||this.addLayer(e),e},_getPaneRenderer:function(t){if(t==="overlayPane"||t===void 0)return!1;var e=this._paneRenderers[t];return e===void 0&&(e=this._createRenderer({pane:t}),this._paneRenderers[t]=e),e},_createRenderer:function(t){return this.options.preferCanvas&&hn(t)||dn(t)}});var un=Bt.extend({initialize:function(t,e){Bt.prototype.initialize.call(this,this._boundsToLatLngs(t),e)},setBounds:function(t){return this.setLatLngs(this._boundsToLatLngs(t))},_boundsToLatLngs:function(t){return t=q(t),[t.getSouthWest(),t.getNorthWest(),t.getNorthEast(),t.getSouthEast()]}});function Us(t,e){return new un(t,e)}ee.create=we,ee.pointsToPath=pi,yt.geometryToLayer=me,yt.coordsToLatLng=si,yt.coordsToLatLngs=_e,yt.latLngToCoords=oi,yt.latLngsToCoords=ge,yt.getFeature=Dt,yt.asFeature=ve,z.mergeOptions({boxZoom:!0});var fn=ut.extend({initialize:function(t){this._map=t,this._container=t._container,this._pane=t._panes.overlayPane,this._resetStateTimeout=0,t.on("unload",this._destroy,this)},addHooks:function(){S(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){H(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){U(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){this._resetStateTimeout!==0&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(t){if(!t.shiftKey||t.which!==1&&t.button!==1)return!1;this._clearDeferredResetState(),this._resetState(),jt(),$e(),this._startPoint=this._map.mouseEventToContainerPoint(t),S(document,{contextmenu:St,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(t){this._moved||(this._moved=!0,this._box=D("div","leaflet-zoom-box",this._container),E(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(t);var e=new F(this._point,this._startPoint),i=e.getSize();j(this._box,e.min),this._box.style.width=i.x+"px",this._box.style.height=i.y+"px"},_finish:function(){this._moved&&(U(this._box),W(this._container,"leaflet-crosshair")),Vt(),Fe(),H(document,{contextmenu:St,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(t){if(!(t.which!==1&&t.button!==1)&&(this._finish(),!!this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(y(this._resetState,this),0);var e=new Q(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(e).fire("boxzoomend",{boxZoomBounds:e})}},_onKeyDown:function(t){t.keyCode===27&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});z.addInitHook("addHandler","boxZoom",fn),z.mergeOptions({doubleClickZoom:!0});var pn=ut.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(t){var e=this._map,i=e.getZoom(),n=e.options.zoomDelta,s=t.originalEvent.shiftKey?i-n:i+n;e.options.doubleClickZoom==="center"?e.setZoom(s):e.setZoomAround(t.containerPoint,s)}});z.addInitHook("addHandler","doubleClickZoom",pn),z.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var mn=ut.extend({addHooks:function(){if(!this._draggable){var t=this._map;this._draggable=new wt(t._mapPane,t._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),t.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),t.on("zoomend",this._onZoomEnd,this),t.whenReady(this._onZoomEnd,this))}E(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){W(this._map._container,"leaflet-grab"),W(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var t=this._map;if(t._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var e=q(this._map.options.maxBounds);this._offsetLimit=X(this._map.latLngToContainerPoint(e.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(e.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;t.fire("movestart").fire("dragstart"),t.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(t){if(this._map.options.inertia){var e=this._lastTime=+new Date,i=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(i),this._times.push(e),this._prunePositions(e)}this._map.fire("move",t).fire("drag",t)},_prunePositions:function(t){for(;this._positions.length>1&&t-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var t=this._map.getSize().divideBy(2),e=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=e.subtract(t).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(t,e){return t-(t-e)*this._viscosity},_onPreDragLimit:function(){if(!(!this._viscosity||!this._offsetLimit)){var t=this._draggable._newPos.subtract(this._draggable._startPos),e=this._offsetLimit;t.x<e.min.x&&(t.x=this._viscousLimit(t.x,e.min.x)),t.y<e.min.y&&(t.y=this._viscousLimit(t.y,e.min.y)),t.x>e.max.x&&(t.x=this._viscousLimit(t.x,e.max.x)),t.y>e.max.y&&(t.y=this._viscousLimit(t.y,e.max.y)),this._draggable._newPos=this._draggable._startPos.add(t)}},_onPreDragWrap:function(){var t=this._worldWidth,e=Math.round(t/2),i=this._initialWorldOffset,n=this._draggable._newPos.x,s=(n-e+i)%t+e-i,a=(n+e+i)%t-e-i,l=Math.abs(s+i)<Math.abs(a+i)?s:a;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=l},_onDragEnd:function(t){var e=this._map,i=e.options,n=!i.inertia||t.noInertia||this._times.length<2;if(e.fire("dragend",t),n)e.fire("moveend");else{this._prunePositions(+new Date);var s=this._lastPos.subtract(this._positions[0]),a=(this._lastTime-this._times[0])/1e3,l=i.easeLinearity,h=s.multiplyBy(l/a),u=h.distanceTo([0,0]),f=Math.min(i.inertiaMaxSpeed,u),v=h.multiplyBy(f/u),w=f/(i.inertiaDeceleration*l),A=v.multiplyBy(-w/2).round();!A.x&&!A.y?e.fire("moveend"):(A=e._limitOffset(A,e.options.maxBounds),J(function(){e.panBy(A,{duration:w,easeLinearity:l,noMoveStart:!0,animate:!0})}))}}});z.addInitHook("addHandler","dragging",mn),z.mergeOptions({keyboard:!0,keyboardPanDelta:80});var _n=ut.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(t){this._map=t,this._setPanDelta(t.options.keyboardPanDelta),this._setZoomDelta(t.options.zoomDelta)},addHooks:function(){var t=this._map._container;t.tabIndex<=0&&(t.tabIndex="0"),S(t,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),H(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var t=document.body,e=document.documentElement,i=t.scrollTop||e.scrollTop,n=t.scrollLeft||e.scrollLeft;this._map._container.focus(),window.scrollTo(n,i)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(t){var e=this._panKeys={},i=this.keyCodes,n,s;for(n=0,s=i.left.length;n<s;n++)e[i.left[n]]=[-1*t,0];for(n=0,s=i.right.length;n<s;n++)e[i.right[n]]=[t,0];for(n=0,s=i.down.length;n<s;n++)e[i.down[n]]=[0,t];for(n=0,s=i.up.length;n<s;n++)e[i.up[n]]=[0,-1*t]},_setZoomDelta:function(t){var e=this._zoomKeys={},i=this.keyCodes,n,s;for(n=0,s=i.zoomIn.length;n<s;n++)e[i.zoomIn[n]]=t;for(n=0,s=i.zoomOut.length;n<s;n++)e[i.zoomOut[n]]=-t},_addHooks:function(){S(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){H(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(t){if(!(t.altKey||t.ctrlKey||t.metaKey)){var e=t.keyCode,i=this._map,n;if(e in this._panKeys){if(!i._panAnim||!i._panAnim._inProgress)if(n=this._panKeys[e],t.shiftKey&&(n=T(n).multiplyBy(3)),i.options.maxBounds&&(n=i._limitOffset(T(n),i.options.maxBounds)),i.options.worldCopyJump){var s=i.wrapLatLng(i.unproject(i.project(i.getCenter()).add(n)));i.panTo(s)}else i.panBy(n)}else if(e in this._zoomKeys)i.setZoom(i.getZoom()+(t.shiftKey?3:1)*this._zoomKeys[e]);else if(e===27&&i._popup&&i._popup.options.closeOnEscapeKey)i.closePopup();else return;St(t)}}});z.addInitHook("addHandler","keyboard",_n),z.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var gn=ut.extend({addHooks:function(){S(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){H(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(t){var e=Hi(t),i=this._map.options.wheelDebounceTime;this._delta+=e,this._lastMousePos=this._map.mouseEventToContainerPoint(t),this._startTime||(this._startTime=+new Date);var n=Math.max(i-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(y(this._performZoom,this),n),St(t)},_performZoom:function(){var t=this._map,e=t.getZoom(),i=this._map.options.zoomSnap||0;t._stop();var n=this._delta/(this._map.options.wheelPxPerZoomLevel*4),s=4*Math.log(2/(1+Math.exp(-Math.abs(n))))/Math.LN2,a=i?Math.ceil(s/i)*i:s,l=t._limitZoom(e+(this._delta>0?a:-a))-e;this._delta=0,this._startTime=null,l&&(t.options.scrollWheelZoom==="center"?t.setZoom(e+l):t.setZoomAround(this._lastMousePos,e+l))}});z.addInitHook("addHandler","scrollWheelZoom",gn);var Ws=600;z.mergeOptions({tapHold:x.touchNative&&x.safari&&x.mobile,tapTolerance:15});var vn=ut.extend({addHooks:function(){S(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){H(this._map._container,"touchstart",this._onDown,this)},_onDown:function(t){if(clearTimeout(this._holdTimeout),t.touches.length===1){var e=t.touches[0];this._startPos=this._newPos=new k(e.clientX,e.clientY),this._holdTimeout=setTimeout(y(function(){this._cancel(),this._isTapValid()&&(S(document,"touchend",Y),S(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",e))},this),Ws),S(document,"touchend touchcancel contextmenu",this._cancel,this),S(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function t(){H(document,"touchend",Y),H(document,"touchend touchcancel",t)},_cancel:function(){clearTimeout(this._holdTimeout),H(document,"touchend touchcancel contextmenu",this._cancel,this),H(document,"touchmove",this._onMove,this)},_onMove:function(t){var e=t.touches[0];this._newPos=new k(e.clientX,e.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(t,e){var i=new MouseEvent(t,{bubbles:!0,cancelable:!0,view:window,screenX:e.screenX,screenY:e.screenY,clientX:e.clientX,clientY:e.clientY});i._simulated=!0,e.target.dispatchEvent(i)}});z.addInitHook("addHandler","tapHold",vn),z.mergeOptions({touchZoom:x.touch,bounceAtZoomLimits:!0});var yn=ut.extend({addHooks:function(){E(this._map._container,"leaflet-touch-zoom"),S(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){W(this._map._container,"leaflet-touch-zoom"),H(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(t){var e=this._map;if(!(!t.touches||t.touches.length!==2||e._animatingZoom||this._zooming)){var i=e.mouseEventToContainerPoint(t.touches[0]),n=e.mouseEventToContainerPoint(t.touches[1]);this._centerPoint=e.getSize()._divideBy(2),this._startLatLng=e.containerPointToLatLng(this._centerPoint),e.options.touchZoom!=="center"&&(this._pinchStartLatLng=e.containerPointToLatLng(i.add(n)._divideBy(2))),this._startDist=i.distanceTo(n),this._startZoom=e.getZoom(),this._moved=!1,this._zooming=!0,e._stop(),S(document,"touchmove",this._onTouchMove,this),S(document,"touchend touchcancel",this._onTouchEnd,this),Y(t)}},_onTouchMove:function(t){if(!(!t.touches||t.touches.length!==2||!this._zooming)){var e=this._map,i=e.mouseEventToContainerPoint(t.touches[0]),n=e.mouseEventToContainerPoint(t.touches[1]),s=i.distanceTo(n)/this._startDist;if(this._zoom=e.getScaleZoom(s,this._startZoom),!e.options.bounceAtZoomLimits&&(this._zoom<e.getMinZoom()&&s<1||this._zoom>e.getMaxZoom()&&s>1)&&(this._zoom=e._limitZoom(this._zoom)),e.options.touchZoom==="center"){if(this._center=this._startLatLng,s===1)return}else{var a=i._add(n)._divideBy(2)._subtract(this._centerPoint);if(s===1&&a.x===0&&a.y===0)return;this._center=e.unproject(e.project(this._pinchStartLatLng,this._zoom).subtract(a),this._zoom)}this._moved||(e._moveStart(!0,!1),this._moved=!0),nt(this._animRequest);var l=y(e._move,e,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=J(l,this,!0),Y(t)}},_onTouchEnd:function(){if(!this._moved||!this._zooming){this._zooming=!1;return}this._zooming=!1,nt(this._animRequest),H(document,"touchmove",this._onTouchMove,this),H(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))}});z.addInitHook("addHandler","touchZoom",yn),z.BoxZoom=fn,z.DoubleClickZoom=pn,z.Drag=mn,z.Keyboard=_n,z.ScrollWheelZoom=gn,z.TapHold=vn,z.TouchZoom=yn,r.Bounds=F,r.Browser=x,r.CRS=_t,r.Canvas=cn,r.Circle=ni,r.CircleMarker=pe,r.Class=mt,r.Control=lt,r.DivIcon=rn,r.DivOverlay=ft,r.DomEvent=ls,r.DomUtil=rs,r.Draggable=wt,r.Evented=$t,r.FeatureGroup=gt,r.GeoJSON=yt,r.GridLayer=Qt,r.Handler=ut,r.Icon=zt,r.ImageOverlay=ye,r.LatLng=R,r.LatLngBounds=Q,r.Layer=ct,r.LayerGroup=Ot,r.LineUtil=xs,r.Map=z,r.Marker=fe,r.Mixin=ms,r.Path=Lt,r.Point=k,r.PolyUtil=_s,r.Polygon=Bt,r.Polyline=vt,r.Popup=be,r.PosAnimation=$i,r.Projection=ws,r.Rectangle=un,r.Renderer=bt,r.SVG=ee,r.SVGOverlay=on,r.TileLayer=Nt,r.Tooltip=xe,r.Transformation=Ee,r.Util=Mn,r.VideoOverlay=sn,r.bind=y,r.bounds=X,r.canvas=hn,r.circle=Cs,r.circleMarker=Es,r.control=Kt,r.divIcon=Zs,r.extend=d,r.featureGroup=ks,r.geoJSON=nn,r.geoJson=Os,r.gridLayer=Hs,r.icon=Ss,r.imageOverlay=zs,r.latLng=O,r.latLngBounds=q,r.layerGroup=Ps,r.map=cs,r.marker=Ms,r.point=T,r.polygon=Is,r.polyline=As,r.popup=Ns,r.rectangle=Us,r.setOptions=P,r.stamp=b,r.svg=dn,r.svgOverlay=Ds,r.tileLayer=an,r.tooltip=Rs,r.transformation=Ft,r.version=c,r.videoOverlay=Bs;var qs=window.L;r.noConflict=function(){return window.L=qs,this},window.L=r}))})(ie,ie.exports)),ie.exports}var no=io();const kn=to(no);class so{constructor(o={}){this.state=o,this.subscribers=new Set}getState(){return{...this.state}}setState(o){const r=this.getState();this.state={...this.state,...o},this.notifySubscribers(r,this.state)}subscribe(o){return this.subscribers.add(o),()=>this.subscribers.delete(o)}notifySubscribers(o,r){this.subscribers.forEach(c=>{c(r,o)})}reset(){this.state={},this.notifySubscribers({},{})}}const Te=new so({currentView:"public",isAdmin:!1,selectedIncidentIds:[],filters:{},isOnline:!0});class oo{constructor(){this.routes=new Map,this.currentRoute=null,this.currentView=null,window.addEventListener("popstate",()=>{this.navigate(window.location.hash.slice(1)||"/",!1)})}register(o,r){this.routes.set(o,r)}async navigate(o,r=!0){this.currentView&&typeof this.currentView.destroy=="function"&&this.currentView.destroy();const c=this.routes.get(o);if(!c){console.error(`No route registered for path: ${o}`);return}r&&window.history.pushState({},"",`#${o}`),this.currentRoute=o,this.currentView=new c,typeof this.currentView.render=="function"&&await this.currentView.render(),Te.setState({currentView:o})}getCurrentRoute(){return this.currentRoute}}const Zt=new oo,_={API_BASE_URL:"https://hotpink-dugong-322722.hostingersite.com/tmf-api",ADMIN_AUTH_TOKEN:"649dcf4cbc9bd36ad7a5b3f2f7182af6f406812191ee659aee00107defe05f0e",COLORS:{grayText:"rgb(89,89,89)",grayBg:"rgb(228,227,227)",blue:"rgb(80,136,174)",green:"rgb(83,153,73)",red:"rgb(220,38,38)",yellow:"rgb(234,179,8)",black:"#000000",lbpaGreen:"rgb(72,130,95)"},API_ENDPOINTS:{INCIDENTS:"/incidents",INCIDENT_BY_ID:C=>`/incidents/${C}`,REGIONS:"/regions",SUBSCRIBE:"/subscribe",VERIFY_SUBSCRIPTION:C=>`/subscribe/verify/${C}`,UNSUBSCRIBE:C=>`/unsubscribe/${C}`,ADMIN_UPLOADS:"/admin/uploads",ADMIN_UPLOAD_PUBLISH:C=>`/admin/uploads?upload_id=${C}`,ADMIN_UPLOAD_DELETE:C=>`/admin/uploads?upload_id=${C}`,ADMIN_INCIDENT_UPDATE:C=>`/admin/incidents/${C}`,ADMIN_INCIDENT_DELETE:C=>`/admin/incidents/${C}`,ADMIN_INCIDENTS_BULK:"/admin/incidents/bulk",ADMIN_LOGS:"/admin/logs",ADMIN_HEALTH:"/admin/health",ADMIN_FETCH_TRIGGER:"/admin/fetch/trigger",ADMIN_SETTINGS:"/admin/settings"},INCIDENT_TYPES:[{value:"road_closure",label:"Road Closure"},{value:"construction",label:"Construction"},{value:"accident",label:"Accident"},{value:"transit_delay",label:"Transit Delay"},{value:"special_event",label:"Special Event"},{value:"weather",label:"Weather"},{value:"other",label:"Other"}],SOURCE_TYPES:[{value:"city",label:"City of Toronto"},{value:"511",label:"Ontario 511"},{value:"ttc",label:"TTC"},{value:"metrolinx",label:"Metrolinx"}]};class ro{constructor(o){this.baseURL=o,this.isOnline=!0}async request(o,r={}){const c=o.includes("?")?"&":"?",d=`${this.baseURL}${o}${c}_t=${Date.now()}`,m={headers:{"Content-Type":"application/json"}};o.startsWith("/admin")&&(m.headers.Authorization=`Bearer ${_.ADMIN_AUTH_TOKEN}`);const y={...m,...r,headers:{...m.headers,...r.headers||{}}};y.headers["Content-Type"]===void 0&&delete y.headers["Content-Type"];try{const I=await fetch(d,y);if(!I.ok){if(I.status>=500)throw this.isOnline=!1,new Error(`Service unavailable (${I.status})`);const b=await I.json().catch(()=>({}));throw new Error(b.error?.message||`HTTP ${I.status}`)}return this.isOnline=!0,I.status===204?{success:!0}:await I.json()}catch(I){throw I.name==="TypeError"&&I.message.includes("fetch")?(this.isOnline=!1,new Error("Network error: Unable to connect to server")):I}}async getIncidents(o={}){const r=new URLSearchParams;Object.entries(o).forEach(([d,m])=>{m!=null&&m!==""&&(Array.isArray(m)?m.forEach(y=>r.append(`${d}[]`,y)):r.append(d,m))});const c=r.toString()?`?${r.toString()}`:"";return this.request(_.API_ENDPOINTS.INCIDENTS+c)}async getIncidentById(o){return this.request(_.API_ENDPOINTS.INCIDENT_BY_ID(o))}async getRegions(){return this.request(_.API_ENDPOINTS.REGIONS)}async subscribe(o){return this.request(_.API_ENDPOINTS.SUBSCRIBE,{method:"POST",body:JSON.stringify(o)})}async verifySubscription(o){return this.request(_.API_ENDPOINTS.VERIFY_SUBSCRIPTION(o),{method:"GET"})}async unsubscribe(o){return this.request(_.API_ENDPOINTS.UNSUBSCRIBE(o),{method:"DELETE"})}async uploadFile(o){const r=new FormData;return r.append("file",o),this.request(_.API_ENDPOINTS.ADMIN_UPLOADS,{method:"POST",headers:{"Content-Type":void 0},body:r})}async publishUpload(o,r=null){return this.request(_.API_ENDPOINTS.ADMIN_UPLOAD_PUBLISH(o),{method:"PUT",body:r?JSON.stringify({incidents:r}):null})}async deleteUpload(o){return this.request(_.API_ENDPOINTS.ADMIN_UPLOAD_DELETE(o),{method:"DELETE"})}async updateIncident(o,r){return this.request(_.API_ENDPOINTS.ADMIN_INCIDENT_UPDATE(o),{method:"PATCH",body:JSON.stringify(r)})}async deleteIncident(o){return this.request(_.API_ENDPOINTS.ADMIN_INCIDENT_DELETE(o),{method:"DELETE"})}async bulkDeleteIncidents(o){return this.request(_.API_ENDPOINTS.ADMIN_INCIDENTS_BULK,{method:"POST",body:JSON.stringify({action:"delete",ids:o})})}async getLogs(o={}){const r=new URLSearchParams;Object.entries(o).forEach(([d,m])=>{m!=null&&m!==""&&r.append(d,m)});const c=r.toString()?`?${r.toString()}`:"";return this.request(_.API_ENDPOINTS.ADMIN_LOGS+c)}async getHealth(){return this.request(_.API_ENDPOINTS.ADMIN_HEALTH)}async triggerFetch(){return this.request(_.API_ENDPOINTS.ADMIN_FETCH_TRIGGER,{method:"POST"})}async getSettings(){return this.request(_.API_ENDPOINTS.ADMIN_SETTINGS)}async updateSettings(o){return this.request(_.API_ENDPOINTS.ADMIN_SETTINGS,{method:"PUT",body:JSON.stringify(o)})}getOnlineStatus(){return this.isOnline}}const it=new ro(_.API_BASE_URL),p=(C,o=document)=>o.querySelector(C),Et=(C,o=document)=>Array.from(o.querySelectorAll(C)),ao=C=>{C.classList.remove("hidden")},lo=C=>{C.classList.add("hidden")};class co{constructor(o){this.modal=p(o),this.previousActiveElement=null,this.bindEvents()}bindEvents(){this.modal?.addEventListener("click",o=>{o.target===this.modal&&this.hide()}),document.addEventListener("keydown",o=>{if(o.key==="Escape"&&!this.modal.classList.contains("hidden")&&this.hide(),o.key==="Tab"&&!this.modal.classList.contains("hidden")){const r=this.modal.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'),c=r[0],d=r[r.length-1];o.shiftKey?document.activeElement===c&&(o.preventDefault(),d.focus()):document.activeElement===d&&(o.preventDefault(),c.focus())}})}show(o=""){if(!this.modal)return;this.previousActiveElement=document.activeElement;const r=this.modal.querySelector('[id$="-content"]');r&&o&&(typeof o=="string"?r.innerHTML=o:o instanceof Node&&(r.innerHTML="",r.appendChild(o))),ao(this.modal),this.modal.setAttribute("aria-modal","true"),this.modal.setAttribute("role","dialog");const c=this.modal.querySelector('button, input, select, textarea, [tabindex]:not([tabindex="-1"])');c?c.focus():(this.modal.setAttribute("tabindex","-1"),this.modal.focus())}hide(){this.modal&&(lo(this.modal),this.modal.removeAttribute("aria-modal"),this.modal.removeAttribute("role"),this.previousActiveElement&&this.previousActiveElement.focus())}}class Sn extends co{constructor(){super("#confirm-modal"),this.callback=null,this.setupButtons()}setupButtons(){const o=p("#confirm-cancel"),r=p("#confirm-ok");o?.addEventListener("click",()=>this.hide()),r?.addEventListener("click",async()=>{if(this.callback)try{await this.callback()}catch(c){console.error("Modal callback error:",c)}this.hide()})}confirm(o,r){const c=p("#confirm-modal-text");c&&(c.textContent=o),this.callback=r,this.show()}}class ho{constructor(){this.incidents=[],this.filters={district:["Leaside-Thorncliffe"]},this.detailPanel=null,this.map=null,this.markers=[],this.regions=[]}formatDate(o){if(!o)return"N/A";try{return new Date(o).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit"})}catch{return o}}formatTypeLabel(o){if(!o)return"N/A";const r=_.INCIDENT_TYPES.find(c=>c.value===o);return r?r.label:o}formatSourceLabel(o){if(!o)return"N/A";const r=_.SOURCE_TYPES.find(c=>c.value===o);return r?r.label:o}async render(){const o=p("#app");o&&(o.innerHTML=this.getHTML(),window.viewIncidentDetail=r=>{this.showDetail(r)},await this.loadRegions(),await this.loadIncidents(),this.bindEvents())}async loadRegions(){try{const o=await it.getRegions();o.success&&o.data&&(this.regions=o.data,this.updateRegionDropdown(),this.regions=o.data,this.updateRegionDropdown(),this.updateFooterRegionDropdown(),this.updateFooterTypeDropdown(),this.updateFooterImpactDropdown())}catch(o){console.error("Failed to load regions:",o),this.regions=[]}}updateRegionDropdown(){const o=p("#region-menu"),r=p("#region-trigger-text");if(!o||!r)return;const c="Leaside-Thorncliffe",d=this.regions.filter(M=>M!==c).sort(),m=this.filters.district||[c];m.length===0||m.length===this.regions.length+(this.regions.includes(c)?0:1)?r.textContent="All Regions":m.length===1&&m[0]===c?r.textContent=c:m.length<=2?r.textContent=m.join(", "):r.textContent=`${m.length} Regions Selected`;let I=`
      <label class="dropdown-item">
        <input type="checkbox" 
          value="ALL" 
          class="region-checkbox-all rounded text-blue-600 focus:ring-blue-500"
          ${m.length===0?"checked":""}
        >
        <span class="font-semibold">All Regions</span>
      </label>
      <div class="border-b my-1"></div>
      
      <!-- Priority Region -->
      <label class="dropdown-item bg-blue-50">
        <input type="checkbox" 
          value="${c}" 
          class="region-checkbox rounded text-blue-600 focus:ring-blue-500"
          ${m.includes(c)?"checked":""}
        >
        <span class="font-medium text-blue-800">${c}</span>
      </label>
      <div class="border-b my-1"></div>
    `;I+=d.map(M=>`
      <label class="dropdown-item">
        <input type="checkbox" 
          value="${M}" 
          class="region-checkbox rounded text-blue-600 focus:ring-blue-500"
          ${m.includes(M)?"checked":""}
        >
        <span>${M}</span>
      </label>
    `).join(""),o.innerHTML=I,o.querySelector(".region-checkbox-all")?.addEventListener("change",M=>{M.target.checked?this.filters.district=[]:this.filters.district=[c],this.updateRegionDropdown(),this.loadIncidents()}),o.querySelectorAll(".region-checkbox").forEach(M=>{M.addEventListener("change",()=>{let Z=this.filters.district||[];const g=M.value;M.checked?Z.length===0?Z=[g]:Z.push(g):Z=Z.filter(B=>B!==g),Z.length===0?this.filters.district=[]:this.filters.district=Z,this.updateRegionDropdown(),this.loadIncidents()})})}updateFooterRegionDropdown(){const o=p("#footer-region-menu"),r=p("#footer-region-trigger-text");if(!o||!r)return;const c="Leaside-Thorncliffe",d=this.regions.filter(b=>b!==c).sort();let m=`
      <label class="dropdown-item">
        <input type="checkbox" 
          value="ALL" 
          name="regions_all"
        class="footer-region-checkbox-all rounded text-blue-600 focus:ring-blue-500"
        >
        <span class="font-semibold">All Regions</span>
      </label>
      <div class="border-b my-1"></div>
      
      <label class="dropdown-item bg-blue-50">
        <input type="checkbox" 
          value="${c}" 
          name="regions"
          class="footer-region-checkbox rounded text-blue-600 focus:ring-blue-500"
          checked
        >
        <span class="font-medium text-blue-800">${c}</span>
      </label>
      <div class="border-b my-1"></div>
    `;m+=d.map(b=>`
      <label class="dropdown-item">
        <input type="checkbox" 
          value="${b}" 
          name="regions"
          class="footer-region-checkbox rounded text-blue-600 focus:ring-blue-500"
        >
        <span>${b}</span>
      </label>
    `).join(""),o.innerHTML=m,r.textContent=c;const y=o.querySelector(".footer-region-checkbox-all"),I=o.querySelectorAll(".footer-region-checkbox");y?.addEventListener("change",b=>{const M=b.target.checked;I.forEach(Z=>Z.checked=M),r.textContent=M?"All Regions":"0 Regions Selected"}),I.forEach(b=>{b.addEventListener("change",()=>{const M=Array.from(I).every(g=>g.checked);y&&(y.checked=M);const Z=Array.from(I).filter(g=>g.checked).length;M?r.textContent="All Regions":r.textContent=`${Z} Regions Selected`})})}updateFooterTypeDropdown(){this._updateFooterDropdown("footer-type-menu","footer-type-trigger-text",_.INCIDENT_TYPES.map(o=>({value:o.value,label:o.label})),"types","All Types")}updateFooterImpactDropdown(){const o=[{value:"high",label:"High"},{value:"medium",label:"Medium"},{value:"low",label:"Low"}];this._updateFooterDropdown("footer-impact-menu","footer-impact-trigger-text",o,"impacts","All Impact Levels")}_updateFooterDropdown(o,r,c,d,m){const y=p("#"+o),I=p("#"+r);if(!y||!I)return;let b=`
      <label class="dropdown-item">
        <input type="checkbox" 
          value="ALL" 
          class="footer-${d}-checkbox-all rounded text-blue-600 focus:ring-blue-500"
          checked
        >
        <span class="font-semibold">${m}</span>
      </label>
      <div class="border-b my-1"></div>
    `;b+=c.map(g=>`
      <label class="dropdown-item">
        <input type="checkbox" 
          value="${g.value}" 
          name="${d}"
          class="footer-${d}-checkbox rounded text-blue-600 focus:ring-blue-500"
          checked
        >
        <span>${g.label}</span>
      </label>
    `).join(""),y.innerHTML=b,I.textContent=m;const M=y.querySelector(`.footer-${d}-checkbox-all`),Z=y.querySelectorAll(`.footer-${d}-checkbox`);M?.addEventListener("change",g=>{const B=g.target.checked;Z.forEach(N=>N.checked=B),I.textContent=B?m:"0 Selected"}),Z.forEach(g=>{g.addEventListener("change",()=>{const B=Array.from(Z).every($=>$.checked);M&&(M.checked=B);const N=Array.from(Z).filter($=>$.checked).length;B?I.textContent=m:I.textContent=`${N} Selected`})})}getHTML(){return`
      <div class="min-h-screen flex flex-col">
        ${this.getHeaderHTML()}
        ${this.getHeroBannerHTML()}
        <main class="flex-1 px-6 py-8" style="position:relative;">
          <div class="max-w-[1200px] mx-auto" style="position:relative; z-index:10;">
            ${this.getIntroductionHTML()}

            ${this.getFiltersHTML()}

            <!-- Background Image Container -->
            <div style="position:relative; padding:40px 0;">
              <!-- Background Image with Fade Effects -->
              <div style="
                position:absolute;
                top:0;
                left:50%;
                transform:translateX(-50%);
                width:100vw;
                height:100%;
                z-index:1;
                pointer-events:none;
              ">
                <div style="
                  position:absolute;
                  top:0;
                  left:0;
                  width:100%;
                  height:100%;
                  background-image:url('./assets/img1.jpg');
                  background-size:cover;
                  background-position:center;
                  background-repeat:no-repeat;
                  opacity:0.5;
                "></div>
                <!-- Top Fade -->
                <div style="
                  position:absolute;
                  top:0;
                  left:0;
                  width:100%;
                  height:120px;
                  background:linear-gradient(to bottom, white 0%, transparent 100%);
                  z-index:2;
                "></div>
                <!-- Bottom Fade -->
                <div style="
                  position:absolute;
                  bottom:0;
                  left:0;
                  width:100%;
                  height:120px;
                  background:linear-gradient(to top, white 0%, transparent 100%);
                  z-index:2;
                "></div>
              </div>

              <!-- Table and Map Grid -->
              <div class="grid lg:grid-cols-2 gap-6 mb-8" style="position:relative; z-index:5;">
                ${this.getTableHTML()}
                ${this.getMapHTML()}
              </div>
            </div>


          </div>
        </main>

        <div id="detail-overlay" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-end z-50"></div>
        <div id="fullscreen-backdrop" class="fullscreen-backdrop"></div>

        ${this.getFooterHTML()}
      </div>
    `}getHeaderHTML(){const{black:o,lbpaGreen:r}=_.COLORS;return`
      <header class="sticky top-0 z-50 min-h-[72px] flex items-center px-6" style="background-color:rgba(255,255,255,0.45); backdrop-filter:blur(10px); box-shadow:0 1px 3px rgba(0,0,0,0.1)">
        <div class="w-full max-w-[1200px] mx-auto flex items-center justify-between">
          <div class="flex items-center">
            <h1 class="text-xl sm:text-2xl font-bold" style="color:${o}">Leaside Business Park</h1>
          </div>

          <!-- Desktop Navigation -->
          <nav class="hidden md:flex items-center gap-6">
            <a href="#/" class="hover:underline transition-colors" style="color:${o}">Home</a>
            <a href="#/" class="hover:underline transition-colors" style="color:${o}">About</a>
            <a href="#/" class="hover:underline font-semibold transition-colors" style="color:${r}">Traffic & Transit Updates</a>
          </nav>

          <!-- Mobile Menu Button -->
          <button id="mobile-menu-btn" class="md:hidden p-2 rounded hover:bg-gray-100" style="color:${o}" aria-label="Toggle menu">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
            </svg>
          </button>
        </div>

        <!-- Mobile Menu Dropdown -->
        <div id="mobile-menu" class="hidden absolute top-[72px] left-0 right-0 shadow-lg" style="background-color:rgba(255,255,255,0.9); border-top:1px solid rgba(0,0,0,0.1)">
          <nav class="flex flex-col p-4 gap-3">
            <a href="#/" class="hover:underline py-2 transition-colors" style="color:${o}">Home</a>
            <a href="#/" class="hover:underline py-2 transition-colors" style="color:${o}">About</a>
            <a href="#/" class="hover:underline py-2 font-semibold transition-colors" style="color:${r}">Traffic & Transit Updates</a>
          </nav>
        </div>
      </header>
    `}getHeroBannerHTML(){return`
      <div style="position:relative; width:100%; height:500px; overflow:hidden; margin-top:-72px; padding-top:72px;">
        <!-- Construction Image Background (img3.jpg) -->
        <div style="
          position:absolute;
          top:0;
          left:0;
          width:100%;
          height:100%;
          background-image: url('./assets/img3.jpg');
          background-size: cover;
          background-position: center;
          background-repeat: no-repeat;
          z-index:1;
        "></div>

        <!-- Very Light Overlay for text readability -->
        <div style="
          position:absolute;
          top:0;
          left:0;
          width:100%;
          height:100%;
          background: linear-gradient(135deg, rgba(0,0,0,0.35) 0%, rgba(0,0,0,0.2) 100%);
          z-index:2;
        "></div>

        <!-- Content -->
        <div class="max-w-[1200px] mx-auto px-6" style="position:relative; height:100%; display:flex; flex-direction:column; justify-content:center; z-index:10;">
          <h1 class="text-5xl font-bold mb-4" style="color:white; text-shadow: 2px 2px 8px rgba(0,0,0,0.9);">
            Traffic & Transit Updates
          </h1>
          <p class="text-xl mb-6" style="color:white; max-width:700px; text-shadow: 1px 1px 6px rgba(0,0,0,0.9);">
            Stay informed about traffic, construction, and transit impacts around Leaside Business Park
          </p>
          <div style="display:flex; align-items:center; gap:12px;">
            <span class="text-sm" style="color:white; opacity:0.95; text-shadow: 1px 1px 4px rgba(0,0,0,0.9);" id="last-updated-hero">Loading...</span>
          </div>
        </div>

        <!-- Fade to White at Bottom -->
        <div style="
          position:absolute;
          bottom:0;
          left:0;
          width:100%;
          height:100px;
          background: linear-gradient(to bottom, transparent 0%, rgba(255,255,255,0.3) 30%, rgba(255,255,255,0.7) 60%, white 100%);
          z-index:3;
        "></div>
      </div>
    `}getIntroductionHTML(){const{grayText:o,green:r}=_.COLORS;return`
      <div class="mb-8 p-6 rounded-lg border" style="border-color:#e5e7eb; background-color:#f9fafb;">
        <p class="text-base leading-relaxed mb-4" style="color:${o}">
          Stay up to date on what's happening around Leaside Business Park.
          Explore the live map below for real-time traffic, construction, and transit updates  helping you plan your route, avoid delays, and keep your business moving.
        </p>
        <p class="text-base" style="color:${o}">
          Want updates delivered to you?
          <button id="intro-subscribe-btn" class="inline-flex items-center font-semibold hover:underline" style="color:${r}">
            Subscribe below
          </button>
          to receive the latest alerts by email.
        </p>
      </div>
    `}getFiltersHTML(){const{grayText:o}=_.COLORS;return`
      <div class="flex flex-wrap gap-3 p-4 mb-6 rounded-lg filter-panel">
        <div class="flex-1 min-w-[180px]">
          <label class="block text-sm mb-1" style="color:${o}">Type</label>
          <select id="filter-type" class="w-full px-3 py-2 rounded border bg-white" style="color:${o}">
            <option value="">All Types</option>
            ${_.INCIDENT_TYPES.map(r=>`
              <option value="${r.value}">${r.label}</option>
            `).join("")}
          </select>
        </div>

        <div class="flex-1 min-w-[250px]">
          <label class="block text-sm mb-1" style="color:${o}">Regions</label>
          <div class="custom-dropdown" id="region-dropdown">
            <div class="dropdown-trigger" id="region-trigger" 
                 tabindex="0" role="button" aria-haspopup="true" aria-expanded="false" aria-label="Select Regions">
              <span id="region-trigger-text">Select Regions</span>
              <svg class="w-4 h-4 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
              </svg>
            </div>
            <div class="dropdown-menu" id="region-menu" role="menu">
              <!-- Checkboxes injected here -->
              <div class="p-2 text-sm text-gray-400">Loading...</div>
            </div>
          </div>
        </div>

        <div class="flex-1 min-w-[180px]">
          <label class="block text-sm mb-1" style="color:${o}">Impact</label>
          <select id="filter-impact" class="w-full px-3 py-2 rounded border bg-white" style="color:${o}">
            <option value="">All Impact Levels</option>
            <option value="high">High</option>
            <option value="medium">Medium</option>
            <option value="low">Low</option>
          </select>
        </div>

        <div class="flex-1 min-w-[150px]">
          <label class="block text-sm mb-1" style="color:${o}">From</label>
          <input type="date" id="filter-date-from" class="w-full px-3 py-2 rounded border bg-white" style="color:${o}">
        </div>

        <div class="flex-1 min-w-[150px]">
          <label class="block text-sm mb-1" style="color:${o}">To</label>
          <input type="date" id="filter-date-to" class="w-full px-3 py-2 rounded border bg-white" style="color:${o}">
        </div>

        <div class="flex-1 min-w-[200px] relative">
          <label class="block text-sm mb-1" style="color:${o}">Search</label>
          <input type="text" id="public-search" placeholder="Search incidents..." 
            class="pl-8 pr-3 py-2 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-full"
            value="${this.filters.q||""}" />
          <span class="absolute left-2.5 top-[34px] text-gray-400"></span>
        </div>

        <div class="flex items-end">
          <button id="reset-filters" class="px-4 py-2 rounded border bg-white hover:bg-gray-50" style="color:${o}">
            Reset Filters
          </button>
        </div>
      </div>
    `}getTableHTML(){const{grayText:o,grayBg:r}=_.COLORS;return`
      <div class="rounded-lg border overflow-hidden">
        <div class="p-3 flex items-center justify-between" style="background-color:${r}">
          <h3 class="font-semibold" style="color:${o}">Table View</h3>
        </div>
        <div id="table-container" class="overflow-auto max-h-600">
          <div class="flex items-center justify-center p-8">
            <div class="spinner"></div>
          </div>
        </div>
      </div>
    `}getMapHTML(){const{grayText:o,grayBg:r}=_.COLORS;return`
      <div id="map-card" class="rounded-lg border overflow-hidden relative bg-white flex flex-col">
        <div class="p-3 flex items-center justify-between flex-shrink-0" style="background-color:${r}">
          <h3 class="font-semibold" style="color:${o}">Map View</h3>
          <button id="map-fullscreen-btn" class="text-gray-600 hover:text-gray-900 focus:outline-none" title="Toggle Fullscreen">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4" />
            </svg>
          </button>
        </div>
        <div id="map-container" class="flex-1 relative transition-all duration-300" style="min-height:600px;">
          ${this.getMapLegendHTML()}
        </div>
      </div>
    `}getMapLegendHTML(){const{grayText:o}=_.COLORS;return`
      <div class="map-legend bg-white rounded-lg card-shadow p-3 max-w-[200px]">
        <div class="text-sm mb-2 font-semibold" style="color:${o}">Legend</div>
        <div class="space-y-1 text-xs" style="color:${o}">
          <div class="flex items-center gap-2">
            <div class="w-3 h-3 rounded-full" style="background-color:${_.COLORS.red}"></div>
            <span>Road Closure / Accident</span>
          </div>
          <div class="flex items-center gap-2">
            <div class="w-3 h-3 rounded-full" style="background-color:${_.COLORS.yellow}"></div>
            <span>Construction</span>
          </div>
          <div class="flex items-center gap-2">
            <div class="w-3 h-3 rounded-full" style="background-color:${_.COLORS.blue}"></div>
            <span>Transit / Weather</span>
          </div>
          <div class="flex items-center gap-2">
            <div class="w-3 h-3 rounded-full" style="background-color:${_.COLORS.green}"></div>
            <span>Special Event</span>
          </div>
          <div class="flex items-center gap-2">
            <div class="w-3 h-3 rounded-full" style="background-color:${_.COLORS.grayText}"></div>
            <span>Other</span>
          </div>
        </div>
      </div>
    `}getFooterHTML(){const{grayText:o,grayBg:r,green:c}=_.COLORS;return`
      <footer class="bg-white border-t" style="border-color:${r};">
        
        <!-- Subscription Form Section -->
        <div class="py-16 px-6 bg-white">
          <div class="max-w-[1200px] mx-auto text-center">
            <h2 class="text-2xl font-bold mb-4" style="color:${_.COLORS.black}">Get Updates Delivered</h2>
            <p class="text-gray-600 mb-8">
              Sign up for customized email alerts. Choose your frequency and filter by region, type, and impact.
            </p>
            
            <form id="footer-subscribe-form" class="text-left bg-gray-50 p-6 rounded-lg border border-gray-200">
              <!-- Row 1: Email and Frequency -->
              <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                <div class="md:col-span-2">
                  <label class="block text-sm font-medium mb-1">Email Address</label>
                  <input type="email" name="email" required placeholder="you@example.com" class="w-full px-3 py-2 rounded border focus:ring-2 focus:ring-blue-500 outline-none text-sm" style="color:${o}">
                </div>
                <div>
                  <label class="block text-sm font-medium mb-1">Frequency</label>
                  <select name="frequency" class="w-full px-3 py-2 rounded border bg-white focus:ring-2 focus:ring-blue-500 outline-none text-sm" style="color:${o}">
                    <option value="daily">Daily (Every Morning)</option>
                    <option value="weekly">Weekly (Mondays)</option>
                    <option value="monthly">Monthly (1st of Month)</option>
                  </select>
                </div>
              </div>

              <!-- Row 2: Filters (3 Columns) -->
              <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <!-- Regions -->
                <div>
                  <label class="block text-sm font-medium mb-1">Regions</label>
                  <div class="custom-dropdown" id="footer-region-dropdown">
                    <div class="dropdown-trigger text-sm" id="footer-region-trigger" style="color:${o}" 
                         tabindex="0" role="button" aria-haspopup="true" aria-expanded="false" aria-label="Select Regions">
                      <span id="footer-region-trigger-text">Select Regions</span>
                      <svg class="w-4 h-4 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                      </svg>
                    </div>
                    <div class="dropdown-menu" id="footer-region-menu" role="menu">
                      <!-- Checkboxes injected here -->
                      <div class="p-2 text-sm text-gray-400">Loading...</div>
                    </div>
                  </div>
                </div>

                <!-- Types -->
                <div>
                  <label class="block text-sm font-medium mb-1">Incident Types</label>
                  <div class="custom-dropdown" id="footer-type-dropdown">
                    <div class="dropdown-trigger text-sm" id="footer-type-trigger" style="color:${o}"
                         tabindex="0" role="button" aria-haspopup="true" aria-expanded="false" aria-label="Select Incident Types">
                      <span id="footer-type-trigger-text">All Types</span>
                      <svg class="w-4 h-4 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                      </svg>
                    </div>
                    <div class="dropdown-menu" id="footer-type-menu" role="menu">
                      <!-- Types injected via JS -->
                    </div>
                  </div>
                </div>

                <!-- Impacts -->
                <div>
                  <label class="block text-sm font-medium mb-1">Impact Level</label>
                  <div class="custom-dropdown" id="footer-impact-dropdown">
                    <div class="dropdown-trigger text-sm" id="footer-impact-trigger" style="color:${o}"
                         tabindex="0" role="button" aria-haspopup="true" aria-expanded="false" aria-label="Select Impact Level">
                      <span id="footer-impact-trigger-text">All Impact Levels</span>
                      <svg class="w-4 h-4 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                      </svg>
                    </div>
                    <div class="dropdown-menu" id="footer-impact-menu" role="menu">
                      <!-- Impacts injected via JS -->
                    </div>
                  </div>
                </div>
              </div>

              <div class="text-center">
                <button type="submit" class="px-8 py-3 rounded-lg text-white font-semibold hover:opacity-90 transition-opacity w-full md:w-auto" style="background-color:${c}">
                  Subscribe
                </button>
                <p id="subscribe-msg" class="mt-4 text-sm font-medium hidden"></p>
              </div>
            </form>
          </div>
        </div>

        <!-- Standard Footer -->
        <div class="py-8 px-6 max-w-[1200px] mx-auto space-y-4">
          <div class="p-4 rounded-lg border" style="border-color:#e5e7eb; background-color:white;">
            <h3 class="text-sm font-semibold mb-2" style="color:${o}">Disclaimer</h3>
            <p class="text-sm leading-relaxed" style="color:${o};opacity:.8">
              Traffic and transit data are sourced from external public feeds, including the City of Toronto, Metrolinx, Ontario 511, and TTC.
              While the LBPA strives to provide timely and accurate information, we cannot guarantee completeness or real-time accuracy.
            </p>
          </div>
          <p class="text-sm text-center" style="color:${o};opacity:.7">
            Data sources: City of Toronto, Ontario 511, TTC, Metrolinx. Updated every 6 hours.
          </p>
        </div>
      </footer>
    `}bindEvents(){p("#mobile-menu-btn")?.addEventListener("click",()=>{const g=p("#mobile-menu");g&&g.classList.toggle("hidden")});const o=(g,B)=>{const N=p("#"+g),$=p("#"+B);N&&$&&(N.addEventListener("keydown",P=>{if(P.key==="Enter"||P.key===" "){P.preventDefault(),$.classList.toggle("active");const pt=$.classList.contains("active");N.setAttribute("aria-expanded",pt)}}),$.addEventListener("keydown",P=>{P.key==="Escape"&&($.classList.remove("active"),N.setAttribute("aria-expanded","false"),N.focus())}))};o("region-trigger","region-dropdown"),o("footer-region-trigger","footer-region-dropdown"),o("footer-type-trigger","footer-type-dropdown"),o("footer-impact-trigger","footer-impact-dropdown"),document.addEventListener("click",g=>{const B=p("#mobile-menu"),N=p("#mobile-menu-btn");B&&!B.classList.contains("hidden")&&!B.contains(g.target)&&!N?.contains(g.target)&&B.classList.add("hidden")});let r;p("#public-search")?.addEventListener("input",g=>{clearTimeout(r),r=setTimeout(()=>{this.filters.q=g.target.value,this.loadIncidents()},300)}),p("#filter-type")?.addEventListener("change",g=>{this.filters.type=g.target.value,this.loadIncidents()});const c=p("#region-dropdown"),d=p("#region-trigger"),m=p("#region-menu");d&&m&&(d.addEventListener("click",g=>{g.stopPropagation(),m.classList.toggle("show")}),document.addEventListener("click",g=>{c.contains(g.target)||m.classList.remove("show")}),m.addEventListener("click",g=>{g.stopPropagation()})),["region","type","impact"].forEach(g=>{const B=p(`#footer-${g}-dropdown`),N=p(`#footer-${g}-trigger`),$=p(`#footer-${g}-menu`);N&&$&&(N.addEventListener("click",P=>{P.stopPropagation(),Et(".custom-dropdown .dropdown-menu").forEach(pt=>{pt!==$&&pt.classList.remove("show")}),$.classList.toggle("show")}),document.addEventListener("click",P=>{B.contains(P.target)||$.classList.remove("show")}),$.addEventListener("click",P=>{P.stopPropagation()}))}),p("#filter-impact")?.addEventListener("change",g=>{this.filters.impact=g.target.value,this.loadIncidents()}),p("#filter-date-from")?.addEventListener("change",g=>{this.filters.date_from=g.target.value,this.loadIncidents()}),p("#filter-date-to")?.addEventListener("change",g=>{this.filters.date_to=g.target.value,this.loadIncidents()}),p("#reset-filters")?.addEventListener("click",()=>{this.filters={district:["Leaside-Thorncliffe"]},p("#filter-type").value="",p("#filter-impact").value="",p("#filter-date-from").value="",p("#filter-date-to").value="",this.updateRegionDropdown(),this.loadIncidents()});const y=p("#footer-subscribe-form");y&&y.addEventListener("submit",async g=>{g.preventDefault();const B=y.querySelector('button[type="submit"]'),N=p("#subscribe-msg"),$=B.textContent,P=new FormData(y),pt={email:P.get("email"),frequency:P.get("frequency"),filters:{regions:P.getAll("regions"),types:P.getAll("types"),impacts:P.getAll("impacts")}};try{B.disabled=!0,B.textContent="Subscribing...",N.classList.add("hidden"),N.className="mt-4 text-sm font-medium hidden";const Ht=await(await fetch("./api/public/subscribe.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(pt)})).json();N.classList.remove("hidden"),Ht.success?(N.textContent=" Successfully subscribed! Check your email for confirmation.",N.classList.add("text-green-600"),y.reset()):(N.textContent=" "+(Ht.error||"Failed to subscribe."),N.classList.add("text-red-600"))}catch(ne){console.error(ne),N.classList.remove("hidden"),N.textContent=" An error occurred. Please try again.",N.classList.add("text-red-600")}finally{B.disabled=!1,B.textContent=$}});const I=()=>{const g=p("#footer-subscribe-form");g&&(g.scrollIntoView({behavior:"smooth",block:"center"}),g.classList.add("ring-4","ring-blue-100"),setTimeout(()=>g.classList.remove("ring-4","ring-blue-100"),2e3))};p("#subscribe-btn")?.addEventListener("click",I),p("#intro-subscribe-btn")?.addEventListener("click",I),p("#close-subscribe")?.addEventListener("click",()=>{this.subscribeModal.hide()});const b=p("#map-fullscreen-btn"),M=p("#map-card"),Z=p("#fullscreen-backdrop");this.mapPlaceholder=document.createComment("map-placeholder"),b&&M&&(b.addEventListener("click",()=>{M.classList.contains("map-fullscreen")?(M.classList.remove("map-fullscreen"),Z?.classList.remove("active"),this.mapPlaceholder.parentNode&&(this.mapPlaceholder.parentNode.insertBefore(M,this.mapPlaceholder),this.mapPlaceholder.parentNode.removeChild(this.mapPlaceholder)),b.innerHTML='<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4" /></svg>'):(M.parentNode.insertBefore(this.mapPlaceholder,M),document.body.appendChild(M),M.classList.add("map-fullscreen"),Z?.classList.add("active"),b.innerHTML='<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>'),setTimeout(()=>{this.map&&this.map.invalidateSize()},300)}),Z?.addEventListener("click",()=>{M.classList.contains("map-fullscreen")&&b.click()}),document.addEventListener("keydown",g=>{g.key==="Escape"&&M.classList.contains("map-fullscreen")&&b.click()}))}async loadIncidents(){try{const o=await it.getIncidents(this.filters);o.success&&o.data&&(this.incidents=o.data.items||[],this.renderTable(),this.renderMap(),this.updateLastUpdated())}catch(o){this.showError(o.message)}}renderTable(){const o=p("#table-container");if(!o)return;if(this.incidents.length===0){o.innerHTML=`
        <div class="p-8 text-center text-gray-500">
          No incidents found matching your filters.
        </div>
      `;return}this.incidents.sort((c,d)=>{const m=new Date(c.start_date||0),y=new Date(d.start_date||0);if(y-m!==0)return y-m;const I=new Date(c.end_date||0);return new Date(d.end_date||0)-I});const{grayText:r}=_.COLORS;o.innerHTML=`
      <table class="w-full table-fixed">
        <thead class="sticky top-0 z-10 border-b" style="background-color:#f3f4f6;"> <!-- Hardcoded gray-100 for opacity -->
          <tr>
            <th class="px-2 sm:px-3 py-2 text-left text-xs sm:text-sm w-[45%]" style="color:${r}">Location</th>
            <th class="px-2 sm:px-3 py-2 text-left text-xs sm:text-sm w-[20%]" style="color:${r}">Dates</th>
            <th class="px-2 sm:px-3 py-2 text-center text-xs sm:text-sm w-[15%]" style="color:${r}">Type</th>
            <th class="px-2 sm:px-3 py-2 text-right text-xs sm:text-sm w-[15%]" style="color:${r}">Impact</th>
            <th class="px-2 sm:px-3 py-2 text-right text-xs sm:text-sm w-[5%]"></th>
          </tr>
        </thead>
        <tbody>
          ${this.incidents.map((c,d)=>`
            <tr class="border-t hover:bg-gray-50 cursor-pointer detail-row ${d%2===0?"bg-white":"bg-gray-50"}" data-incident-id="${c.id}">
              <td class="px-2 sm:px-3 py-3 truncate" style="color:${r}">
                <div class="text-xs sm:text-sm font-medium whitespace-normal">${this.escapeHTML(c.title||"N/A")}</div>
                <div class="text-[10px] sm:text-xs opacity-60 mt-1">${this.escapeHTML(c.district||"N/A")}</div>
              </td>
              <td class="px-2 sm:px-3 py-3" style="color:${r}">
                <div class="text-[10px] sm:text-xs">
                  <span class="font-medium">Start:</span> ${this.formatDate(c.start_date).split(",")[0]}
                </div>
                <div class="text-[10px] sm:text-xs opacity-80">
                  <span class="font-medium">End:</span> ${c.end_date?this.formatDate(c.end_date).split(",")[0]:"N/A"}
                </div>
              </td>
              <td class="px-2 sm:px-3 py-3 text-center">
                <span class="px-1.5 py-0.5 rounded text-[10px] sm:text-xs whitespace-nowrap type-${(c.type||"").toLowerCase()}" style="color:${r}">
                  ${this.escapeHTML(this.formatTypeLabel(c.type))}
                </span>
              </td>
              <td class="px-2 sm:px-3 py-3 text-right">
                <span class="px-1.5 py-0.5 rounded text-[10px] sm:text-xs whitespace-nowrap impact-${(c.impact||"low").toLowerCase()}" style="color:${r}">
                  ${this.escapeHTML(c.impact||"N/A")}
                </span>
              </td>
              <td class="px-2 sm:px-3 py-3 text-right">
                <button class="text-gray-400 hover:text-blue-600 transition-colors">
                  <svg class="w-4 h-4 sm:w-5 sm:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                  </svg>
                </button>
              </td>
            </tr>
          `).join("")}
        </tbody>
      </table>
    `,Et(".detail-row").forEach(c=>{c.addEventListener("click",d=>{const m=parseInt(d.currentTarget.dataset.incidentId);this.showDetail(m)})})}initMap(){p("#map-container")&&(this.map||(this.map=L.map("map-container",{center:[43.6532,-79.3832],zoom:11,zoomControl:!0}),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',maxZoom:18}).addTo(this.map)))}renderMap(){if(this.map||this.initMap(),!this.map)return;if(this.markers.forEach(r=>this.map.removeLayer(r)),this.markers=[],this.incidents.filter(r=>!!(Array.isArray(r.coordinates)&&r.coordinates.length===2||r.coordinates&&r.coordinates.lat&&r.coordinates.lon)).forEach(r=>{let c,d;Array.isArray(r.coordinates)?[c,d]=r.coordinates:(c=r.coordinates.lat,d=r.coordinates.lon);const m=this.getMarkerColor(r.type),y=L.divIcon({className:"custom-marker",html:`<div style="background-color:${m};width:24px;height:24px;border-radius:50%;border:2px solid white;box-shadow:0 2px 4px rgba(0,0,0,0.3);"></div>`,iconSize:[24,24],iconAnchor:[12,12]}),I=L.marker([c,d],{icon:y}).bindPopup(this.getMarkerPopupHTML(r)).addTo(this.map);this.markers.push(I)}),this.markers.length>0){const r=L.featureGroup(this.markers);this.map.fitBounds(r.getBounds().pad(.1))}}getMarkerPopupHTML(o){return`
      <div style="min-width:200px;">
        <h3 class="font-semibold mb-2" style="color:${_.COLORS.grayText}">
          ${this.escapeHTML(o.title||"N/A")}
        </h3>
        <div class="text-sm mb-2" style="color:${_.COLORS.grayText};opacity:0.8">
          <strong>Type:</strong> ${this.escapeHTML(this.formatTypeLabel(o.type))}<br/>
          <strong>Impact:</strong> ${this.escapeHTML(o.impact||"N/A")}<br/>
          <strong>Region:</strong> ${this.escapeHTML(o.district||"N/A")}<br/>
          <strong>Start:</strong> ${this.formatDate(o.start_date)}
        </div>
        <button
          onclick="window.viewIncidentDetail(${o.id})"
          class="px-3 py-1 rounded text-xs text-white"
          style="background-color:${_.COLORS.blue}">
          View Details
        </button>
      </div>
    `}getMarkerColor(o){return{road_closure:_.COLORS.red,construction:_.COLORS.yellow,accident:_.COLORS.red,transit_delay:_.COLORS.blue,special_event:_.COLORS.green,weather:_.COLORS.blue,other:_.COLORS.grayText}[o]||_.COLORS.blue}showDetail(o){const r=this.incidents.find(d=>d.id===o);if(!r)return;const c=p("#detail-overlay");c&&(c.innerHTML=`
      <div class="bg-white h-full w-full max-w-[480px] p-6 overflow-y-auto shadow-xl" onclick="event.stopPropagation()">
        <div class="flex items-start justify-between mb-6">
          <h2 class="text-xl font-bold" style="color:${_.COLORS.grayText}">Incident Details</h2>
          <button id="close-detail" class="text-gray-700 hover:bg-gray-100 rounded p-1"></button>
        </div>
        <div class="space-y-6">
          <div>
            <h3 class="font-semibold mb-2" style="color:${_.COLORS.grayText}">
              ${this.escapeHTML(r.title||"N/A")}
            </h3>
            <p class="text-sm" style="color:${_.COLORS.grayText};opacity:.8">
              ${this.escapeHTML(r.description||"No description available.")}
            </p>
          </div>
          <div class="grid grid-cols-2 gap-4">
            <div>
              <span class="block text-sm mb-1" style="color:${_.COLORS.grayText};opacity:.7">Type</span>
              <span style="color:${_.COLORS.grayText}">${this.escapeHTML(this.formatTypeLabel(r.type))}</span>
            </div>
            <div>
              <span class="block text-sm mb-1" style="color:${_.COLORS.grayText};opacity:.7">Impact</span>
              <span style="color:${_.COLORS.grayText}">${this.escapeHTML(r.impact||"N/A")}</span>
            </div>
            <div>
              <span class="block text-sm mb-1" style="color:${_.COLORS.grayText};opacity:.7">Region</span>
              <span style="color:${_.COLORS.grayText}">${this.escapeHTML(r.district||"N/A")}</span>
            </div>
            <div>
              <span class="block text-sm mb-1" style="color:${_.COLORS.grayText};opacity:.7">Source</span>
              <span style="color:${_.COLORS.grayText}">
                ${this.escapeHTML(this.formatSourceLabel(r.source_type))}
                ${r.link?`<a href="${r.link.startsWith("http")?r.link:`${_.API_BASE_URL}${r.link}`}" target="_blank" class="mt-2 flex items-center justify-center gap-2 px-4 py-2 bg-blue-50 text-blue-700 rounded hover:bg-blue-100 transition-colors text-sm font-medium border border-blue-200">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg>
            View Original PDF
          </a>`:""}
              </span>
            </div>
            <div>
              <span class="block text-sm mb-1" style="color:${_.COLORS.grayText};opacity:.7">Start Date</span>
              <span style="color:${_.COLORS.grayText}">${this.formatDate(r.start_date)}</span>
            </div>
            <div>
              <span class="block text-sm mb-1" style="color:${_.COLORS.grayText};opacity:.7">End Date</span>
              <span style="color:${_.COLORS.grayText}">${this.formatDate(r.end_date)}</span>
            </div>
          </div>
          <button id="subscribe-detail-btn" class="w-full px-6 py-3 rounded-lg text-white" style="background-color:${_.COLORS.green}">
            Subscribe to Updates
          </button>
        </div>
      </div>
    `,c.classList.remove("hidden"),p("#close-detail")?.addEventListener("click",()=>{c.classList.add("hidden")}),c.addEventListener("click",d=>{d.target===c&&c.classList.add("hidden")}),p("#subscribe-detail-btn")?.addEventListener("click",()=>{p("#close-detail")?.click();const d=p("#footer-subscribe-form");d&&d.scrollIntoView({behavior:"smooth",block:"center"})}))}updateLastUpdated(){const o=new Date,r=`Last updated: ${o.toLocaleDateString()} at ${o.toLocaleTimeString()}`,c=p("#last-updated-hero");c&&(c.textContent=r)}showError(o){const r=p("#table-container");r&&(r.innerHTML=`
        <div class="p-8 text-center">
          <div class="error-message max-w-md mx-auto">
            <strong>Error:</strong> ${this.escapeHTML(o)}
          </div>
        </div>
      `)}escapeHTML(o){const r=document.createElement("div");return r.textContent=o,r.innerHTML}destroy(){clearTimeout(this.searchTimeout),clearTimeout(this.regionTimeout),this.map&&(this.map.remove(),this.map=null),this.markers=[],delete window.viewIncidentDetail}}class Tn{constructor(){this.confirmModal=new Sn,this.currentUpload=null,this.editingIncidentId=null}showPreview(){const o=p("#preview-section"),r=p("#preview-content");if(!o||!r)return;if(o.classList.remove("hidden"),this.currentUpload.preview.length===0){r.innerHTML=`
        <p class="text-center text-gray-500 py-8">No incidents found in the uploaded PDF.</p>
      `;return}const{grayText:c}=_.COLORS;r.innerHTML=`
      <div class="overflow-x-auto">
        <table class="w-full" id="incidents-table">
          <thead style="background-color:${_.COLORS.grayBg}">
            <tr>
              <th class="px-3 py-2 text-left text-sm w-1/3" style="color:${c}">Incident Details</th>
              <th class="px-3 py-2 text-left text-sm" style="color:${c}">Type & Source</th>
              <th class="px-3 py-2 text-left text-sm" style="color:${c}">Region</th>
              <th class="px-3 py-2 text-left text-sm" style="color:${c}">Timing</th>
              <th class="px-1 py-2 text-center text-sm w-10" style="color:${c}"></th>
            </tr>
          </thead>
          <tbody id="incidents-table-body">
            ${this.renderTableBody()}
          </tbody>
        </table>
      </div>
    `,this.bindDynamicEvents()}renderTableBody(){return!this.currentUpload||!this.currentUpload.preview?"":this.currentUpload.preview.map((o,r)=>this.editingIncidentId===o.id?this.renderEditRow(o):this.renderRow(o,r)).join("")}renderRow(o,r){const{grayText:c}=_.COLORS;return`
      <tr class="border-t ${r%2===0?"bg-white":"bg-gray-50"} hover:bg-gray-100 transition-colors">
        <td class="px-3 py-2 text-sm" style="color:${c}">
          <div class="font-bold mb-1">${this.escapeHTML(o.title||"N/A")}</div>
          ${o.location&&o.location!==o.title?`<div class="text-xs text-gray-600 mb-1"> ${this.escapeHTML(o.location)}</div>`:""}
          <div class="text-xs opacity-75 line-clamp-2">${this.escapeHTML(o.description||"")}</div>
        </td>
        <td class="px-3 py-2 text-sm" style="color:${c}">
          <div class="font-medium">${this.escapeHTML(this.formatTypeLabel(o.type))}</div>
          <div class="text-xs opacity-75 mt-1">
            Source: ${this.escapeHTML(o.source||"Metrolinx")}
            ${o.link?` <a href="${o.link}" target="_blank" class="text-blue-600 hover:underline" title="View PDF"></a>`:""}
          </div>
          <div class="text-xs opacity-75">Impact: ${this.escapeHTML(o.impact||"N/A")}</div>
        </td>
        <td class="px-3 py-2 text-sm" style="color:${c}">
          <span class="inline-block px-2 py-0.5 rounded text-xs bg-gray-200">
            ${this.escapeHTML(o.district||"N/A")}
          </span>
        </td>
        <td class="px-3 py-2 text-sm" style="color:${c}">
          <div class="whitespace-nowrap">Start: ${this.formatDate(o.start_date)}</div>
          <div class="whitespace-nowrap opacity-75">End: ${this.formatDate(o.end_date)}</div>
        </td>
        <td class="px-1 py-2 text-center text-sm whitespace-nowrap align-middle">
          <div class="flex flex-col gap-1 items-center justify-center">
            <button class="edit-btn p-1.5 hover:bg-blue-100 text-blue-600 rounded transition-colors" data-id="${o.id}" title="Edit">
              
            </button>
            <button class="delete-btn p-1.5 hover:bg-red-100 text-red-600 rounded transition-colors" data-id="${o.id}" title="Delete">
              
            </button>
          </div>
        </td>
      </tr>
    `}renderEditRow(o){const{grayText:r,green:c}=_.COLORS,d=m=>{if(!m)return"";try{return new Date(m).toISOString().split("T")[0]}catch{return""}};return`
      <tr class="bg-yellow-50 border-t border-b border-yellow-200">
        <td colspan="6" class="p-4">
          <form class="edit-form grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4" data-id="${o.id}">
            <div class="col-span-1 sm:col-span-2 lg:col-span-3">
              <label class="block text-xs font-bold mb-1" style="color:${r}">Title</label>
              <input type="text" name="title" value="${this.escapeHTML(o.title||"")}" class="w-full text-sm border rounded p-1" required />
            </div>
            
            <div class="col-span-1 sm:col-span-2 lg:col-span-3">
              <label class="block text-xs font-bold mb-1" style="color:${r}">Description</label>
              <textarea name="description" rows="3" class="w-full text-sm border rounded p-1">${this.escapeHTML(o.description||"")}</textarea>
            </div>

            <div class="col-span-1 sm:col-span-2">
              <label class="block text-xs font-bold mb-1" style="color:${r}">Location</label>
              <input type="text" name="location" value="${this.escapeHTML(o.location||"")}" class="w-full text-sm border rounded p-1" />
            </div>

            <div>
              <label class="block text-xs font-bold mb-1" style="color:${r}">Region</label>
              <select name="district" class="w-full text-sm border rounded p-1">
                <option value="">Select Region...</option>
                <option value="Leaside-Thorncliffe" ${o.district==="Leaside-Thorncliffe"?"selected":""}>Leaside-Thorncliffe</option>
                <option value="East York" ${o.district==="East York"?"selected":""}>East York</option>
                <option value="Scarborough" ${o.district==="Scarborough"?"selected":""}>Scarborough</option>
                <option value="North York" ${o.district==="North York"?"selected":""}>North York</option>
                <option value="Etobicoke" ${o.district==="Etobicoke"?"selected":""}>Etobicoke</option>
                <option value="Toronto" ${o.district==="Toronto"?"selected":""}>Toronto</option>
              </select>
            </div>

            <div>
              <label class="block text-xs font-bold mb-1" style="color:${r}">Type</label>
              <select name="type" class="w-full text-sm border rounded p-1">
                ${_.INCIDENT_TYPES.map(m=>`
                  <option value="${m.value}" ${o.type===m.value?"selected":""}>${m.label}</option>
                `).join("")}
              </select>
            </div>

            <div>
              <label class="block text-xs font-bold mb-1" style="color:${r}">Impact</label>
              <select name="impact" class="w-full text-sm border rounded p-1">
                <option value="low" ${o.impact==="low"?"selected":""}>Low</option>
                <option value="medium" ${o.impact==="medium"?"selected":""}>Medium</option>
                <option value="high" ${o.impact==="high"?"selected":""}>High</option>
                <option value="critical" ${o.impact==="critical"?"selected":""}>Critical</option>
              </select>
            </div>

            <div>
              <label class="block text-xs font-bold mb-1" style="color:${r}">Source</label>
              <select name="source" class="w-full text-sm border rounded p-1">
                ${_.SOURCE_TYPES.map(m=>`
                  <option value="${m.value}" ${o.source===m.value?"selected":""}>${m.label}</option>
                `).join("")}
              </select>
            </div>

            <div>
              <label class="block text-xs font-bold mb-1" style="color:${r}">Start Date</label>
              <input type="date" name="start_date" value="${d(o.start_date)}" class="w-full text-sm border rounded p-1" required />
            </div>

            <div>
              <label class="block text-xs font-bold mb-1" style="color:${r}">End Date</label>
              <input type="date" name="end_date" value="${d(o.end_date)}" class="w-full text-sm border rounded p-1" />
            </div>

            <div class="col-span-1 sm:col-span-2 lg:col-span-3 flex justify-end gap-2 mt-2">
              <button type="button" class="cancel-btn px-3 py-1 rounded text-sm border bg-white hover:bg-gray-50" data-id="${o.id}">
                Cancel
              </button>
              <button type="submit" class="save-btn px-4 py-1 rounded text-sm text-white" style="background-color:${c}">
                 Save Changes
              </button>
            </div>
          </form>
        </td>
      </tr>
    `}bindDynamicEvents(){const o=p("#incidents-table-body");o&&(o.querySelectorAll(".edit-btn").forEach(r=>{r.addEventListener("click",c=>{const d=parseInt(c.currentTarget.dataset.id);this.toggleEditMode(d)})}),o.querySelectorAll(".delete-btn").forEach(r=>{r.addEventListener("click",c=>{const d=parseInt(c.currentTarget.dataset.id);this.deleteIncident(d)})}),o.querySelectorAll(".cancel-btn").forEach(r=>{r.addEventListener("click",()=>{this.toggleEditMode(null)})}),o.querySelectorAll(".edit-form").forEach(r=>{r.addEventListener("submit",c=>{c.preventDefault();const d=parseInt(c.currentTarget.dataset.id),m=new FormData(c.currentTarget),y=Object.fromEntries(m.entries());this.saveIncident(d,y)})}))}toggleEditMode(o){this.editingIncidentId=o;const r=p("#incidents-table-body");r&&(r.innerHTML=this.renderTableBody(),this.bindDynamicEvents())}async saveIncident(o,r){const c=this.currentUpload.preview.findIndex(d=>d.id===o);c!==-1&&(this.currentUpload.preview[c]={...this.currentUpload.preview[c],...r},this.showMessage("Incident updated locally (click Publish to save)","success"),this.toggleEditMode(null))}async deleteIncident(o){confirm("Delete this incident? (Will be removed on Publish)")&&(this.currentUpload.preview=this.currentUpload.preview.filter(r=>r.id!==o),this.showMessage("Incident removed locally","success"),this.toggleEditMode(this.editingIncidentId))}async publishIncidents(){this.currentUpload&&this.confirmModal.confirm(`Publish ${this.currentUpload.preview.length} incident(s)? This will make them visible to the public.`,async()=>{try{this.showMessage("Publishing incidents...","info");const o=await it.publishUpload(this.currentUpload.upload_id,this.currentUpload.preview);o.success&&(this.showMessage(`Successfully published ${o.data.updated||0} incidents`,"success"),this.currentUpload=null,p("#preview-section")?.classList.add("hidden"),p("#file-upload").value="")}catch(o){this.showMessage(`Publish error: ${o.message}`,"error")}})}formatDate(o){if(!o)return"N/A";try{return new Date(o).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit"})}catch{return o}}formatTypeLabel(o){if(!o)return"N/A";const r=_.INCIDENT_TYPES.find(c=>c.value===o);return r?r.label:o}async render(){const o=p("#app");o&&(o.innerHTML=this.getHTML(),this.bindEvents())}getHTML(){const{grayText:o,grayBg:r,blue:c,green:d}=_.COLORS;return`
      <div class="min-h-screen flex flex-col">
        ${this.getAdminHeaderHTML()}
        <main class="flex-1 px-4 sm:px-6 py-6 sm:py-8">
          <div class="max-w-[1200px] mx-auto">
            <div class="mb-6 sm:mb-8">
              <h1 class="mb-2 text-xl sm:text-2xl font-bold" style="color:${o}">Report Notices  Upload & Parse</h1>
              <p class="text-sm sm:text-base" style="color:${o};opacity:.7">
                Upload PDF files to automatically parse traffic and transit reports
              </p>
            </div>

            <div id="upload-message" class="hidden mb-4"></div>

            <div class="grid lg:grid-cols-3 gap-6 sm:gap-8">
              <div class="lg:col-span-2 space-y-4 sm:space-y-6">
                <div id="upload-zone" class="border-2 border-dashed rounded-lg p-6 sm:p-8 text-center transition-colors" style="border-color:${r}">
                  <input type="file" id="file-upload" class="hidden" accept=".pdf" />
                  <label for="file-upload" class="cursor-pointer block">
                    <div class="text-4xl mb-4"></div>
                    <h3 class="mb-2 text-base sm:text-lg font-semibold" style="color:${o}">Upload PDF</h3>
                    <p class="mb-4 text-xs sm:text-sm px-2" style="color:${o};opacity:.6">
                      <span class="hidden sm:inline">Drag and drop a PDF file here, or click to browse</span>
                      <span class="sm:hidden">Tap to select a PDF file</span>
                    </p>
                    <button type="button" class="px-6 py-2 rounded-lg text-white text-sm sm:text-base" style="background-color:${c}">
                      Browse Files
                    </button>
                  </label>
                </div>

                <div id="preview-section" class="hidden">
                  <div class="border rounded-lg overflow-hidden">
                    <div class="p-4" style="background-color:${r}">
                      <h3 class="text-lg font-semibold" style="color:${o}">Parsed Incidents</h3>
                      <p class="text-xs mt-1" style="color:${o};opacity:.7">Review and publish incidents extracted from the PDF</p>
                    </div>
                    <div id="preview-content" class="p-4"></div>
                    <div class="p-4 border-t flex flex-col sm:flex-row items-start sm:items-center justify-end gap-3">
                      <button id="publish-btn" class="px-6 py-2 rounded-lg text-white text-sm" style="background-color:${d}">
                        Publish All Incidents
                      </button>
                    </div>
                  </div>
                </div>
              </div>

              <div class="lg:col-span-1">
                <div class="border rounded-lg p-4 sm:p-6" style="border-color:${r}">
                  <h3 class="mb-4 text-base sm:text-lg font-semibold" style="color:${o}">Instructions</h3>
                  <div class="space-y-3 text-sm" style="color:${o}">
                    <p>1. Upload a PDF traffic report</p>
                    <p>2. System will automatically parse incidents</p>
                    <p>3. Review parsed data</p>
                    <p>4. Publish to make incidents public</p>
                  </div>
                </div>

                <div class="mt-6 p-4 rounded-lg flex gap-3" style="background-color:rgba(80,136,174,0.1)">
                  <div class="w-5 h-5 flex-shrink-0" style="color:${c}"></div>
                  <p class="text-xs sm:text-sm" style="color:${o}">
                    Auto-parsing uses AI to extract key information. Always review before publishing.
                  </p>
                </div>
              </div>
            </div>
          </div>
        </main>
        ${this.getFooterHTML()}
      </div>
    `}getAdminHeaderHTML(){const{black:o,lbpaGreen:r}=_.COLORS;return`
      <header class="sticky top-0 z-50 min-h-[72px] flex items-center px-4 sm:px-6 py-3 sm:py-0" style="background-color:rgba(255,255,255,0.95); backdrop-filter:blur(10px); box-shadow:0 1px 3px rgba(0,0,0,0.1)">
        <div class="w-full max-w-[1200px] mx-auto flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 sm:gap-0">
          <div class="flex items-center gap-2 sm:gap-3">
            <h1 class="text-lg sm:text-xl font-bold" style="color:${o}">Leaside Business Park</h1>
            <span class="font-semibold text-sm sm:text-base" style="color:${o}">- Admin Portal</span>
          </div>
          <nav class="flex items-center gap-3 sm:gap-6 w-full sm:w-auto overflow-x-auto pb-1 sm:pb-0">
            <a href="#/admin/upload" class="hover:underline text-sm sm:text-base whitespace-nowrap font-semibold transition-colors" style="color:${r}">Upload Reports</a>
            <a href="#/admin/incidents" class="hover:underline text-sm sm:text-base whitespace-nowrap transition-colors" style="color:${o}">All Incidents</a>
            <a href="#/admin/logs" class="hover:underline text-sm sm:text-base whitespace-nowrap transition-colors" style="color:${o}">Logs & Health</a>
            <a href="#/" class="hover:underline text-sm sm:text-base whitespace-nowrap transition-colors" style="color:${o}">Public View</a>
          </nav>
        </div>
      </header>
    `}getFooterHTML(){const{grayText:o,grayBg:r}=_.COLORS;return`
      <footer class="mt-24 py-8 px-6 border-t" style="border-color:${r}">
        <div class="max-w-[1200px] mx-auto">
          <p class="text-sm" style="color:${o};opacity:.7">
            LBPA Traffic Management System - Admin Portal
          </p>
        </div>
      </footer>
    `}bindEvents(){const o=p("#file-upload"),r=p("#upload-zone"),c=r?.querySelector("button");o?.addEventListener("change",d=>{const m=d.target.files[0];m&&this.handleFileUpload(m)}),c?.addEventListener("click",d=>{d.preventDefault(),d.stopPropagation(),o?.click()}),r?.addEventListener("dragover",d=>{d.preventDefault(),r.classList.add("drag-over")}),r?.addEventListener("dragleave",()=>{r.classList.remove("drag-over")}),r?.addEventListener("drop",d=>{d.preventDefault(),r.classList.remove("drag-over");const m=d.dataTransfer.files[0];m&&m.type==="application/pdf"?this.handleFileUpload(m):this.showMessage("Please upload a PDF file","error")}),p("#publish-btn")?.addEventListener("click",()=>{this.publishIncidents()})}async handleFileUpload(o){this.showLoading(),this.showMessage("Uploading and processing PDF...","info");try{const r=await it.uploadFile(o);if(r.success&&r.data){const d=(r.data.results||[])[0];d&&d.success?(this.currentUpload={upload_id:d.upload_id,preview:d.preview||[],statistics:d.statistics},this.showMessage(`Successfully processed ${this.currentUpload.preview.length} incidents`,"success"),this.showPreview()):this.showMessage(d?.error||"Upload failed","error")}}catch(r){this.showMessage(`Upload error: ${r.message}`,"error")}finally{this.hideLoading()}}showLoading(){const o=p("#upload-zone");if(o){let r=o.querySelector(".loading-overlay");r||(r=document.createElement("div"),r.className="loading-overlay absolute inset-0 bg-white/90 flex flex-col items-center justify-center z-10 rounded-lg",r.innerHTML=`
          <div class="animate-spin rounded-full h-12 w-12 border-b-2 mb-3" style="border-color:#48825f"></div>
          <p class="font-semibold animate-pulse" style="color:#48825f">Processing PDF with AI...</p>
        `,o.style.position="relative",o.appendChild(r)),r.classList.remove("hidden")}}hideLoading(){const o=p("#upload-zone .loading-overlay");o&&o.remove()}async publishIncidents(){this.currentUpload&&this.confirmModal.confirm(`Publish ${this.currentUpload.preview.length} incident(s)? This will make them visible to the public.`,async()=>{try{this.showMessage("Publishing incidents...","info");const o=await it.publishUpload(this.currentUpload.upload_id);o.success&&(this.showMessage(`Successfully published ${o.data.updated||0} incidents`,"success"),this.currentUpload=null,p("#preview-section")?.classList.add("hidden"),p("#file-upload").value="")}catch(o){this.showMessage(`Publish error: ${o.message}`,"error")}})}showMessage(o,r="info"){const c=p("#upload-message");if(!c)return;const d=r==="error"?"error-message":r==="success"?"success-message":"text-gray-700 bg-blue-50 p-4 rounded-lg";c.className=d,c.textContent=o,c.classList.remove("hidden"),r==="success"&&setTimeout(()=>{c.classList.add("hidden")},5e3)}escapeHTML(o){const r=document.createElement("div");return r.textContent=o,r.innerHTML}destroy(){}}class uo{constructor(){this.confirmModal=new Sn,this.incidents=[],this.filters={},this.selectedIds=[],this.regions=[]}formatDate(o){if(!o)return"N/A";try{return new Date(o).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit"})}catch{return o}}formatTypeLabel(o){if(!o)return"N/A";const r=_.INCIDENT_TYPES.find(c=>c.value===o);return r?r.label:o}async render(){const o=p("#app");o&&(o.innerHTML=this.getHTML(),this.bindEvents(),await this.loadRegions(),await this.loadIncidents())}async loadRegions(){try{const o=await it.getRegions();o.success&&o.data&&(this.regions=o.data,this.updateRegionDropdown())}catch(o){console.error("Failed to load regions:",o),this.regions=[]}}updateRegionDropdown(){const o=p("#filter-region");if(!o)return;const r=o.value;o.innerHTML=`
      <option value="">All Regions</option>
      ${this.regions.map(c=>`
        <option value="${c}">${c}</option>
      `).join("")}
    `,o.value=r}getHTML(){const{grayText:o}=_.COLORS;return`
      <div class="min-h-screen flex flex-col">
        ${this.getAdminHeaderHTML()}
        <main class="flex-1 px-4 sm:px-6 py-6 sm:py-8">
          <div class="max-w-[1200px] mx-auto">
            <div class="flex items-center justify-between mb-6">
              <div>
                <h1 class="mb-2 text-xl sm:text-2xl font-bold" style="color:${o}">All Incidents</h1>
                <p class="text-sm sm:text-base" style="color:${o};opacity:.7">
                  Manage all traffic and transit incidents across all sources
                </p>
              </div>
            </div>

            <div id="incidents-message" class="hidden mb-4"></div>

            <div class="flex flex-wrap gap-3 p-4 mb-6 rounded-lg filter-panel border border-gray-200 bg-gray-50">
              <div class="flex-1 min-w-[180px]">
                <label class="block text-sm mb-1" style="color:${o}">Type</label>
                <select id="filter-type" class="w-full px-3 py-2 rounded border bg-white" style="color:${o}">
                  <option value="">All Types</option>
                  ${_.INCIDENT_TYPES.map(r=>`
                    <option value="${r.value}">${r.label}</option>
                  `).join("")}
                </select>
              </div>

              <div class="flex-1 min-w-[250px]">
                <label class="block text-sm mb-1" style="color:${o}">Regions</label>
                <div class="custom-dropdown bg-white" id="region-dropdown">
                  <div class="dropdown-trigger" id="region-trigger"
                       tabindex="0" role="button" aria-haspopup="true" aria-expanded="false" aria-label="Select Regions">
                    <span id="region-trigger-text">Select Regions</span>
                    <svg class="w-4 h-4 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                    </svg>
                  </div>
                  <div class="dropdown-menu" id="region-menu" role="menu">
                    <!-- Checkboxes injected here -->
                    <div class="p-2 text-sm text-gray-400">Loading...</div>
                  </div>
                </div>
              </div>

              <div class="flex-1 min-w-[180px]">
                <label class="block text-sm mb-1" style="color:${o}">Impact</label>
                <select id="filter-impact" class="w-full px-3 py-2 rounded border bg-white" style="color:${o}">
                  <option value="">All Impact Levels</option>
                  <option value="high">High</option>
                  <option value="medium">Medium</option>
                  <option value="low">Low</option>
                </select>
              </div>

              <div class="flex-1 min-w-[150px]">
                <label class="block text-sm mb-1" style="color:${o}">From</label>
                <input type="date" id="filter-date-from" class="w-full px-3 py-2 rounded border bg-white" style="color:${o}">
              </div>

              <div class="flex-1 min-w-[150px]">
                <label class="block text-sm mb-1" style="color:${o}">To</label>
                <input type="date" id="filter-date-to" class="w-full px-3 py-2 rounded border bg-white" style="color:${o}">
              </div>

              <!-- Search Bar -->
              <div class="flex-1 min-w-[200px] relative">
                <label class="block text-sm mb-1" style="color:${o}">Search</label>
                <input type="text" id="admin-search" placeholder="Search incidents..." 
                  class="pl-8 pr-3 py-2 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-full"
                  value="${this.filters.q||""}" />
                <span class="absolute left-2.5 top-[34px] text-gray-400"></span>
              </div>

              <div class="flex items-end w-full sm:w-auto">
                <button id="reset-filters" class="px-4 py-2 rounded border bg-white hover:bg-gray-50 w-full sm:w-auto" style="color:${o}">
                  Reset Filters
                </button>
              </div>
            </div>

            <div id="bulk-actions" class="hidden mb-4 p-4 rounded-lg flex flex-col sm:flex-row items-start sm:items-center justify-between gap-2" style="background-color:rgba(58,118,146,0.1)">
              <span class="text-sm sm:text-base" style="color:${o}">
                <span id="selected-count">0</span> incident(s) selected
              </span>
              <button id="bulk-delete-btn" class="px-4 py-2 rounded text-white text-sm" style="background-color:${_.COLORS.red}">
                Delete Selected
              </button>
            </div>

            <div class="rounded-lg border overflow-hidden mb-6">
              <div id="incidents-container" class="overflow-x-auto">
                <div class="flex items-center justify-center p-8">
                  <div class="spinner"></div>
                </div>
              </div>
            </div>
          </div>
        </main>
        ${this.getFooterHTML()}
      </div>
    `}getAdminHeaderHTML(){const{black:o,lbpaGreen:r}=_.COLORS;return`
      <header class="sticky top-0 z-50 min-h-[72px] flex items-center px-4 sm:px-6 py-3 sm:py-0" style="background-color:rgba(255,255,255,0.95); backdrop-filter:blur(10px); box-shadow:0 1px 3px rgba(0,0,0,0.1)">
        <div class="w-full max-w-[1200px] mx-auto flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 sm:gap-0">
          <div class="flex items-center gap-2 sm:gap-3">
            <h1 class="text-lg sm:text-xl font-bold" style="color:${o}">Leaside Business Park</h1>
            <span class="font-semibold text-sm sm:text-base" style="color:${o}">- Admin Portal</span>
          </div>
          <nav class="flex items-center gap-3 sm:gap-6 w-full sm:w-auto overflow-x-auto pb-1 sm:pb-0">
            <a href="#/admin/upload" class="hover:underline text-sm sm:text-base whitespace-nowrap transition-colors" style="color:${o}">Upload Reports</a>
            <a href="#/admin/incidents" class="hover:underline text-sm sm:text-base whitespace-nowrap font-semibold transition-colors" style="color:${r}">All Incidents</a>
            <a href="#/admin/logs" class="hover:underline text-sm sm:text-base whitespace-nowrap transition-colors" style="color:${o}">Logs & Health</a>
            <a href="#/" class="hover:underline text-sm sm:text-base whitespace-nowrap transition-colors" style="color:${o}">Public View</a>
          </nav>
        </div>
      </header>
    `}getFiltersHTML(){const{grayText:o}=_.COLORS;return`
      <div class="flex flex-wrap gap-3 p-4 mb-6 rounded-lg filter-panel">
        <div class="flex-1 min-w-[140px] sm:min-w-[180px]">
          <label class="block text-xs sm:text-sm mb-1" style="color:${o}">Type</label>
          <select id="filter-type" class="w-full px-2 sm:px-3 py-1.5 sm:py-2 text-sm rounded border bg-white" style="color:${o}">
            <option value="">All Types</option>
            ${_.INCIDENT_TYPES.map(r=>`
              <option value="${r.value}">${r.label}</option>
            `).join("")}
          </select>
        </div>

        <div class="flex-1 min-w-[140px] sm:min-w-[180px]">
          <label class="block text-xs sm:text-sm mb-1" style="color:${o}">Region</label>
          <select id="filter-region" class="w-full px-2 sm:px-3 py-1.5 sm:py-2 text-sm rounded border bg-white" style="color:${o}">
            <option value="">All Regions</option>
          </select>
        </div>

        <div class="flex items-end w-full sm:w-auto">
          <button id="reset-filters" class="px-3 sm:px-4 py-1.5 sm:py-2 text-sm rounded border bg-white hover:bg-gray-50 w-full sm:w-auto" style="color:${o}">
            Reset Filters
          </button>
        </div>
      </div>
    `}getFooterHTML(){const{grayText:o,grayBg:r}=_.COLORS;return`
      <footer class="mt-24 py-8 px-6 border-t" style="border-color:${r}">
        <div class="max-w-[1200px] mx-auto">
          <p class="text-sm" style="color:${o};opacity:.7">
            LBPA Traffic Management System - Admin Portal
          </p>
        </div>
      </footer>
    `}async loadIncidents(){try{const o={...this.filters};delete o.status;const r=await it.getIncidents(o);r.success&&r.data&&(this.incidents=r.data.items||[],this.renderTable())}catch(o){this.showMessage(`Error loading incidents: ${o.message}`,"error")}}renderTable(){const o=p("#incidents-container");if(!o)return;if(this.incidents.length===0){o.innerHTML=`
        <div class="p-8 text-center text-gray-500">
          No incidents found.
        </div>
      `;return}const{grayText:r,grayBg:c}=_.COLORS;o.innerHTML=`
      <table class="w-full min-w-[900px]" id="incidents-table">
        <thead style="background-color:${c}">
          <tr>
            <th class="px-3 py-2 text-left w-10">
              <input id="select-all" type="checkbox" class="w-4 h-4" />
            </th>
            <th class="px-3 py-2 text-left text-sm w-1/3" style="color:${r}">Incident Details</th>
            <th class="px-3 py-2 text-left text-sm" style="color:${r}">Type & Source</th>
            <th class="px-3 py-2 text-left text-sm" style="color:${r}">Region</th>
            <th class="px-3 py-2 text-left text-sm" style="color:${r}">Timing</th>
            <th class="px-1 py-2 text-center text-sm w-10" style="color:${r}"></th>
          </tr>
        </thead>
        <tbody id="incidents-table-body">
          ${this.renderTableBody()}
        </tbody>
      </table>
    `,this.bindDynamicEvents()}renderTableBody(){return this.incidents.map((o,r)=>this.editingIncidentId===o.id?this.renderEditRow(o):this.renderRow(o,r)).join("")}renderRow(o,r){const{grayText:c}=_.COLORS,d=r%2===0,m=this.selectedIds.includes(o.id);return`
      <tr class="border-t ${d?"bg-white":"bg-gray-50"} hover:bg-gray-100 transition-colors">
        <td class="px-3 py-2 align-top pt-3">
          <input type="checkbox" class="row-select w-4 h-4" value="${o.id}" ${m?"checked":""} />
        </td>
        <td class="px-3 py-2 text-sm" style="color:${c}">
          <div class="font-bold mb-1">${this.escapeHTML(o.title||"N/A")}</div>
          ${o.location&&o.location!==o.title?`<div class="text-xs text-gray-600 mb-1"> ${this.escapeHTML(o.location)}</div>`:""}
          <div class="text-xs opacity-75 line-clamp-2">${this.escapeHTML(o.description||"")}</div>
        </td>
        <td class="px-3 py-2 text-sm" style="color:${c}">
          <div class="font-medium">${this.escapeHTML(this.formatTypeLabel(o.type))}</div>
          <div class="text-xs opacity-75 mt-1">
            Source: ${this.escapeHTML(o.source||"Metrolinx")}
            ${o.external_link?` <a href="${o.external_link}" target="_blank" class="text-blue-600 hover:underline" title="View Source"></a>`:""}
          </div>
          <div class="text-xs opacity-75">Impact: ${this.escapeHTML(o.impact||"N/A")}</div>
        </td>
        <td class="px-3 py-2 text-sm" style="color:${c}">
          <span class="inline-block px-2 py-0.5 rounded text-xs bg-gray-200">
            ${this.escapeHTML(o.district||"N/A")}
          </span>
        </td>
        <td class="px-3 py-2 text-sm" style="color:${c}">
          <div class="whitespace-nowrap">Start: ${this.formatDate(o.start_date)}</div>
          <div class="whitespace-nowrap opacity-75">End: ${this.formatDate(o.end_date)}</div>
        </td>
        <td class="px-1 py-2 text-center text-sm whitespace-nowrap align-middle">
          <div class="flex flex-col gap-1 items-center justify-center">
            <button class="edit-btn p-1.5 hover:bg-blue-100 text-blue-600 rounded transition-colors" data-id="${o.id}" title="Edit">
              
            </button>
            <button class="delete-btn p-1.5 hover:bg-red-100 text-red-600 rounded transition-colors" data-id="${o.id}" title="Delete">
              
            </button>
          </div>
        </td>
      </tr>
    `}renderEditRow(o){const{grayText:r,green:c}=_.COLORS,d=m=>{if(!m)return"";try{return new Date(m).toISOString().split("T")[0]}catch{return""}};return`
      <tr class="bg-yellow-50 border-t border-b border-yellow-200">
        <td colspan="6" class="p-4">
          <form class="edit-form grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4" data-id="${o.id}">
            <div class="col-span-1 sm:col-span-2 lg:col-span-3">
              <label class="block text-xs font-bold mb-1" style="color:${r}">Title</label>
              <input type="text" name="title" value="${this.escapeHTML(o.title||"")}" class="w-full text-sm border rounded p-1" required />
            </div>
            
            <div class="col-span-1 sm:col-span-2 lg:col-span-3">
              <label class="block text-xs font-bold mb-1" style="color:${r}">Description</label>
              <textarea name="description" rows="3" class="w-full text-sm border rounded p-1">${this.escapeHTML(o.description||"")}</textarea>
            </div>

            <div class="col-span-1 sm:col-span-2">
              <label class="block text-xs font-bold mb-1" style="color:${r}">Location</label>
              <input type="text" name="location" value="${this.escapeHTML(o.location||"")}" class="w-full text-sm border rounded p-1" />
            </div>

            <div>
              <label class="block text-xs font-bold mb-1" style="color:${r}">Region</label>
              <select name="district" class="w-full text-sm border rounded p-1">
                <option value="">Select Region...</option>
                <option value="Leaside-Thorncliffe" ${o.district==="Leaside-Thorncliffe"?"selected":""}>Leaside-Thorncliffe</option>
                <option value="East York" ${o.district==="East York"?"selected":""}>East York</option>
                <option value="Scarborough" ${o.district==="Scarborough"?"selected":""}>Scarborough</option>
                <option value="North York" ${o.district==="North York"?"selected":""}>North York</option>
                <option value="Etobicoke" ${o.district==="Etobicoke"?"selected":""}>Etobicoke</option>
                <option value="Toronto" ${o.district==="Toronto"?"selected":""}>Toronto</option>
              </select>
            </div>

            <div>
              <label class="block text-xs font-bold mb-1" style="color:${r}">Type</label>
              <select name="type" class="w-full text-sm border rounded p-1">
                ${_.INCIDENT_TYPES.map(m=>`
                  <option value="${m.value}" ${o.type===m.value?"selected":""}>${m.label}</option>
                `).join("")}
              </select>
            </div>

            <div>
              <label class="block text-xs font-bold mb-1" style="color:${r}">Impact</label>
              <select name="impact" class="w-full text-sm border rounded p-1">
                <option value="low" ${o.impact==="low"?"selected":""}>Low</option>
                <option value="medium" ${o.impact==="medium"?"selected":""}>Medium</option>
                <option value="high" ${o.impact==="high"?"selected":""}>High</option>
                <option value="critical" ${o.impact==="critical"?"selected":""}>Critical</option>
              </select>
            </div>

            <div>
              <label class="block text-xs font-bold mb-1" style="color:${r}">Source</label>
              <select name="source" class="w-full text-sm border rounded p-1">
                ${_.SOURCE_TYPES.map(m=>`
                  <option value="${m.value}" ${o.source===m.value?"selected":""}>${m.label}</option>
                `).join("")}
              </select>
            </div>

            <div>
              <label class="block text-xs font-bold mb-1" style="color:${r}">Start Date</label>
              <input type="date" name="start_date" value="${d(o.start_date)}" class="w-full text-sm border rounded p-1" required />
            </div>

            <div>
              <label class="block text-xs font-bold mb-1" style="color:${r}">End Date</label>
              <input type="date" name="end_date" value="${d(o.end_date)}" class="w-full text-sm border rounded p-1" />
            </div>

            <div class="col-span-1 sm:col-span-2 lg:col-span-3 flex justify-end gap-2 mt-2">
              <button type="button" class="cancel-btn px-3 py-1 rounded text-sm border bg-white hover:bg-gray-50" data-id="${o.id}">
                Cancel
              </button>
              <button type="submit" class="save-btn px-4 py-1 rounded text-sm text-white" style="background-color:${c}">
                 Save Changes
              </button>
            </div>
          </form>
        </td>
      </tr>
    `}bindDynamicEvents(){const o=p("#incidents-table-body");o&&(p("#select-all")?.addEventListener("change",r=>{const c=r.target.checked;Et(".row-select").forEach(d=>{d.checked=c}),this.updateSelectedIds()}),Et(".row-select").forEach(r=>{r.addEventListener("change",()=>{this.updateSelectedIds()})}),o.querySelectorAll(".edit-btn").forEach(r=>{r.addEventListener("click",c=>{const d=parseInt(c.currentTarget.dataset.id);this.toggleEditMode(d)})}),o.querySelectorAll(".delete-btn").forEach(r=>{r.addEventListener("click",c=>{const d=parseInt(c.currentTarget.dataset.id);this.deleteIncident(d)})}),o.querySelectorAll(".cancel-btn").forEach(r=>{r.addEventListener("click",()=>{this.toggleEditMode(null)})}),o.querySelectorAll(".edit-form").forEach(r=>{r.addEventListener("submit",c=>{c.preventDefault();const d=parseInt(c.currentTarget.dataset.id),m=new FormData(c.currentTarget),y=Object.fromEntries(m.entries());this.saveIncident(d,y)})}))}toggleEditMode(o){this.editingIncidentId=o;const r=p("#incidents-table-body");r&&(r.innerHTML=this.renderTableBody(),this.bindDynamicEvents())}async saveIncident(o,r){try{this.showMessage("Saving changes...","info"),(await it.updateIncident(o,r)).success&&(this.showMessage("Incident updated successfully","success"),this.toggleEditMode(null),await this.loadIncidents())}catch(c){this.showMessage(`Update error: ${c.message}`,"error")}}updateSelectedIds(){this.selectedIds=Et(".row-select:checked").map(d=>parseInt(d.value));const o=p("#bulk-actions"),r=p("#selected-count");this.selectedIds.length>0?(o?.classList.remove("hidden"),r&&(r.textContent=this.selectedIds.length.toString())):o?.classList.add("hidden");const c=p("#select-all");c&&(c.checked=this.selectedIds.length===this.incidents.length&&this.incidents.length>0)}deleteIncident(o){this.confirmModal.confirm("Are you sure you want to delete this incident? This action cannot be undone.",async()=>{try{await it.deleteIncident(o),this.showMessage("Incident deleted successfully","success"),await this.loadIncidents()}catch(r){this.showMessage(`Delete error: ${r.message}`,"error")}})}bulkDelete(){this.selectedIds.length!==0&&this.confirmModal.confirm(`Delete ${this.selectedIds.length} incident(s)? This action cannot be undone.`,async()=>{try{for(const o of this.selectedIds)await it.deleteIncident(o);this.showMessage(`Successfully deleted ${this.selectedIds.length} incidents`,"success"),this.selectedIds=[],await this.loadIncidents()}catch(o){this.showMessage(`Bulk delete error: ${o.message}`,"error")}})}bindEvents(){p("#filter-type")?.addEventListener("change",c=>{this.filters.type=c.target.value,this.loadIncidents()}),p("#filter-impact")?.addEventListener("change",c=>{this.filters.impact=c.target.value,this.loadIncidents()}),p("#filter-date-from")?.addEventListener("change",c=>{this.filters.start_date_from=c.target.value,this.loadIncidents()}),p("#filter-date-to")?.addEventListener("change",c=>{this.filters.end_date_to=c.target.value,this.loadIncidents()});const o=p("#region-trigger");p("#region-menu"),o?.addEventListener("click",c=>{c.stopPropagation(),p("#region-dropdown").classList.toggle("active");const d=p("#region-dropdown").classList.contains("active");o.setAttribute("aria-expanded",d)}),o?.addEventListener("keydown",c=>{if(c.key==="Enter"||c.key===" "){c.preventDefault(),p("#region-dropdown").classList.toggle("active");const d=p("#region-dropdown").classList.contains("active");o.setAttribute("aria-expanded",d)}}),document.addEventListener("click",c=>{p("#region-dropdown")?.contains(c.target)||p("#region-dropdown")?.classList.remove("active")});let r;p("#admin-search")?.addEventListener("input",c=>{clearTimeout(r),r=setTimeout(()=>{this.filters.q=c.target.value,this.loadIncidents()},300)}),p("#reset-filters")?.addEventListener("click",()=>{this.filters={},p("#filter-type").value="",p("#filter-impact").value="",p("#filter-date-from").value="",p("#filter-date-to").value="",p("#admin-search").value="",this.updateRegionDropdown(),this.loadIncidents()}),p("#bulk-delete-btn")?.addEventListener("click",()=>{this.bulkDelete()})}showMessage(o,r="info"){const c=p("#incidents-message");if(!c)return;const d=r==="error"?"error-message":r==="success"?"success-message":"text-gray-700 bg-blue-50 p-4 rounded-lg";c.className=d,c.textContent=o,c.classList.remove("hidden"),r==="success"&&setTimeout(()=>{c.classList.add("hidden")},5e3)}escapeHTML(o){const r=document.createElement("div");return r.textContent=o,r.innerHTML}destroy(){}}class fo{constructor(){this.logs=[],this.health=null,this.autoRefresh=!1,this.refreshInterval=null}async render(){const o=p("#app");o&&(o.innerHTML=this.getHTML(),await this.loadData(),this.bindEvents())}getHTML(){const{grayText:o,grayBg:r}=_.COLORS;return`
      <div class="min-h-screen flex flex-col">
        ${this.getAdminHeaderHTML()}
        <main class="flex-1 px-6 py-8">
          <div class="max-w-[1200px] mx-auto">
            <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between mb-8 gap-4">
              <div>
                <h1 class="mb-2 text-xl sm:text-2xl font-bold" style="color:${o}">System Health & Logs</h1>
                <p class="text-sm sm:text-base" style="color:${o};opacity:.7">Monitor system status and activity</p>
              </div>
              <div class="flex items-center gap-3">
                <label class="flex items-center gap-2 cursor-pointer">
                  <input type="checkbox" id="auto-refresh" class="w-4 h-4" />
                  <span class="text-sm" style="color:${o}">Auto-refresh (60s)</span>
                </label>
                <button id="refresh-now" class="p-2 rounded-lg hover:bg-gray-100" title="Refresh now" style="color:${o}" aria-label="Refresh now">
                  
                </button>
              </div>
            </div>

            <div id="health-container" class="mb-8">
              <div class="flex items-center justify-center p-8">
                <div class="spinner"></div>
              </div>
            </div>

            <div class="border rounded-lg p-6" style="border-color:${r}">
              <div class="flex items-center justify-between mb-6">
                <h2 class="text-lg font-semibold" style="color:${o}">Activity Log</h2>
                <div class="flex gap-2">
                  ${["All","Errors","Warnings","Info"].map(c=>`
                    <button class="log-filter px-3 py-1 rounded text-sm border hover:bg-gray-50" data-level="${c.toLowerCase()}" style="color:${o}">
                      ${c}
                    </button>
                  `).join("")}
                </div>
              </div>
              <div id="logs-container">
                <div class="flex items-center justify-center p-8">
                  <div class="spinner"></div>
                </div>
              </div>
            </div>
          </div>
        </main>
        ${this.getFooterHTML()}
      </div>
    `}getAdminHeaderHTML(){const{black:o,lbpaGreen:r}=_.COLORS;return`
      <header class="sticky top-0 z-50 min-h-[72px] flex items-center px-4 sm:px-6 py-3 sm:py-0" style="background-color:rgba(255,255,255,0.95); backdrop-filter:blur(10px); box-shadow:0 1px 3px rgba(0,0,0,0.1)">
        <div class="w-full max-w-[1200px] mx-auto flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 sm:gap-0">
          <div class="flex items-center gap-2 sm:gap-3">
            <h1 class="text-lg sm:text-xl font-bold" style="color:${o}">Leaside Business Park</h1>
            <span class="font-semibold text-sm sm:text-base" style="color:${o}">- Admin Portal</span>
          </div>
          <nav class="flex items-center gap-3 sm:gap-6 w-full sm:w-auto overflow-x-auto pb-1 sm:pb-0">
            <a href="#/admin/upload" class="hover:underline text-sm sm:text-base whitespace-nowrap transition-colors" style="color:${o}">Upload Reports</a>
            <a href="#/admin/incidents" class="hover:underline text-sm sm:text-base whitespace-nowrap transition-colors" style="color:${o}">All Incidents</a>
            <a href="#/admin/logs" class="hover:underline text-sm sm:text-base whitespace-nowrap font-semibold transition-colors" style="color:${r}">Logs & Health</a>
            <a href="#/" class="hover:underline text-sm sm:text-base whitespace-nowrap transition-colors" style="color:${o}">Public View</a>
          </nav>
        </div>
      </header>
    `}getFooterHTML(){const{grayText:o,grayBg:r}=_.COLORS;return`
      <footer class="mt-24 py-8 px-6 border-t" style="border-color:${r}">
        <div class="max-w-[1200px] mx-auto">
          <p class="text-sm" style="color:${o};opacity:.7">
            LBPA Traffic Management System - Admin Portal
          </p>
        </div>
      </footer>
    `}async loadData(){await Promise.all([this.loadHealth(),this.loadLogs()])}async loadHealth(){try{const o=await it.getHealth();o.success&&o.data&&(this.health=o.data,this.renderHealth())}catch(o){console.error("Error loading health:",o),this.showHealthError(o.message)}}renderHealth(){const o=p("#health-container");if(!o||!this.health)return;const{grayText:r,grayBg:c,green:d,red:m}=_.COLORS,y=this.health.database,I=this.health.adapters||{};o.innerHTML=`
      <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6">
        <!-- Database Health -->
        <div class="border rounded-lg p-6" style="border-color:${c}">
          <div class="flex items-start justify-between mb-4">
            <h3 class="font-semibold" style="color:${r}">Database</h3>
            <div class="text-2xl" style="color:${y?d:m}">
              ${y?"":""}
            </div>
          </div>
          <div class="space-y-3">
            <div>
              <span class="block text-sm mb-1" style="color:${r};opacity:.7">Status</span>
              <span class="font-medium" style="color:${y?d:m}">
                ${y?"Connected":"Disconnected"}
              </span>
            </div>
          </div>
        </div>

        <!-- Data Source Health -->
        ${Object.entries(I).map(([b,M])=>`
          <div class="border rounded-lg p-6" style="border-color:${c}">
            <div class="flex items-start justify-between mb-4">
              <h3 class="font-semibold" style="color:${r}">${this.escapeHTML(b)}</h3>
              <div class="text-2xl" style="color:${this.getStatusColor(M)}">
                ${this.getStatusIcon(M)}
              </div>
            </div>
            <div class="space-y-3">
              <div>
                <span class="block text-sm mb-1" style="color:${r};opacity:.7">Status</span>
                <span class="font-medium" style="color:${this.getStatusColor(M)}">
                  ${this.escapeHTML(String(M||"unknown").charAt(0).toUpperCase()+String(M||"unknown").slice(1))}
                </span>
              </div>
            </div>
          </div>
        `).join("")}
      </div>
    `}showHealthError(o){const r=p("#health-container");r&&(r.innerHTML=`
      <div class="error-message">
        Unable to load system health: ${this.escapeHTML(o)}
      </div>
    `)}async loadLogs(o=null){try{const r={};o&&o!=="all"&&(r.level=o);const c=await it.getLogs(r);c.success&&c.data&&(this.logs=c.data.items||[],this.renderLogs())}catch(r){console.error("Error loading logs:",r),this.showLogsError(r.message)}}renderLogs(){const o=p("#logs-container");if(!o)return;if(this.logs.length===0){o.innerHTML=`
        <div class="p-8 text-center text-gray-500">
          No logs found.
        </div>
      `;return}const{grayText:r}=_.COLORS;o.innerHTML=`
      <div class="space-y-4 max-h-[500px] overflow-y-auto">
        ${this.logs.map((c,d)=>`
          <div class="flex gap-4 p-4 rounded-lg ${d%2===0?"bg-white":"bg-gray-50"}" style="border-left:4px solid ${this.getStatusColor(c.level)}">
            <div class="flex-shrink-0 w-32">
              <span class="text-sm" style="color:${r};opacity:.7">${c.created_at||"N/A"}</span>
            </div>
            <div class="flex-shrink-0 w-32">
              <span class="text-sm" style="color:${r}">${this.escapeHTML(c.source_adapter||"system")}</span>
            </div>
            <div class="flex-shrink-0">
              <span class="px-2 py-1 rounded text-xs ${this.getSeverityBadge(c.level)}">
                ${this.escapeHTML((c.level||"info").toUpperCase())}
              </span>
            </div>
            <div class="flex-1">
              <span style="color:${r}">${this.escapeHTML(c.message||"")}</span>
            </div>
          </div>
        `).join("")}
      </div>
    `}showLogsError(o){const r=p("#logs-container");r&&(r.innerHTML=`
      <div class="error-message">
        Unable to load logs: ${this.escapeHTML(o)}
      </div>
    `)}bindEvents(){p("#auto-refresh")?.addEventListener("change",o=>{this.autoRefresh=o.target.checked,this.autoRefresh?this.startAutoRefresh():this.stopAutoRefresh()}),p("#refresh-now")?.addEventListener("click",()=>{this.loadData()}),Et(".log-filter").forEach(o=>{o.addEventListener("click",r=>{let c=r.currentTarget.dataset.level;c==="errors"&&(c="error"),c==="warnings"&&(c="warning"),this.loadLogs(c),Et(".log-filter").forEach(d=>{d.classList.remove("bg-blue-100","font-semibold")}),r.currentTarget.classList.add("bg-blue-100","font-semibold")})})}startAutoRefresh(){this.refreshInterval=setInterval(()=>{this.loadData()},6e4)}stopAutoRefresh(){this.refreshInterval&&(clearInterval(this.refreshInterval),this.refreshInterval=null)}getStatusColor(o){return{healthy:_.COLORS.green,active:_.COLORS.green,warning:_.COLORS.yellow,error:_.COLORS.red,info:_.COLORS.blue}[o]||_.COLORS.grayText}getStatusIcon(o){return{healthy:"",active:"",warning:"",error:""}[o]||""}getSeverityBadge(o){return{error:"bg-red-100 text-red-800",warning:"bg-yellow-100 text-yellow-800",info:"bg-blue-100 text-blue-800"}[o]||"bg-gray-100 text-gray-800"}escapeHTML(o){const r=document.createElement("div");return r.textContent=o,r.innerHTML}destroy(){this.stopAutoRefresh()}}delete kn.Icon.Default.prototype._getIconUrl;kn.Icon.Default.mergeOptions({iconRetinaUrl:new URL("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAABSCAMAAAAhFXfZAAAC91BMVEVMaXEzeak2f7I4g7g3g7cua5gzeKg8hJo3grY4g7c3grU0gLI2frE0daAubJc2gbQwd6QzeKk2gLMtd5sxdKIua5g1frA2f7IydaM0e6w2fq41fK01eqo3grgubJgta5cxdKI1f7AydaQydaMxc6EubJgvbJkwcZ4ubZkwcJwubZgubJcydqUydKIxapgubJctbJcubZcubJcvbJYubJcvbZkubJctbJctbZcubJg2f7AubJcrbZcubJcubJcua5g3grY0fq8ubJcubJdEkdEwhsw6i88vhswuhcsuhMtBjMgthMsrg8srgss6is8qgcs8i9A9iMYtg8spgcoogMo7hcMngMonf8olfso4gr8kfck5iM8jfMk4iM8he8k1fro7itAgesk2hs8eecgzfLcofssdeMg0hc4cd8g2hcsxeLQbdsgZdcgxeLImfcszhM0vda4xgckzhM4xg84wf8Yxgs4udKsvfcQucqhUndROmdM1fK0wcZ8vb5w0eqpQm9MzeKhXoNVcpdYydKNWn9VZotVKltJFjsIwcJ1Rms9OlslLmtH///8+kc9epdYzd6dbo9VHkMM2f7FHmNBClM8ydqVcpNY9hro3gLM9hLczealQmcw3fa46f7A8gLMxc6I3eagyc6FIldJMl9JSnNRSntNNl9JPnNJFi75UnM9ZodVKksg8kM45jc09e6ZHltFBk883gbRBh7pDk9EwcaBzn784g7dKkcY2i81Om9M7j85Llc81is09g7Q4grY/j9A0eqxKmdFFltBEjcXf6fFImdBCiLxJl9FGlNFBi78yiMxVndEvbpo6js74+vx+psPP3+o/ks5HkcpGmNCjwdZCkNDM3ehYoNJEls+lxNkxh8xHks0+jdC1zd5Lg6r+/v/H2ufz9/o3jM3t8/edvdM/k89Th61OiLBSjbZklbaTt9BfptdjmL1AicBHj8hGk9FAgK1dkLNTjLRekrdClc/k7fM0icy0y9tgp9c4jc2NtM9Dlc8zicxeXZn3AAAAQ3RSTlMAHDdTb4yPA+LtnEQmC4L2EmHqB7XA0d0sr478x4/Yd5i1zOfyPkf1sLVq4Nh3FvjxopQ2/STNuFzUwFIwxKaejILpIBEV9wAABhVJREFUeF6s1NdyFEcYBeBeoQIhRAkLlRDGrhIgY3BJL8CVeKzuyXFzzjkn5ZxzzuScg3PO8cKzu70JkO0LfxdTU//pM9vTu7Xgf6KqOVTb9X7toRrVEfBf1HTVjZccrT/2by1VV928Yty9ZbVuucdz90frG8DBjl9pVApbOstvmMuvVgaNXSfAAd6pGxpy6yxf5ph43pS/4f3uoaGm2rdu72S9xzOvMymkZFq/ptDrk90mhW7e4zl7HLzhxGWPR20xmSxJ/VqldG5m9XhaVOA1DadsNh3Pu5L2N6QtPO/32JpqQBVVk20oy/Pi2s23WEvyfHbe1thadVQttvm7Llf65gGmXK67XtupyoM7HQhmXdLS8oGWJNeOJ3C5fG5XCEJnkez3/oFdsvgJ4l2ANZwhrJKk/7OSXa+3Vw2WJMlKnGkobouYk6T0TyX30klOUnTD9HJ5qpckL3EW/w4XF3Xd0FGywXUrstrclVsqz5Pd/sXFYyDnPdrLcQODmGOK47IZb4CmibmMn+MYRzFZ5jg33ZL/EJrWcszHmANy3ARBK/IXtciJy8VsitPSdE3uuHxzougojcUdr8/32atnz/ev3f/K5wtpxUTpcaI45zusVDpYtZi+jg0oU9b3x74h7+n9ABvYEZeKaVq0sh0AtLKsFtqNBdeT0MrSzwwlq9+x6xAO4tgOtSzbCjrNQQiNvQUbUEubvzBUeGw26yDCsRHCoLkTHDa7IdOLIThs/gHvChszh2CimE8peRs47cxANI0lYNB5y1DljpOF0IhzBDPOZnDOqYYbeGKECbPzWnXludPphw5c2YBq5zlwXphIbO4VDCZ0gnPfUO1TwZoYwAs2ExPCedAu9DAjfQUjzITQb3jNj0KG2Sgt6BHaQUdYzWz+XmBktOHwanXjaSTcwwziBcuMOtwBmqPrTOxFQR/DRKKPqyur0aiW6cULYsx6tBm0jXpR/AUWR6HRq9WVW6MRhIq5jLyjbaCTDCijyYJNpCajdyobP/eTw0iexBAKkJ3gA5KcQb2zBXsIBckn+xVv8jkZSaEFHE+jFEleAEfayRU0MouNoBmB/L50Ai/HSLIHxcrpCvnhSQAuakKp2C/YbCylJjXRVy/z3+Kv/RrNcCo+WUzlVEhzKffnTQnxeN9fWF88fiNCUdSTsaufaChKWInHeysygfpIqagoakW+vV20J8uyl6TyNKEZWV4oRSPyCkWpgOLSbkCObT8o2r6tlG58HQquf6O0v50tB7JM7F4EORd2dx/K0w/KHsVkLPaoYrwgP/y7krr3SSMA4zj+OBgmjYkxcdIJQyQRKgg2viX9Hddi9UBb29LrKR7CVVEEEXWojUkXNyfTNDE14W9gbHJNuhjDettN3ZvbOvdOqCD3Jp/9l+/wJE+9PkYGjx/fqkys3S2rMozM/o2106rfMUINo6hVqz+eu/hd1c4xTg0TAfy5kV+4UG6+IthHTU9woWmxuKNbTfuCSfovBCxq7EtHqvYL4Sm6F8GVxsSXHMQ07TOi1DKtZxjWaaIyi4CXWjxPccUw8WVbMYY5wxC1mzEyXMJWkllpRloi+Kkoq69sxBTlElF6aAxYUbjXNlhlDZilDnM4U5SlN5biRsRHnbx3mbeWjEh4mEyiuJDl5XcWVmX5GvNkFgLWZM5qwsop4/AWfLhU1cR7k1VVvcYCWRkOI6Xy5gmnphCYIkvzuNYzHzosq2oNk2RtSs8khfUOfHIDgR6ysYBaMpl4uEgk2U/oJTs9AaTSwma7dT69geAE2ZpEjUsn2ieJNHeKfrI3EcAGJ2ZaNgVuC8EBctCLc57P5u5led6IOBkIYkuQMrmmjChs4VkfOerHqSBkPzZlhe06RslZ3zMjk2sscqKwY0RcjKK+LWbzd7KiHhkncs/siFJ+V5eXxD34B8nVuJEpGJNmxN2gH3vSvp7J70tF+D1Ej8qUJD1TkErAND2GZwTFg/LubvmgiBG3SOvdlsqFQrkEzJCL1rstlnVFROixZoDDSuXQFHESwVGlcuQcMb/b42NgjLowh5MTDFE3vNB5qStRIErdCQEh6pLPR92anSUb/wAIhldAaDMpGgAAAABJRU5ErkJggg==",import.meta.url).href,iconUrl:new URL("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAApCAYAAADAk4LOAAAFgUlEQVR4Aa1XA5BjWRTN2oW17d3YaZtr2962HUzbDNpjszW24mRt28p47v7zq/bXZtrp/lWnXr337j3nPCe85NcypgSFdugCpW5YoDAMRaIMqRi6aKq5E3YqDQO3qAwjVWrD8Ncq/RBpykd8oZUb/kaJutow8r1aP9II0WmLKLIsJyv1w/kqw9Ch2MYdB++12Onxee/QMwvf4/Dk/Lfp/i4nxTXtOoQ4pW5Aj7wpici1A9erdAN2OH64x8OSP9j3Ft3b7aWkTg/Fm91siTra0f9on5sQr9INejH6CUUUpavjFNq1B+Oadhxmnfa8RfEmN8VNAsQhPqF55xHkMzz3jSmChWU6f7/XZKNH+9+hBLOHYozuKQPxyMPUKkrX/K0uWnfFaJGS1QPRtZsOPtr3NsW0uyh6NNCOkU3Yz+bXbT3I8G3xE5EXLXtCXbbqwCO9zPQYPRTZ5vIDXD7U+w7rFDEoUUf7ibHIR4y6bLVPXrz8JVZEql13trxwue/uDivd3fkWRbS6/IA2bID4uk0UpF1N8qLlbBlXs4Ee7HLTfV1j54APvODnSfOWBqtKVvjgLKzF5YdEk5ewRkGlK0i33Eofffc7HT56jD7/6U+qH3Cx7SBLNntH5YIPvODnyfIXZYRVDPqgHtLs5ABHD3YzLuespb7t79FY34DjMwrVrcTuwlT55YMPvOBnRrJ4VXTdNnYug5ucHLBjEpt30701A3Ts+HEa73u6dT3FNWwflY86eMHPk+Yu+i6pzUpRrW7SNDg5JHR4KapmM5Wv2E8Tfcb1HoqqHMHU+uWDD7zg54mz5/2BSnizi9T1Dg4QQXLToGNCkb6tb1NU+QAlGr1++eADrzhn/u8Q2YZhQVlZ5+CAOtqfbhmaUCS1ezNFVm2imDbPmPng5wmz+gwh+oHDce0eUtQ6OGDIyR0uUhUsoO3vfDmmgOezH0mZN59x7MBi++WDL1g/eEiU3avlidO671bkLfwbw5XV2P8Pzo0ydy4t2/0eu33xYSOMOD8hTf4CrBtGMSoXfPLchX+J0ruSePw3LZeK0juPJbYzrhkH0io7B3k164hiGvawhOKMLkrQLyVpZg8rHFW7E2uHOL888IBPlNZ1FPzstSJM694fWr6RwpvcJK60+0HCILTBzZLFNdtAzJaohze60T8qBzyh5ZuOg5e7uwQppofEmf2++DYvmySqGBuKaicF1blQjhuHdvCIMvp8whTTfZzI7RldpwtSzL+F1+wkdZ2TBOW2gIF88PBTzD/gpeREAMEbxnJcaJHNHrpzji0gQCS6hdkEeYt9DF/2qPcEC8RM28Hwmr3sdNyht00byAut2k3gufWNtgtOEOFGUwcXWNDbdNbpgBGxEvKkOQsxivJx33iow0Vw5S6SVTrpVq11ysA2Rp7gTfPfktc6zhtXBBC+adRLshf6sG2RfHPZ5EAc4sVZ83yCN00Fk/4kggu40ZTvIEm5g24qtU4KjBrx/BTTH8ifVASAG7gKrnWxJDcU7x8X6Ecczhm3o6YicvsLXWfh3Ch1W0k8x0nXF+0fFxgt4phz8QvypiwCCFKMqXCnqXExjq10beH+UUA7+nG6mdG/Pu0f3LgFcGrl2s0kNNjpmoJ9o4B29CMO8dMT4Q5ox8uitF6fqsrJOr8qnwNbRzv6hSnG5wP+64C7h9lp30hKNtKdWjtdkbuPA19nJ7Tz3zR/ibgARbhb4AlhavcBebmTHcFl2fvYEnW0ox9xMxKBS8btJ+KiEbq9zA4RthQXDhPa0T9TEe69gWupwc6uBUphquXgf+/FrIjweHQS4/pduMe5ERUMHUd9xv8ZR98CxkS4F2n3EUrUZ10EYNw7BWm9x1GiPssi3GgiGRDKWRYZfXlON+dfNbM+GgIwYdwAAAAASUVORK5CYII=",import.meta.url).href,shadowUrl:new URL("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACkAAAApCAQAAAACach9AAACMUlEQVR4Ae3ShY7jQBAE0Aoz/f9/HTMzhg1zrdKUrJbdx+Kd2nD8VNudfsL/Th///dyQN2TH6f3y/BGpC379rV+S+qqetBOxImNQXL8JCAr2V4iMQXHGNJxeCfZXhSRBcQMfvkOWUdtfzlLgAENmZDcmo2TVmt8OSM2eXxBp3DjHSMFutqS7SbmemzBiR+xpKCNUIRkdkkYxhAkyGoBvyQFEJEefwSmmvBfJuJ6aKqKWnAkvGZOaZXTUgFqYULWNSHUckZuR1HIIimUExutRxwzOLROIG4vKmCKQt364mIlhSyzAf1m9lHZHJZrlAOMMztRRiKimp/rpdJDc9Awry5xTZCte7FHtuS8wJgeYGrex28xNTd086Dik7vUMscQOa8y4DoGtCCSkAKlNwpgNtphjrC6MIHUkR6YWxxs6Sc5xqn222mmCRFzIt8lEdKx+ikCtg91qS2WpwVfBelJCiQJwvzixfI9cxZQWgiSJelKnwBElKYtDOb2MFbhmUigbReQBV0Cg4+qMXSxXSyGUn4UbF8l+7qdSGnTC0XLCmahIgUHLhLOhpVCtw4CzYXvLQWQbJNmxoCsOKAxSgBJno75avolkRw8iIAFcsdc02e9iyCd8tHwmeSSoKTowIgvscSGZUOA7PuCN5b2BX9mQM7S0wYhMNU74zgsPBj3HU7wguAfnxxjFQGBE6pwN+GjME9zHY7zGp8wVxMShYX9NXvEWD3HbwJf4giO4CFIQxXScH1/TM+04kkBiAAAAAElFTkSuQmCC",import.meta.url).href});class Pn{constructor(){this.init()}init(){Zt.register("/",ho),Zt.register("/admin/",Tn),Zt.register("/admin/upload",Tn),Zt.register("/admin/incidents",uo),Zt.register("/admin/logs",fo),this.setupOnlineStatusMonitoring(),this.start()}start(){const o=window.location.hash.slice(1)||"/";Zt.navigate(o,!1)}setupOnlineStatusMonitoring(){setInterval(async()=>{const o=it.getOnlineStatus();Te.setState({isOnline:o}),this.toggleOfflineBanner(!o)},3e4),window.addEventListener("online",()=>{Te.setState({isOnline:!0}),this.toggleOfflineBanner(!1)}),window.addEventListener("offline",()=>{Te.setState({isOnline:!1}),this.toggleOfflineBanner(!0)})}toggleOfflineBanner(o){let r=document.getElementById("offline-banner");o&&!r?(r=document.createElement("div"),r.id="offline-banner",r.className="offline-banner",r.setAttribute("role","alert"),r.setAttribute("aria-live","assertive"),r.textContent=" Connection Lost - Some features may be unavailable",document.body.prepend(r)):!o&&r&&r.remove()}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>new Pn):new Pn;
